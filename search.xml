<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[iOS APNs: Background Fetch]]></title>
      <url>/2018/02/08/iOS-APNs-Background-Fetch/</url>
      <content type="html"><![CDATA[<p>在前面的几篇文章中, 给大家介绍了跟推送相关的内容.</p>
<p>今天跟大家聊一聊 iOS7 新加入的 <code>Background Fetch</code> 功能.</p>
<p>该系列博客:</p>
<blockquote>
<p><a href="http://www.veryitman.com/2017/08/06/iOS-APNs-%E8%BF%9C%E7%A8%8B%E6%8E%A8%E9%80%81/" target="_blank" rel="noopener">iOS APNs: 远程推送</a><br><a href="http://www.veryitman.com/2017/08/06/iOS-APNs-%E6%9C%AC%E5%9C%B0%E6%8E%A8%E9%80%81/" target="_blank" rel="noopener">iOS APNs: 本地推送</a><br><a href="http://www.veryitman.com/2017/08/07/iOS-APNs-%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE/" target="_blank" rel="noopener">iOS APNs: 处理数据</a><br><a href="http://www.veryitman.com/2018/02/06/iOS-APNs-%E9%9D%99%E9%BB%98%E6%8E%A8%E9%80%81/" target="_blank" rel="noopener">iOS APNs: 静默推送</a><br>iOS APNs: Background Fetch(本篇)</p>
</blockquote>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>从 <code>Background Fetch</code> 字面上来看, 大致意思是可在后台获取数据.</p>
<p>在 iOS7 中，Apple 为开发者提供了可以在后台更新应用程序界面和内容的 API, 即 <code>Background Fetch</code>.</p>
<p>该特性允许开发者在一个周期间隔后进行特定的动作，如获取网络内容, 更新 UI 操作等.</p>
<p>同时在 iOS7 中, 也加入了另一个特性, 就是博文 <a href="http://www.veryitman.com/2018/02/06/iOS-APNs-%E9%9D%99%E9%BB%98%E6%8E%A8%E9%80%81/" target="_blank" rel="noopener">iOS APNs: 静默推送</a> 里面说的静默推送.</p>
<p>这些都是对 iOS 后台多任务的补充和完善, Apple 一直在优化系统从而增强用户体验.</p>
<h2 id="开启-Background-Fetch"><a href="#开启-Background-Fetch" class="headerlink" title="开启 Background Fetch"></a>开启 Background Fetch</h2><p><strong>1.需要 APP 支持</strong></p>
<p>如下图所示, 勾选即可.</p>
<p><img src="/upload/images/2018/02/08/1.png" alt="1"></p>
<p><strong>2.设置 fetch 时间间隔</strong></p>
<p>在 AppDelegate 中设置.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123; </div><div class="line"></div><div class="line">	// 设置 fetch 时间间隔</div><div class="line">    [application setMinimumBackgroundFetchInterval:UIApplicationBackgroundFetchIntervalMinimum];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>UIApplicationBackgroundFetchIntervalMinimum</code> 是系统自定义的时间. 如果不设置, 默认是 <code>UIApplicationBackgroundFetchIntervalNever</code>, 这样就不会让 <code>Background Fetch</code> 生效了.</p>
<p>可以查看对 UIApplicationBackgroundFetchIntervalNever 的官方解释.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">UIApplicationBackgroundFetchIntervalNever</div><div class="line"></div><div class="line">A fetch interval large enough to prevent fetch operations from occurring.</div></pre></td></tr></table></figure>
<p>当然, 你也可以设置自己定义的时间的间隔, 但是基本没有什么作用, 因为这个时间间隔完全由系统来决定, 系统会根据你的电量以及使用频率来决定.</p>
<p>所以, 可以理解为 <code>setMinimumBackgroundFetchInterval</code> 方法只是开启了 <code>Background Fetch</code> 功能.</p>
<p><strong>3.开启了系统后台更新功能</strong></p>
<p>在 iOS 系统中, 设置/通用/后台应用刷新中一定要开启对应 APP 的功能.</p>
<p>判断是否已经开启该功能的示例代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">if ([[UIApplication sharedApplication] backgroundRefreshStatus] != UIBackgroundRefreshStatusAvailable) &#123;</div><div class="line"></div><div class="line">	//不可用提示用户</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="处理回调"><a href="#处理回调" class="headerlink" title="处理回调"></a>处理回调</h2><p>在实际的应用环中，<code>Background Fetch</code> 事件是由系统管理的，我们开发者是无法预先知道 Fetch 事件达到的时机的. </p>
<p>网上很多说可以使用 Xcode 模拟这个事件, 估计也是之前的系统和 Xcode 版本, 现在的 Xcode9 貌似不行了.</p>
<p>但是, 你的手机在后台等几分钟, 有时候会被系统触发该事件, 触发后, 对应的系统回调(在 AppDelegate 中)会被调用.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">// Background fetch 回调</div><div class="line">- (void)application:(UIApplication *)application</div><div class="line">performFetchWithCompletionHandler:(void (^)(UIBackgroundFetchResult))completionHandler &#123;</div><div class="line">    </div><div class="line">    MZLOG(@&quot;AppDelegate. Background fetch.&quot;);</div><div class="line">    </div><div class="line">    //可进行对应的耗时操作, 如下载等.</div><div class="line">    </div><div class="line">    completionHandler(UIBackgroundFetchResultNoData);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>Background Fetch</code> 会为我们的 App 争取更多的后台时间, 但是一般是几十秒左右, 不会太多. 所以, 不要在回调中做太多耗时的操作.</p>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> APNs 远程推送 BackgroundFetch </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS APNs: 静默推送]]></title>
      <url>/2018/02/06/iOS-APNs-%E9%9D%99%E9%BB%98%E6%8E%A8%E9%80%81/</url>
      <content type="html"><![CDATA[<p>今天跟大家介绍一下 ios 的静默推送功能.</p>
<p>静默推送, 简单来说就是通过推送实现用户无感知的消息通知.</p>
<p>该系列博文:</p>
<blockquote>
<p><a href="http://www.veryitman.com/2017/08/06/iOS-APNs-%E8%BF%9C%E7%A8%8B%E6%8E%A8%E9%80%81/" target="_blank" rel="noopener">iOS APNs: 远程推送</a><br><a href="http://www.veryitman.com/2017/08/06/iOS-APNs-%E6%9C%AC%E5%9C%B0%E6%8E%A8%E9%80%81/" target="_blank" rel="noopener">iOS APNs: 本地推送</a><br><a href="http://www.veryitman.com/2017/08/07/iOS-APNs-%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE/" target="_blank" rel="noopener">iOS APNs: 处理数据</a><br>iOS APNs: 静默推送(本篇)</p>
</blockquote>
<h2 id="普通推送"><a href="#普通推送" class="headerlink" title="普通推送"></a>普通推送</h2><p>例如微信, 好友给你发送了一条消息, 你的微信APP 在后台, 此时会收到带声音的一个消息提示.</p>
<p>这条推送机油有文字又有声音, 点开这个推送可以直接打开 APP.</p>
<p>从程序的角度来讲, 进入 App 后会调用下面的方法:</p>
<p>iOS10.0.x 和其之前的系统调用下面的方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo</div></pre></td></tr></table></figure>
<p>iOS10.0.x 之后的系统, 会调用如下的方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (void)application:(UIApplication *)application</div><div class="line">                    didReceiveRemoteNotification:(NSDictionary *)userInfo</div><div class="line">                    fetchCompletionHandler:(void (^)(UIBackgroundFetchResult result))completionHandler</div></pre></td></tr></table></figure>
<h2 id="静默推送的异同"><a href="#静默推送的异同" class="headerlink" title="静默推送的异同"></a>静默推送的异同</h2><p><strong>1.没有弹出框</strong></p>
<p>没有推送的弹框出现, 用户毫无感知的接收到了这个推送消息. 有 <code>润物细无声</code> 的感觉.</p>
<p>该推送既没有文字又没有声音.</p>
<p><strong>2.需要用户授权允许推送</strong></p>
<p>这个跟普通推送一样, 都需要用户授权才可以推送.</p>
<p><strong>3.会执行代理方法</strong></p>
<p>静默推送来的时候, 也能执行上面的回调方法. 执行上面方法的场景如下::</p>
<blockquote>
<p>1.App 在前台.<br>2.App 在后台, 但是没有被 kill 掉.</p>
</blockquote>
<p><strong>4.iOS7 以后才有的</strong></p>
<p>对于 iOS 之前是没有静默推送的.</p>
<p><strong>5.可以延长后台时间</strong></p>
<p>收到静默推送后, 在应用程序挂起之前有 30 秒左右可以执行相关的操作.</p>
<p>6.推送频率的控制</p>
<p>静默的推送是苹果推送服务器控制推送频率的.</p>
<p>苹果推送服务根据后台推送任务的能耗(用电量,接收情况)来控制后台推送的推送频率和延迟时间.</p>
<hr>
<p><strong>总之</strong>, 静默推送是普通推送的一种变种而已. </p>
<p>无论是静默推送还是普通推送, 开发者证书里面必须开通 push 相关的功能, 并且也需要用户开启允许推送的授权.</p>
<p>这个在 <a href="http://www.veryitman.com/2017/08/06/iOS-APNs-%E8%BF%9C%E7%A8%8B%E6%8E%A8%E9%80%81/" target="_blank" rel="noopener">iOS APNs: 远程推送</a> 里面已经介绍过, 不在这里赘述.</p>
<h2 id="推送的格式"><a href="#推送的格式" class="headerlink" title="推送的格式"></a>推送的格式</h2><p>普通推送的格式, 大致是这个样子:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;aps&quot;:</div><div class="line">		&#123;</div><div class="line">			&quot;alert&quot;:&quot;Testing.. (15),</div><div class="line">			&quot;badge&quot;:1,</div><div class="line">			&quot;sound&quot;:&quot;default&quot;</div><div class="line">		&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>静默推送是不允许带 <code>alert</code> <code>badge</code>  <code>sound</code> 等字段的. 但是必须包含 <code>&quot;content-available&quot;:1</code>.</p>
<p>例如下面的形式都可以:</p>
<blockquote>
<p>形式1</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;aps&quot;:</div><div class="line">		&#123;</div><div class="line">			&quot;content-available&quot;:1</div><div class="line">		&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>形式2</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;aps&quot;:</div><div class="line">		&#123;</div><div class="line">			&quot;custom&quot;:&quot;open_profile_page&quot;</div><div class="line">			&quot;content-available&quot;:1</div><div class="line">		&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中, custom 是自己定义的, 大家根据需求自行扩展即可.</p>
<blockquote>
<p>形式3</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;aps&quot; : &#123;</div><div class="line">        &quot;content-available&quot; : 1</div><div class="line">    &#125;,</div><div class="line">    &quot;acme1&quot; : &quot;bar&quot;,</div><div class="line">    &quot;acme2&quot; : 42</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个来自苹果开发者 <a href="https://developer.apple.com/library/content/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/CreatingtheNotificationPayload.html" target="_blank" rel="noopener">文档</a>.</p>
<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>具体的使用场景, 需要结合本身的业务和功能特点来说.</p>
<p>静默推送的前提是 APP 没有被杀死, 可以通过回调函数来执行相关的代码.</p>
<p>另外, 静默推送不会打扰用户, 比如用户正在游戏中战斗, 你频繁的使用普通推送给他, 估计他都要疯了. </p>
<p>我个人使用静默推送的场景大致是这样的, APP 将要挂起的时候, 请求服务器去发一条静默推送, 然后使用本地通知的方式唤起用户来打开 APP, 从而保证 APP 处于保活的状态, 至少静默推送可以增加后台挂起的时间.</p>
<p>关于本地通知的内容, 可以参考之前的文章 <a href="http://www.veryitman.com/2017/08/06/iOS-APNs-%E6%9C%AC%E5%9C%B0%E6%8E%A8%E9%80%81/" target="_blank" rel="noopener">iOS APNs: 本地推送</a>.</p>
<p>更多的使用场景等大家在业务中去挖掘.</p>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> APNs 推送 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Hi 2018, 我又来了]]></title>
      <url>/2018/02/02/Hi-2018-%E6%88%91%E5%8F%88%E6%9D%A5%E4%BA%86/</url>
      <content type="html"><![CDATA[<p>好久没有更新自己的博客了, 以前坚持一周至少两篇博文的我, 从2017 年 10 月份到现在居然停止了. </p>
<p>其实, 这是有原因的, 下面道来.</p>
<h2 id="数据丢了"><a href="#数据丢了" class="headerlink" title="数据丢了"></a>数据丢了</h2><p>2017 年 10 月 15 日晚, 我亲手把自己的博文(原数据) 给弄丢了.</p>
<p>事情大致经过是这样的…</p>
<p>Mac 操作系统提示, 有更新的系统可以使用了, 问是否立即安装, 在公司的时候, 我心想, 更新后, 自己安装的一些库, 估计也要重新安装, 嫌麻烦就直接跳过了.</p>
<p>过了大概 2 天, 我晚上下班回家, 系统又提示我更新. 当时, 我就没有忍住, 直接更新了, 毕竟早晚都要更新的.</p>
<p>趁电脑更新系统的时候, 我就去洗了澡, 回来发现系统更新已经完成了. </p>
<p>心想, 正好可以把之前没有完成的博客去完善一下, 谁知道…天不遂我愿呀! 再去使用 Hexo 的时候, 提示我失败, 居然无法使用了. 这可把我急的够呛, 一气之下(脑子估计当时进水了), 直接删了 Hexo 目录, 是那种程序员式的毫不留情的删除.</p>
<pre><code>rm -fr ./hexo
</code></pre><p>潇洒的操作后, 重新安装 Hexo, 又折腾了两个晚上, 最终也是安装好了, 可以写东东了.</p>
<p>但是发现从 git 上面 clone 后的文件, 无法还原成自己当初的 MarkDown 文件了.</p>
<p>雪花那个飘啊飘, 北风那个萧呀萧…</p>
<p>一切都晚了! ^^</p>
<p>唯一值得庆幸的是, 原来自己的网站博文还在那里.</p>
<h2 id="还原数据"><a href="#还原数据" class="headerlink" title="还原数据"></a>还原数据</h2><p>从哪里跌倒, 就从哪里爬起来, 我决定把之前的数据使用 <code>人工智能</code> 的方式还原回来.</p>
<p>对, 没错, 我就是那个 <code>人工</code>, 手动的转换为 MarkDown 文档, 压根没有什么 <code>智能</code>.</p>
<p>好歹那也是自己熬过多少个日夜的成果呀, 没有功劳也有苦劳, 我不忍心就这样让它丢掉, 含着泪也要把他找回来!</p>
<p>自己下半年也比较忙, 周末都在加班, 只能每天晚上回家抽些时间还原一点, 有时候太困, 就推迟到下个晚上. 大概用了 3 个月左右的时间, 基本还原回来了. </p>
<p>每篇文章基本都有配图, 都有跳转链接, 恢复起来, 还是需要一点时间和毅力的, 中途我也放弃过, 但是想想它们就要这样的被我抹杀了, 实在太可怜了, 就坚持下来了.</p>
<h2 id="反思和总结"><a href="#反思和总结" class="headerlink" title="反思和总结"></a>反思和总结</h2><p>去还原之前的数据, 比写新文章还累, 主要是心累.</p>
<p>刚开始的时候, 我每篇都想一步到位的还原, 发现坚持几个晚上, 效率很低, 很容易让人放弃.</p>
<p>最后, 我调节了一下心态, 分迭代去做.</p>
<p><strong>第一个阶段</strong>, 把 HTML 文章拷贝到 MarkDown 工具中, 不做任何的修饰和修改.</p>
<p><strong>第二个阶段</strong>, 梳理 MarkDown 文档, 把缺失的图片补上去.</p>
<p><strong>第三个阶段</strong>, 把文章中的链接尽量补全.</p>
<p>经过这三个阶段后, 文章基本已经复原了, 只是格式上看起来有点糟糕. </p>
<p><strong>第四个阶段</strong>, 整理文章的排版, 对比已经发布的文章, 查漏补缺.</p>
<p>第四个阶段结束后, 文章基本都复活了, 接下来就是部署和发布了.</p>
<p><strong>第五个阶段</strong>, 整理 Hexo, 配置相关的主题.</p>
<p><strong>第六个阶段</strong>, 本地预览和再次校验文章, 统一发布.</p>
<p>每个阶段, 我都给自己一个小目标, 不断的去完善, 最后将各个阶段的成果串联起来, 就完成了. 当自己遇到困难的时候, 不妨分解一下任务, 不断的去完成每个小任务, 每个完成的小任务都是对自己最大的奖励.</p>
<p>整个还原的过程, 又让我重新梳理了一下之前的文章, 包括目录规划和措辞, 也对图片进行了压缩和处理. 收获也颇多.</p>
<p>如果当初自己不那么冲动, 如果当初自己备份了文件, 应该就不会有这么一个艰辛的历程了.</p>
<blockquote>
<p>数据备份很重要, 无脑的冲动是要付出代价的.</p>
</blockquote>
<p>祝大家在 2018 发发发, 身体健康, 幸福安康!</p>
]]></content>
      
        <categories>
            
            <category> 随笔 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 学习 生活 反思 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[GCC: 静态库]]></title>
      <url>/2017/10/08/GCC-%E9%9D%99%E6%80%81%E5%BA%93/</url>
      <content type="html"><![CDATA[<h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>如果你对 GCC 的编译 C语言的流程不清楚, 建议在阅读本文之前先去看一下 <a href="http://www.veryitman.com/2017/10/03/GCC-%E7%BC%96%E8%AF%91C%E8%AF%AD%E8%A8%80%E7%9A%84%E6%B5%81%E7%A8%8B/" target="_blank" rel="noopener">GCC: 编译C语言的流程</a> 这篇文章, 篇幅短小精悍, 阅读后, 至少可以扫扫盲😜.</p>
<p>本篇博文用到的一些基础知识点:</p>
<p><strong>1.GCC</strong></p>
<p>gcc -c 选项含义:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Only run preprocess, compile, and assemble steps</div></pre></td></tr></table></figure>
<p>是 <code>-c</code> 选项只是进行了预处理, 编译, 汇编的阶段, 不会进行链接的操作.</p>
<p><strong>2.静态库</strong></p>
<p>Linux 上的静态库，本质是一些目标文件的归档文件.</p>
<p><strong>3.静态库和共享库区别</strong></p>
<p>[1].使用共享库可以节省内存.</p>
<blockquote>
<p>比如 libc，系统中几乎所有的进程都映射 libc 到自己的进程地址空间，而 libc 的只读部分在物理内存中只需要存在一份，就可以被所有进程共享，这就是“共享库”这个名称的由来了.</p>
</blockquote>
<p>[2].使用共享库可以很方便地升级库文件而不需要重新编译应用程序.</p>
<p>[3].共享库占用更少的体积.</p>
<blockquote>
<p>在运行时做动态链接.而在链接静态库时, 链接器会把静态库中的目标文件取出来和可执行文件真正链接在一起.</p>
</blockquote>
<h2 id="创建步骤"><a href="#创建步骤" class="headerlink" title="创建步骤"></a>创建步骤</h2><p>创建静态库的步骤如下:</p>
<p>[1]. 写源文件.<br>[2]. 通过 gcc -c x.c 生成目标文件.<br>[2]. 归档. 用 ar 归档目标文件，生成静态库.<br>[3]. 写头文件, 便于使用者知道怎么使用该静态库.</p>
<p>使用静态库时，在源码中包含对应的头文件，链接时记得链接自己的库.</p>
<p>下面结合具体例子, 展开讲.</p>
<h2 id="写源文件"><a href="#写源文件" class="headerlink" title="写源文件"></a>写源文件</h2><p>目录结构<br><img src="/upload/images/2017/10/08/1.jpg" alt="1"></p>
<p>示例文件都是很简单的代码, 附录可以查看完整示例.</p>
<h2 id="生成目标文件"><a href="#生成目标文件" class="headerlink" title="生成目标文件"></a>生成目标文件</h2><p>将 libs 目录下面的(c)源文件进行预处理, 编译和汇编.<br>注意这里没有进行链接.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gcc -c libs/person.c libs/eat.c libs/play.c libs/sleep.c</div></pre></td></tr></table></figure>
<p>执行城后, 会生成对应的 .o 文件.</p>
<h2 id="归档"><a href="#归档" class="headerlink" title="归档"></a>归档</h2><p><code>libperson.a</code> 是要生成的库文件.</p>
<p>库文件都以 lib 开头, 静态库以. a 为后缀. 所以一般是 lib+ 名字.a</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ar rs libperson.a person.o sleep.o play.o eat.o</div></pre></td></tr></table></figure>
<p>ar: 类似于 tar, 用来对文件进行库打包.</p>
<p>r 选项: 将其后面的文件列表添加到文件包(libperson.a)中, 如果 libperson.a 不存在就创建它, 如果 libperson.a 已经存在且里面有同名的目标文件就进行替换操作.</p>
<p>s 选项: 为静态库创建索引.这个索引会被链接器使用.</p>
<blockquote>
<p>ranlib 命令也可以为静态库创建索引. 所以上面的命令可以等效为下面的两个命令.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ar r libperson.a person.o sleep.o play.o eat.o</div><div class="line">ranlib libperson.a</div></pre></td></tr></table></figure>
<h2 id="写头文件"><a href="#写头文件" class="headerlink" title="写头文件"></a>写头文件</h2><p>写一个 person.h 文件, 便于调用者查看库如何使用.</p>
<p>person.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#ifndef _PERSON_H</div><div class="line">#define _PERSON_H</div><div class="line">extern void init(int pUid);</div><div class="line">extern void eat();</div><div class="line">extern void play();</div><div class="line">extern void sleep();</div><div class="line">#endif</div></pre></td></tr></table></figure>
<p>使用静态库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gcc main.c -L. -lperson -Ilibs -o main</div></pre></td></tr></table></figure>
<p>-L 选项: 告诉编译器去哪里找库文件, 这里的 _L. 表示在当前目录.<br>如果不用 -L 选项, 即使库文件在当前目录, 编译器也不会去找, 所以该选项不能少.</p>
<p>报错信息如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ld: library not found for -lperson</div><div class="line">clang: error: linker command failed with exit code 1 (use -v to see invocation)</div></pre></td></tr></table></figure>
<p>-lperson: 告诉编译器要链接 libperson.a 库.</p>
<p>-I: 告诉编译器到哪里找头文件.<br>如果不指定头文件的查找目录, 也会报错:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">main.c:2:10: fatal error: &apos;person.h&apos; file not found</div><div class="line">#include &quot;person.h&quot;</div><div class="line">         ^~~~~~~~~~</div><div class="line">1 error generated.</div></pre></td></tr></table></figure>
<p>此时的目录结构:<br><img src="/upload/images/2017/10/08/2.jpg" alt="1"></p>
<p>链接成功后, 可以执行生成的 main (可执行)文件.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./main</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">uid: 101 eating</div><div class="line">uid: 101 playing</div><div class="line">uid: 101 has sleep</div></pre></td></tr></table></figure>
<h2 id="有趣的实验"><a href="#有趣的实验" class="headerlink" title="有趣的实验"></a>有趣的实验</h2><p>猜想一下如果有两个库一个是共享库, 一个是静态库, 而且二者除了后缀不一样, 名字都一样如 libperson.a 和 libperson.so, 那么调用方如何来选择对应的库文件呢?</p>
<p>我们把 GCC: 共享库 里面生成的共享库 libperson.so 放到当前的目录, 重新编译链接 main.c 文件.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gcc main.c -L. -lperson -Ilibs -o main</div></pre></td></tr></table></figure>
<p>再次执行 ./main, 得到结果是这样的:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">From sharedlib.uid: 101 eating</div><div class="line">From sharedlib.uid: 101 playing</div><div class="line">From sharedlib.uid: 101 has sleep</div></pre></td></tr></table></figure>
<p>以上的结果, 说明链接器会优先选择共享库其次才是静态库.</p>
<blockquote>
<p>Linux(MacOS 也一样) 的 GCC 默认链接动态库，只有当动态库不存在时，才去链接静态库.<br>若是需要强制指定静态库需要指定选项 -static.但是在 MacOS 上面不支持该选项.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gcc -static main.c -L. -lperson -Ilibs -o main</div></pre></td></tr></table></figure>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p>示例完整代码</p>
<blockquote>
<p>main.c</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#include &lt;stdio.h&gt;</div><div class="line">#include &quot;person.h&quot;</div><div class="line">int main() &#123;</div><div class="line">    init(101);</div><div class="line">    eat();</div><div class="line">    play();</div><div class="line">    sleep();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>person.h</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#ifndef _PERSON_H</div><div class="line">#define _PERSON_H</div><div class="line">extern void init(int pUid);</div><div class="line">extern void eat();</div><div class="line">extern void play();</div><div class="line">extern void sleep();</div><div class="line">#endif</div></pre></td></tr></table></figure>
<blockquote>
<p>person.c</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">int uid;</div><div class="line">void init(int pUid) &#123;</div><div class="line">    uid = pUid;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>eat.c</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#include &lt;stdio.h&gt;</div><div class="line">extern int uid;</div><div class="line">void eat() &#123;</div><div class="line">    printf(&quot;uid: %i eating\n&quot;, uid);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>play.c</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#include &lt;stdio.h&gt;</div><div class="line">extern int uid;</div><div class="line">void play() &#123;</div><div class="line">    printf(&quot;uid: %i playing\n&quot;, uid);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>sleep.c</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#include &lt;stdio.h&gt;</div><div class="line">extern int uid;</div><div class="line">void sleep() &#123;</div><div class="line">    printf(&quot;uid: %i has sleep\n&quot;, uid);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="GCC-系列博文"><a href="#GCC-系列博文" class="headerlink" title="GCC 系列博文"></a>GCC 系列博文</h2><p><a href="http://www.veryitman.com/2017/10/03/GCC-%E7%BC%96%E8%AF%91C%E8%AF%AD%E8%A8%80%E7%9A%84%E6%B5%81%E7%A8%8B/" target="_blank" rel="noopener">GCC: 编译 C 语言的流程</a></p>
<p><a href="http://www.veryitman.com/2017/10/07/GCC-Homebrew-%E5%AE%89%E8%A3%85-GCC-%E5%92%8C-Binutils/" target="_blank" rel="noopener">GCC: Homebrew 安装 GCC 和 Binutils</a></p>
<p><a href="http://www.veryitman.com/2017/10/07/GCC-%E5%85%B1%E4%BA%AB%E5%BA%93/" target="_blank" rel="noopener">GCC: 共享库</a></p>
<p><a href="http://www.veryitman.com/2017/10/08/GCC-%E9%9D%99%E6%80%81%E5%BA%93/" target="_blank" rel="noopener">GCC: 静态库</a></p>
]]></content>
      
        <categories>
            
            <category> GCC </category>
            
        </categories>
        
        
        <tags>
            
            <tag> GCC 编译器 静态库 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[GCC: 共享库]]></title>
      <url>/2017/10/07/GCC-%E5%85%B1%E4%BA%AB%E5%BA%93/</url>
      <content type="html"><![CDATA[<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>共享库: 在程序执行期间需要调用到共享库的时候才加载到内存里面，可以被多个程序共享使用.</p>
<p>在 MacOS 上面创建和使用共享库要比在 Linux 上面简单.<br>在 Linux 上面还会牵扯到共享库路径问题, 在 Mac 上面就没有这样的问题.</p>
<p>在 MacOS 上面使用的 GCC 其本质是 LLVM. 你可以在命令行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gcc -v</div></pre></td></tr></table></figure>
<p>可以看到对应的输出结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Configured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.13.sdk/usr/include/c++/4.2.1</div><div class="line">Apple LLVM version 9.0.0 (clang-900.0.37)</div><div class="line">Target: x86_64-apple-darwin16.7.0</div><div class="line">Thread model: posix</div><div class="line">InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin</div></pre></td></tr></table></figure>
<h2 id="创建共享库步骤"><a href="#创建共享库步骤" class="headerlink" title="创建共享库步骤"></a>创建共享库步骤</h2><p>[1].写源文件.这里以 C文件为基础.<br>[2].将源文件生成目标文件.<br>[3].创建共享库.<br>[4].写头文件, 供调用方使用.</p>
<p>下面结合实例来分享一下如何在 Mac 上面创建共享库.</p>
<h2 id="写源文件"><a href="#写源文件" class="headerlink" title="写源文件"></a>写源文件</h2><p>目录结构:<br><img src="/upload/images/2017/10/07/1.jpg" alt="1"></p>
<p>对应的完整代码可以看文末的附录.</p>
<h2 id="生成目标文件"><a href="#生成目标文件" class="headerlink" title="生成目标文件"></a>生成目标文件</h2><p>执行如下命令:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gcc -Wall -c -fPIC libs/eat.c libs/play.c libs/sleep.c libs/person.c</div></pre></td></tr></table></figure>
<p>注意: <code>-fPIC</code> 选项一定要加.</p>
<blockquote>
<p>PIC(position independent code), 产生位置无关码</p>
</blockquote>
<h2 id="生成共享库"><a href="#生成共享库" class="headerlink" title="生成共享库"></a>生成共享库</h2><p>这里把共享库暂且称之为 <code>libperson.so</code>.</p>
<p>执行下面命令创建:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gcc -shared -fPIC eat.o play.o sleep.o person.o -o libperson.so</div></pre></td></tr></table></figure>
<h2 id="写头文件"><a href="#写头文件" class="headerlink" title="写头文件"></a>写头文件</h2><p>这里头文件主要是 <code>person.h</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#ifndef _PERSON_H</div><div class="line">#define _PERSON_H</div><div class="line">extern void init(int pUid);</div><div class="line">extern void eat();</div><div class="line">extern void play();</div><div class="line">extern void sleep();</div><div class="line">#endif</div></pre></td></tr></table></figure>
<h2 id="使用共享库"><a href="#使用共享库" class="headerlink" title="使用共享库"></a>使用共享库</h2><p>main.c 是使用方, 编译链接即可.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gcc main.c -L. -lperson -Ilibs -o main</div></pre></td></tr></table></figure>
<p>生成可执行文件 main, 执行结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">From sharedlib.uid: 101 eating</div><div class="line">From sharedlib.uid: 101 playing</div><div class="line">From sharedlib.uid: 101 has sleep</div></pre></td></tr></table></figure>
<p><strong>注意:</strong><br>-L 选项, 告诉编译器去哪里找库文件, 这里的 _L. 表示在当前目录.</p>
<p>-lperson, 表示 libperson.so 库.</p>
<p>-Ilibs 告诉编译器头文件所在的目录.</p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p>示例完整代码</p>
<blockquote>
<p>main.c</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#include &lt;stdio.h&gt;</div><div class="line">#include &quot;person.h&quot;</div><div class="line">int main() &#123;</div><div class="line">    init(101);</div><div class="line">    eat();</div><div class="line">    play();</div><div class="line">    sleep();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>person.h</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#ifndef _PERSON_H</div><div class="line">#define _PERSON_H</div><div class="line">extern void init(int pUid);</div><div class="line">extern void eat();</div><div class="line">extern void play();</div><div class="line">extern void sleep();</div><div class="line">#endif</div></pre></td></tr></table></figure>
<blockquote>
<p>person.c</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">int uid;</div><div class="line">void init(int pUid) &#123;</div><div class="line">    uid = pUid;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>eat.c</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#include &lt;stdio.h&gt;</div><div class="line">extern int uid;</div><div class="line">void eat() &#123;</div><div class="line">    printf(&quot;From sharedlib.uid: %i eating\n&quot;, uid);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>play.c</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#include &lt;stdio.h&gt;</div><div class="line">extern int uid;</div><div class="line">void play() &#123;</div><div class="line">    printf(&quot;From sharedlib.uid: %i playing\n&quot;, uid);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>sleep.c</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#include &lt;stdio.h&gt;</div><div class="line">extern int uid;</div><div class="line">void sleep() &#123;</div><div class="line">    printf(&quot;From sharedlib.uid: %i has sleep\n&quot;, uid);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="GCC-系列博文"><a href="#GCC-系列博文" class="headerlink" title="GCC 系列博文"></a>GCC 系列博文</h2><p><a href="http://www.veryitman.com/2017/10/03/GCC-%E7%BC%96%E8%AF%91C%E8%AF%AD%E8%A8%80%E7%9A%84%E6%B5%81%E7%A8%8B/" target="_blank" rel="noopener">GCC: 编译 C 语言的流程</a></p>
<p><a href="http://www.veryitman.com/2017/10/07/GCC-Homebrew-%E5%AE%89%E8%A3%85-GCC-%E5%92%8C-Binutils/" target="_blank" rel="noopener">GCC: Homebrew 安装 GCC 和 Binutils</a></p>
<p><a href="http://www.veryitman.com/2017/10/07/GCC-%E5%85%B1%E4%BA%AB%E5%BA%93/" target="_blank" rel="noopener">GCC: 共享库</a></p>
<p><a href="http://www.veryitman.com/2017/10/08/GCC-%E9%9D%99%E6%80%81%E5%BA%93/" target="_blank" rel="noopener">GCC: 静态库</a></p>
]]></content>
      
        <categories>
            
            <category> GCC </category>
            
        </categories>
        
        
        <tags>
            
            <tag> GCC 编译器 共享库 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[GCC: Homebrew 安装 GCC 和 Binutils]]></title>
      <url>/2017/10/07/GCC-Homebrew-%E5%AE%89%E8%A3%85-GCC-%E5%92%8C-Binutils/</url>
      <content type="html"><![CDATA[<h2 id="文章背景"><a href="#文章背景" class="headerlink" title="文章背景"></a>文章背景</h2><p>前段时间, 有个博客上面的小伙伴给我发来邮件, 问我关于 GCC 相关的知识, 对于 GCC 我也只是凭着之前的了解, 回复他了.</p>
<p>这位小伙伴还在读大学, 自学能力比较强, 自己出了完成课时之外, 还会在网上找资料自学.</p>
<p>我记得自己在大学的时候, 对 GCC 一窍不通, 只知道 Turbo-C 和那些被强制记住的关键字, 哈哈!</p>
<p>最后告诉他, 我会坚持把自己以前学习过相关 GCC 的知识, 以博客的形式输出.</p>
<p>于是, 就有了 <code>GCC: 系列</code> 的文章. 希望能够帮到大家.</p>
<h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>这篇博客主要分享 MacOS 下安装 GCC 和 Binutils 工具.</p>
<p>MacOS 下输入 <code>gcc -v</code>, 其实是链接指向了 LLVM 编译器, 不是 GNU 的 GCC.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Configured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.13.sdk/usr/include/c++/4.2.1</div><div class="line">Apple LLVM version 9.0.0 (clang-900.0.37)</div><div class="line">Target: x86_64-apple-darwin16.7.0</div><div class="line">Thread model: posix</div><div class="line">InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin</div></pre></td></tr></table></figure>
<h2 id="安装-GCC"><a href="#安装-GCC" class="headerlink" title="安装 GCC"></a>安装 GCC</h2><p>关于 GCC, 可以参考 <a href="https://zh.wikipedia.org/wiki/GCC" target="_blank" rel="noopener">维基百科</a>.</p>
<p>执行下面命令, 即可开始安装:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">brew tap homebrew/versions</div><div class="line">brew install gcc49</div><div class="line">brew 会自动为你安装相关依赖, 比如</div><div class="line">gmp4, mpfr2, libmpc08, isl011, cloog018</div></pre></td></tr></table></figure>
<p>这里安装需要等待一段时间…</p>
<p>看到下面的内容, 表示安装完毕.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Pouring gcc49-4.9.2_1.yosemite.bottle.1.tar.gz</div><div class="line">/usr/local/Cellar/gcc49/4.9.2_1: 1138 files, 164M</div></pre></td></tr></table></figure>
<p>安装成功后, 安装目录在:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/Cellar/gcc49/4.9.2_1</div></pre></td></tr></table></figure>
<p>你在终端直接输入 gcc -v, 其实还是 LLVM, 那么如何使用我们 刚安装的 gcc?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/Cellar/gcc49/4.9.2_1/bin</div><div class="line">ls -l</div></pre></td></tr></table></figure>
<p>可以看到:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">c++-4.9</div><div class="line">cpp-4.9</div><div class="line">g++-4.9</div><div class="line">gcc-4.9</div><div class="line">gcc-ar-4.9</div><div class="line">gcc-nm-4.9</div><div class="line">gcc-ranlib-4.9</div><div class="line">gcov-4.9</div><div class="line">x86_64-apple-darwin14.3.0-c++-4.9</div><div class="line">x86_64-apple-darwin14.3.0-g++-4.9</div><div class="line">x86_64-apple-darwin14.3.0-gcc-4.9</div><div class="line">x86_64-apple-darwin14.3.0-gcc-4.9.2</div><div class="line">x86_64-apple-darwin14.3.0-gcc-ar-4.9</div><div class="line">x86_64-apple-darwin14.3.0-gcc-nm-4.9</div><div class="line">x86_64-apple-darwin14.3.0-gcc-ranlib-4.9</div></pre></td></tr></table></figure>
<p>Ok, 你应该明白了, 在命令行输入 <code>gcc-4.9 -v</code> 就可以使用我们刚安装的 GCC 了. 包括 g++ 工具.</p>
<p>以后使用 GNU 的 GCC 输入 <code>gcc-4.9</code> 就好了.</p>
<h2 id="安装-Binutils"><a href="#安装-Binutils" class="headerlink" title="安装 Binutils"></a>安装 Binutils</h2><p>关于 Binutils 可以参考 <a href="https://zh.wikipedia.org/zh-cn/GNU_Binutils" target="_blank" rel="noopener">维基百科</a>.</p>
<p>执行下面命令, 直接安装:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install binutils</div></pre></td></tr></table></figure>
<p>同理:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/Cellar/binutils/2.25/bin</div></pre></td></tr></table></figure>
<p>可以看到你需要的工具:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">gaddr2line</div><div class="line">gar</div><div class="line">gc++filt</div><div class="line">gcoffdump</div><div class="line">gdlltool</div><div class="line">gdllwrap</div><div class="line">gelfedit</div><div class="line">gnlmconv</div><div class="line">gnm</div><div class="line">gobjcopy</div><div class="line">gobjdump</div><div class="line">granlib</div><div class="line">greadelf</div><div class="line">gsize</div><div class="line">gsrconv</div><div class="line">gstrings</div><div class="line">gstrip</div><div class="line">gsysdump</div><div class="line">gwindmc</div><div class="line">gwindres</div></pre></td></tr></table></figure>
<h2 id="个人感受"><a href="#个人感受" class="headerlink" title="个人感受"></a>个人感受</h2><p>在 MacOS 上面, 即使安装了 GNU 的 GCC, 也没有在 Linux 上面用的那么爽, 很多 GCC 的命令选项在 MacOS 上面无法使用.</p>
<p>所以, 在 MacOS 上面编译一些 C文件, 有时候需要走一些弯路, 但是不得不承认 LLVM 是比较优秀的编译器.</p>
<h2 id="GCC-系列博文"><a href="#GCC-系列博文" class="headerlink" title="GCC 系列博文"></a>GCC 系列博文</h2><p><a href="http://www.veryitman.com/2017/10/03/GCC-%E7%BC%96%E8%AF%91C%E8%AF%AD%E8%A8%80%E7%9A%84%E6%B5%81%E7%A8%8B/" target="_blank" rel="noopener">GCC: 编译 C 语言的流程</a></p>
<p><a href="http://www.veryitman.com/2017/10/07/GCC-Homebrew-%E5%AE%89%E8%A3%85-GCC-%E5%92%8C-Binutils/" target="_blank" rel="noopener">GCC: Homebrew 安装 GCC 和 Binutils</a></p>
<p><a href="http://www.veryitman.com/2017/10/07/GCC-%E5%85%B1%E4%BA%AB%E5%BA%93/" target="_blank" rel="noopener">GCC: 共享库</a></p>
<p><a href="http://www.veryitman.com/2017/10/08/GCC-%E9%9D%99%E6%80%81%E5%BA%93/" target="_blank" rel="noopener">GCC: 静态库</a></p>
]]></content>
      
        <categories>
            
            <category> GCC </category>
            
        </categories>
        
        
        <tags>
            
            <tag> GCC C 编译器 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[GCC: 编译C语言的流程]]></title>
      <url>/2017/10/03/GCC-%E7%BC%96%E8%AF%91C%E8%AF%AD%E8%A8%80%E7%9A%84%E6%B5%81%E7%A8%8B/</url>
      <content type="html"><![CDATA[<h2 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h2><p>这篇博文 <a href="http://blog.csdn.net/veryitman/article/details/7340668" target="_blank" rel="noopener">makefile: gcc 工作流程</a> 早期被我放在 CSDN 上面过.时隔多年, 仍不能忘怀, 现乔迁至此.</p>
<p>本文比较简单, 比较适合初学者.<br>我只是试图以实例的方式给大家讲解一下 GCC 编译链接 C语言程序的流程, 并没有高深的知识.</p>
<h2 id="编译流程"><a href="#编译流程" class="headerlink" title="编译流程"></a>编译流程</h2><p>C 语言经过预处理、编译、连接最后生成可执行文件.</p>
<p>在 Linux 的 GCC 下面，看看其工作流程. 流程图如下：</p>
<p><img src="/upload/images/2017/10/03/1.jpg" alt="1"></p>
<p>预处理，将包含的 <em>.h 文件或者一些预处理语句（如 #define）处理一下，然后将 </em>.c 文件生成 *.i 的中间文件.</p>
<blockquote>
<p>注意了 GCC 不会自动生成这样一个文件，如果需要，自己加 -E 参数即可.</p>
</blockquote>
<p>编译、汇编阶段生成 *.o 目标文件，最后经过链接生成可执行文件.</p>
<blockquote>
<p>注意：可执行文件不一定是 exe 文件.</p>
</blockquote>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>下面以一个实例 hello.c，说明这个过程.</p>
<p><img src="/upload/images/2017/10/03/2.jpg" alt="1"></p>
<p>源文件很简单，这里只是为了说明问题.</p>
<p>在命令行，执行下面命令完成预处理：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gcc  -E  hello.c  -o  hello.i</div></pre></td></tr></table></figure>
<p>执行之后，你可以打开 hello.i 文件，可以看到很多 extern 以及将 MAX 解释为 20：<br><img src="/upload/images/2017/10/03/3.jpg" alt="1"></p>
<p>在命令行，执行下面命令, 完成编译阶段:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gcc  -S  hello.i  -o hello.s</div></pre></td></tr></table></figure>
<p>这时可以生成 *.s 文件，其实就是一些汇编语句，如下所示：<br><img src="/upload/images/2017/10/03/4.jpg" alt="1"></p>
<p>那麽，我们就可以进入汇编阶段了，执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gcc  -c  hello.s  -o hello.o</div></pre></td></tr></table></figure>
<p>打开这个 hello.o 文件，都是一些机器码.</p>
<p>最后一个连接生成可执行文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gcc hello.o -o hello</div></pre></td></tr></table></figure>
<p>在当前目录就可以生成 hello 这个可执行文件.</p>
<p>执行 ./hello，就会输出：<br><img src="/upload/images/2017/10/03/5.jpg" alt="1"></p>
<p>到此，GCC 编译连接生成可执行文件完毕！</p>
<p>当前目录下面的文件：<br><img src="/upload/images/2017/10/03/6.jpg" alt="1"></p>
<p>以上的步骤，其实一句命令即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gcc  hello.c  -o  hello</div></pre></td></tr></table></figure>
<p>此时目录内容如下：<br><img src="/upload/images/2017/10/03/7.jpg" alt="1"></p>
<p>自己动手感受一下，你会收获更多！</p>
<h2 id="GCC-系列博文"><a href="#GCC-系列博文" class="headerlink" title="GCC 系列博文"></a>GCC 系列博文</h2><p><a href="http://www.veryitman.com/2017/10/03/GCC-%E7%BC%96%E8%AF%91C%E8%AF%AD%E8%A8%80%E7%9A%84%E6%B5%81%E7%A8%8B/" target="_blank" rel="noopener">GCC: 编译 C 语言的流程</a></p>
<p><a href="http://www.veryitman.com/2017/10/07/GCC-Homebrew-%E5%AE%89%E8%A3%85-GCC-%E5%92%8C-Binutils/" target="_blank" rel="noopener">GCC: Homebrew 安装 GCC 和 Binutils</a></p>
<p><a href="http://www.veryitman.com/2017/10/07/GCC-%E5%85%B1%E4%BA%AB%E5%BA%93/" target="_blank" rel="noopener">GCC: 共享库</a></p>
<p><a href="http://www.veryitman.com/2017/10/08/GCC-%E9%9D%99%E6%80%81%E5%BA%93/" target="_blank" rel="noopener">GCC: 静态库</a></p>
]]></content>
      
        <categories>
            
            <category> GCC </category>
            
        </categories>
        
        
        <tags>
            
            <tag> GCC C 编译器 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS APNs: 处理数据]]></title>
      <url>/2017/08/07/iOS-APNs-%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE/</url>
      <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>博文:<br><em>iOS 细说推送: 远程推送<br>iOS 细说推送: 本地推送</em></p>
<p>分别介绍了 iOS 的两种典型推送, 当然, iOS 还有很多类型的推送, 如静默推送, VOIP 推送(iOS8)等, 后面会慢慢介绍给大家.</p>
<p>今天跟大家聊聊关于如何处理推送的数据(payload).</p>
<p>该系列博客:</p>
<blockquote>
<p><a href="http://www.veryitman.com/2017/08/06/iOS-APNs-%E8%BF%9C%E7%A8%8B%E6%8E%A8%E9%80%81/" target="_blank" rel="noopener">iOS APNs: 远程推送</a><br><a href="http://www.veryitman.com/2017/08/06/iOS-APNs-%E6%9C%AC%E5%9C%B0%E6%8E%A8%E9%80%81/" target="_blank" rel="noopener">iOS APNs: 本地推送</a><br>iOS APNs: 处理数据(本篇)<br><a href="http://www.veryitman.com/2018/02/06/iOS-APNs-%E9%9D%99%E9%BB%98%E6%8E%A8%E9%80%81/" target="_blank" rel="noopener">iOS APNs: 静默推送</a><br><a href="http://www.veryitman.com/2018/02/08/iOS-APNs-Background-Fetch/" target="_blank" rel="noopener">iOS APNs: Background Fetch</a></p>
</blockquote>
<h2 id="推送的代理回调时机"><a href="#推送的代理回调时机" class="headerlink" title="推送的代理回调时机"></a>推送的代理回调时机</h2><p>还记得 AppDelegate 里面关于推送的几个代理方法吧.<br>~ 估计你也忘记了, 没关系, 我们再一起整理一下.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo &#123;</div><div class="line">    </div><div class="line">    MZLOG(@&quot;markApp push. RemotePush userInfo: %@&quot;, userInfo);</div><div class="line">    </div><div class="line">    // 可以根据推送内容决定下一步的行为</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>该方法在接收到 RemotePush 的时候, 调用时机:</p>
<p>1.APP 在前台运行的, RemotePush 被推送过来了.<br>2.APP 在后台运行, 无论是否被挂起只要没有被杀死, 点击推送内容.</p>
<p>以上两种情况均可以进入 didReceiveRemoteNotification 方法.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (void)application:(UIApplication *)application didReceiveLocalNotification:(UILocalNotification *)notification &#123;</div><div class="line">    </div><div class="line">    MZLOG(@&quot;App push. LocalPush notification: %@&quot;, notification);</div><div class="line">    </div><div class="line">    // 可以根据推送内容决定下一步的行为</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>该方法接收到 LocalPush 的时候, 调用时机:</p>
<p>1.APP 在前台运行的, LocalPush 被推送过来了.<br>2.APP 在后台运行, 无论是否被挂起只要没有被杀死, 点击推送内容.</p>
<p>以上两种情况均可以进入 didReceiveLocalNotification 方法.</p>
<p>这两个回调方法, 分别接收 RemotePush 和 LocalPush 的推送消息.</p>
<p>有些人会问了, 假如这个时候我的应用在后台, 被系统杀死了或者被用户双击 Home 键杀死了, 此时远程推送过来了, 或者状态栏里面有本地推送的消息, 我点击推送消息, 这两个方法会被调用吗?</p>
<p>类似这种效果, 上面是 RemotePush, 下面是 LocalPush.</p>
<p><img src="/upload/images/2017/08/07/1.jpg" alt="1"></p>
<p>我肯定的告诉大家, 应用被杀死的情况下, 点击推送内容, didReceiveRemoteNotification 和 didReceiveLocalNotification 都不会被调用.</p>
<p>这个时候, AppDelegate 中的另一个方法上场了.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (BOOL)application:(UIApplication *)application </div><div class="line">	didFinishLaunchingWithOptions:(NSDictionary *)launchOptions</div></pre></td></tr></table></figure>
<p>看一下 didFinishLaunchingWithOptions 的具体实现, 示例代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123;</div><div class="line">    </div><div class="line">    /// 将应用图标的 badge 清零</div><div class="line">    &#123;</div><div class="line">        [[UIApplication sharedApplication] setApplicationIconBadgeNumber:1];</div><div class="line">        [[UIApplication sharedApplication] setApplicationIconBadgeNumber:0];</div><div class="line">        [[UIApplication sharedApplication] cancelAllLocalNotifications];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    if (nil != launchOptions) &#123;</div><div class="line">        /// 处理 LocalPush</div><div class="line">        &#123;</div><div class="line">            // 这里可以得到 UILocalNotification 对象</div><div class="line">            id localPushNotify = [launchOptions objectForKey:UIApplicationLaunchOptionsLocalNotificationKey];</div><div class="line">            </div><div class="line">            MZLOG(@&quot;AppDelegate localPush: %@&quot;, localPushNotify);</div><div class="line">            </div><div class="line">            if (nil != localPushNotify) &#123;</div><div class="line">                if ([localPushNotify isKindOfClass:[UILocalNotification class]]) &#123;</div><div class="line">                    // 获取 userinfo 数据</div><div class="line">                    NSDictionary *userInfo = [(UILocalNotification *)localPushNotify userInfo];</div><div class="line">                    MZLOG(@&quot;AppDelegate localPush of UILocalNotification: %@&quot;, userInfo);</div><div class="line">                    </div><div class="line">                    // 根据 userInfo 的内容处理如页面跳转等</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        /// 处理 RemotePush</div><div class="line">        &#123;</div><div class="line">            NSDictionary *remotePushNotify = [launchOptions objectForKey:UIApplicationLaunchOptionsRemoteNotificationKey];</div><div class="line">            MZLOG(@&quot;AppDelegate remotePush: %@&quot;, remotePushNotify);</div><div class="line">            </div><div class="line">            if (nil != remotePushNotify) &#123;</div><div class="line">                NSDictionary *remoteAps = [remotePushNotify objectForKey:@&quot;aps&quot;];</div><div class="line">                MZLOG(@&quot;AppDelegate remotePush. The aps&apos; info, alert: %@, badge: %@, sound: %@&quot;,</div><div class="line">                      [remoteAps objectForKey:@&quot;alert&quot;],</div><div class="line">                      [remoteAps objectForKey:@&quot;badge&quot;], [remoteAps objectForKey:@&quot;sound&quot;]);</div><div class="line">				// 根据推送的内容处理如页面跳转等</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    MZLOG(@&quot;AppDelegate. launchOptions: %@&quot;, launchOptions);</div><div class="line">    </div><div class="line">    return YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对应的打印输出内容, 如下</p>
<p>本地推送的内容:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> AppDelegate localPush of UILocalNotification: &#123;</div><div class="line">    &quot;user_info_key&quot; = &quot;user_info_value_json_str&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>远程推送的内容:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">aps = &#123;</div><div class="line">			alert = &quot;Testing.. (2)&quot;;</div><div class="line">			badge = 1;</div><div class="line">			sound = default;</div><div class="line">      &#125;;</div><div class="line">            </div><div class="line">The aps&apos; info, alert: Testing.. (19), badge: 1, sound: default</div></pre></td></tr></table></figure>
<h2 id="自定义推送内容"><a href="#自定义推送内容" class="headerlink" title="自定义推送内容"></a>自定义推送内容</h2><blockquote>
<p>对于推送的数据格式, 是苹果规定的格式, 我们可以在其基础上添加我们需要的数据.</p>
</blockquote>
<p>在介绍下面内容之前, 先了解一下什么是 payload.</p>
<blockquote>
<p>payload 是推送通知的一部分，每一条推送通知都包含一个 Payload.<br>它包含了系统提醒用户通知到达的方式，还可以添加自定义的数据, 即通知主要传递的数据为 payload.</p>
<p>Payload 本身为 JSON 格式的字符串，它内部必须要包含一个键为 aps 的字典.也就是说 payload 是整个字符串.</p>
</blockquote>
<p>关于 payload 的限制</p>
<p>在早期的推送中, payload 不能超过 256bytes, 中间还经历过推送的 payload 最大为 2KB.<br>现在苹果支持最大为5KB(VOIP 推送), 官方文档有说, 如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">For regular remote notifications, the maximum size is 4KB (4096 bytes)</div><div class="line">For Voice over Internet Protocol (VoIP) notifications, the maximum size is 5KB (5120 bytes)</div><div class="line">NOTE</div><div class="line">If you are using the legacy APNs binary interface to send notifications instead of an HTTP/2 request, the maximum payload size is 2KB (2048 bytes)</div></pre></td></tr></table></figure>
<p>上面是 <a href="https://developer.apple.com/library/content/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/CreatingtheNotificationPayload.html#//apple_ref/doc/uid/TP40008194-CH10-SW1" target="_blank" rel="noopener">官方文档</a> 的原文, 大概意思是:</p>
<blockquote>
<p>现在 APNs 支持 payload 为 4KB, 如果是 VoIP 推送的话, 支持 5KB. 但是, 如果你使用传统的 APNs 而不是使用 HTTP/2 的话, 最大支持 2KB. 也就是说, 推送的 payload 大小和 iOS 系统无关, 而是和协议有关.</p>
</blockquote>
<p>可以使用下面代码, 查看 payload 长度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">payload.getBytes().length</div></pre></td></tr></table></figure>
<p>我们正常的推送内容是这样的, 正常格式:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&quot;aps&quot;:&#123;&quot;alert&quot;:&quot;Testing.. (21)&quot;,&quot;badge&quot;:1,&quot;sound&quot;:&quot;default&quot;&#125;&#125;</div></pre></td></tr></table></figure>
<p>如果想对推送内容做自定义, 可以自己添加额外的数据, 如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&quot;aps&quot;:&#123;&quot;alert&quot;:&quot;Testing.. (21)&quot;,&quot;badge&quot;:1,&quot;sound&quot;:&quot;default&quot;&#125;, &quot;ext&quot;:&#123;&quot;key&quot;:&quot;value&quot;&#125;&#125;</div></pre></td></tr></table></figure>
<p>其中, ext 就是额外添加的数据模型.</p>
<p>在 APP 收到这样的数据模型时, 可以对应不同的行为.</p>
<p>大家可以根据自己的业务需求, 自行定义数据格式.</p>
<p>自定义的数据格式, 注意内容的长度, 在不同的 iOS 系统上面, 对于推送的内容是有长度限制的.</p>
<h2 id="再唠叨几句"><a href="#再唠叨几句" class="headerlink" title="再唠叨几句"></a>再唠叨几句</h2><p>关于 iOS7 以后添加的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (void)application:(UIApplication *)application </div><div class="line">	didReceiveRemoteNotification:(NSDictionary *)userInfo </div><div class="line">	fetchCompletionHandler:(void (^)(UIBackgroundFetchResult))completionHandler</div></pre></td></tr></table></figure>
<p>这个方法也是在 AppDelegate 中实现的.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (void)application:(UIApplication *)application </div><div class="line">	didReceiveRemoteNotification:(NSDictionary *)userInfo</div></pre></td></tr></table></figure>
<p>这个方法在 iOS3 就已经有了, 可谓是历史悠久.我姑且称之为该方法为 FatherMethod, 上面那个新加入的称之为 SonMethod.</p>
<p><strong>注意事项:</strong></p>
<p>[1]. 实现了 FatherMethod, 即使你实现了 SonMethod, SonMethod 也不会被调用.<br>[2]. SonMethod 比 FatherMethod 多了一个参数 completionHandler, 这个在后面会说到.主要用于 Background Mode 中的 Background Fetch.<br>[3]. 推送被调用的时机, 除了 FatherMethod 的时机外, 还多了一种时机, 就是在 APP 被杀死后, 点击推送内容打开 APP, 此时 APP 再次回到前台的时候, 该方法也会被调用(didFinishLaunchingWithOptions也会调用), 所以在处理远程推送内容的时候, 要注意这一点.</p>
<p>针对注意事项[3], 目前我能给出的有两种解决方案:</p>
<p>第一, 判断是否是第一次启动 APP, 如果是第一次启动 APP, 统一在didFinishLaunchingWithOptions 中处理, 不在 SonMethod 中处理.</p>
<p>第二, 远程推送统一在 SonMethod 中处理, didFinishLaunchingWithOptions 中只处理在 APP 被杀死的情况下, 用户点击推送本地的内容.</p>
<p>我个人采用的是第二中方案.</p>
<h2 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h2><p>在推送工具 NWPusher 和 Xcode 的 Window/Devices/Console 帮助下, 才得以完善博文.</p>
<p>NWPusher 用来发送推送内容.</p>
<p>Window/Devices/Console 用于查看输出日志.</p>
<h2 id="必看文档"><a href="#必看文档" class="headerlink" title="必看文档"></a>必看文档</h2><p><a href="https://developer.apple.com/library/content/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/CreatingtheNotificationPayload.html#//apple_ref/doc/uid/TP40008194-CH10-SW1" target="_blank" rel="noopener">Creating the Remote Notification Payload</a></p>
<p><a href="https://developer.apple.com/library/content/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/PayloadKeyReference.html#//apple_ref/doc/uid/TP40008194-CH17-SW1" target="_blank" rel="noopener">Payload Key Reference</a></p>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> APNs 推送 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS APNs: 本地推送]]></title>
      <url>/2017/08/06/iOS-APNs-%E6%9C%AC%E5%9C%B0%E6%8E%A8%E9%80%81/</url>
      <content type="html"><![CDATA[<h2 id="概括"><a href="#概括" class="headerlink" title="概括"></a>概括</h2><p><code>iOS APNs: 远程推送</code> 说过远程推送(RemotePush).</p>
<p>今天说说本地推送, 本地推送也就是平时所说的 LocalPush.</p>
<p>该系列博客:</p>
<blockquote>
<ul>
<li><a href="http://www.veryitman.com/2017/08/06/iOS-APNs-%E8%BF%9C%E7%A8%8B%E6%8E%A8%E9%80%81/" target="_blank" rel="noopener">iOS APNs: 远程推送</a></li>
<li>iOS APNs: 本地推送(本篇)</li>
<li><a href="http://www.veryitman.com/2017/08/07/iOS-APNs-%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE/" target="_blank" rel="noopener">iOS APNs: 处理数据</a></li>
<li><a href="http://www.veryitman.com/2018/02/06/iOS-APNs-%E9%9D%99%E9%BB%98%E6%8E%A8%E9%80%81/" target="_blank" rel="noopener">iOS APNs: 静默推送</a></li>
<li><a href="http://www.veryitman.com/2018/02/08/iOS-APNs-Background-Fetch/" target="_blank" rel="noopener">iOS APNs: Background Fetch</a></li>
</ul>
</blockquote>
<h2 id="业务场景"><a href="#业务场景" class="headerlink" title="业务场景"></a>业务场景</h2><p>在具体实现之前, 先说一下业务场景.</p>
<p>假如你的 APP 具有 IM(即时通讯) 功能, 这个时候, 你可以根据连接来判断用户是否在线, 如果不在线, 可以使用远程推送将推送内容告知用户.如果在线, 可以通过 IM 把内容告诉 APP, APP 收到这个消息后, 可以使用本地推送告知给用户.</p>
<p>据说 APNs 每天要处理的推送在亿级别, 所以如果可以使用 LocalPush 完成的业务, 我建议大家还是不要使用远程推送, 况且苹果并不一定保证远程推送一定成功, 如果网络或者 APNs 压力大, 推送也会延时.</p>
<p>给苹果减少点压力吧, 哈哈!</p>
<p>再说一个业务场景, 你的 APP 在后台运行时间快到要被系统挂起的时候了, 你可以发送一个 LocalPush 来提示用户或者刺激用户, 再次将 APP 拉回前台运行. 这样可以保证 APP 可以正常运行了.</p>
<p>上面说的第二个业务场景, 是今天例子的基础, 你也可以根据自己的实际业务场景来使用 LocalPush 功能.</p>
<h2 id="LocalPush-简介"><a href="#LocalPush-简介" class="headerlink" title="LocalPush 简介"></a>LocalPush 简介</h2><p>LocalPush 允许 APP 向用户发送通知, 对于用户来说, 就跟远程推送是一样的, 基本没有感知, 开发者也不希望用户有感知.</p>
<p>推送效果图:</p>
<p><img src="/upload/images/2017/08/06/1.png" alt="1"></p>
<blockquote>
<p>注意: 如果你的 APP 在前台, 发送 LocalPush 是不会要上述效果的.<br>如果在前台, 可以使用自定义的弹框来提示用户.</p>
</blockquote>
<p>LocalPush 同样需要用户授权推送的权限, 否则也无法发送成功.这个跟远程推送是一样的.</p>
<p>另外, LocalPush 需要 APP 在后台没有被挂起的情况下, 才能发送, 否则无法启用.</p>
<p>发送 LocalPush 的一个好处是不需要用户连接网络, 这个是区别于远程推送的, 因为远程推送必须要求用户连接网络的.很多单机游戏或者弱联网的游戏, 发送的推送都是 LocalPush, 而非远程推送.</p>
<p>在阅读下面内容之前, 建议大家先看看 iOS 后台模式 这篇文章.本篇也是基于这个为基础的.</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>这个示例, 实现的场景如下:</p>
<p>用户打开 APP, 授权了推送的权限, 用户试玩一会之后, 将 APP 退到了后台, APP 监听退到后台之后, 延时一定时间发送 LocalPush 给用户.</p>
<p>AppDelegate.m 中使用后台模式</p>
<p>关于 MZBackgroundTask 的实现, 附录给出.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (void)applicationDidEnterBackground:(UIApplication *)application &#123;</div><div class="line">    </div><div class="line">    [[MZBackgroundTask sharedTask] startTask];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>ViewController.m</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    </div><div class="line">    [super viewDidLoad];</div><div class="line">    </div><div class="line">    [[NSNotificationCenter defaultCenter] addObserver:self</div><div class="line">                                             selector:@selector(onDidEnterBackground:)</div><div class="line">                                                 name:UIApplicationDidEnterBackgroundNotification</div><div class="line">                                               object:nil];</div><div class="line">&#125;</div><div class="line">- (void)onDidEnterBackground:(NSNotification *)notification &#123;</div><div class="line">    </div><div class="line">    MZLOG(@&quot;App Background. Enter onDidEnterBackground.&quot;);</div><div class="line">    </div><div class="line">    // 等待 6s 后, 这个时间可以根据具体情况去修改, 这里只是模拟</div><div class="line">    int delta = 6;</div><div class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(delta * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</div><div class="line">        </div><div class="line">        MZLOG(@&quot;App Background. Enter onDidEnterBackground diapatch.&quot;);</div><div class="line">        </div><div class="line">        if (UIApplicationStateBackground == [UIApplication sharedApplication].applicationState) &#123;</div><div class="line">            UILocalNotification *notification = [UILocalNotification new];</div><div class="line">            notification.alertBody = @&quot;走, 去high吧!&quot;;</div><div class="line">            notification.soundName = UILocalNotificationDefaultSoundName;</div><div class="line">            // 应用图标上面显示的数字</div><div class="line">            notification.applicationIconBadgeNumber = notification.applicationIconBadgeNumber + 1;</div><div class="line">            // 可以自定义数据</div><div class="line">            notification.userInfo = @&#123;@&quot;user_info_key&quot;: @&quot;user_info_value_json_str&quot;&#125;;</div><div class="line">            </div><div class="line">            [[UIApplication sharedApplication] scheduleLocalNotification:notification];</div><div class="line">        &#125;</div><div class="line">        else &#123;</div><div class="line">        	// 显示自定义弹框等</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>将 APP 点击 Home 键退到后台, 6s 后可以看到推送的效果.</p>
<p>点击推送的提示框, 再次打开了 APP, 会执行 AppDelegate 中的方法, 如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (void)application:(UIApplication *)application didReceiveLocalNotification:(UILocalNotification *)notification &#123;</div><div class="line">    </div><div class="line">    MZLOG(@&quot;App push. notification: %@&quot;, notification);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>打印出来的 notification, 如下图所示:</p>
<p><img src="/upload/images/2017/08/06/2.jpg" alt="1"></p>
<p>其中, user_info 是我们自定义的数据部分.</p>
<p>附录</p>
<blockquote>
<p>MZBackgroundTask 实现</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line">#import &quot;MZBackgroundTask.h&quot;</div><div class="line"></div><div class="line">@implementation MZBackgroundTask</div><div class="line"></div><div class="line">+ (instancetype)sharedTask &#123;</div><div class="line">    </div><div class="line">    static MZBackgroundTask *_task;</div><div class="line">    static dispatch_once_t onceToken;</div><div class="line">    dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">        _task = [[self alloc] init];</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    return _task;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)startTask &#123;</div><div class="line">    </div><div class="line">    if (![self _checkSupportBackgroundTask]) &#123;</div><div class="line">        MZLOG(@&quot;BackgroundTask. Current device don&apos;t support backgroundTask.&quot;);</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    UIApplication *application = [UIApplication sharedApplication];</div><div class="line">    </div><div class="line">    __block UIBackgroundTaskIdentifier taskId;</div><div class="line">    </div><div class="line">    /// 申请后台执行</div><div class="line">    /// 注意: 在iOS7和该版本前，后台可以用下面的的方式在后台存活5-10分钟，在iOS8及后，最多存活3分钟</div><div class="line">    &#123;</div><div class="line">        taskId = [application beginBackgroundTaskWithName:NSStringFromClass([self class]) expirationHandler:^&#123;</div><div class="line">            </div><div class="line">            MZLOG(@&quot;BackgroundTask. BackgroundTask is Over. The remained time: %f&quot;, application.backgroundTimeRemaining);</div><div class="line">            </div><div class="line">            [application endBackgroundTask:taskId];</div><div class="line">            </div><div class="line">            taskId = UIBackgroundTaskInvalid;</div><div class="line">        &#125;];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    if (UIBackgroundTaskInvalid == taskId) &#123;</div><div class="line">        </div><div class="line">        MZLOG(@&quot;BackgroundTask. Apply backgroundTask failed.&quot;);</div><div class="line">        </div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /// 可以监控后台任务剩余的时间, 针对业务可以去处理</div><div class="line">    &#123;</div><div class="line">        dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</div><div class="line">            </div><div class="line">            while (true) &#123;</div><div class="line">                // 剩余可以后台执行的时间</div><div class="line">                NSTimeInterval remainedTime = application.backgroundTimeRemaining;</div><div class="line">                MZLOG(@&quot;BackgroundTask. The remained time: %f&quot;, remainedTime);</div><div class="line">                </div><div class="line">                if (remainedTime &lt; 2) &#123;</div><div class="line">                    // 可以告诉其他业务, 后台任务即将结束了</div><div class="line">                    break;</div><div class="line">                &#125;</div><div class="line">                </div><div class="line">                // 睡眠(延时)1s</div><div class="line">                [NSThread sleepForTimeInterval:1.f];</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            /// 这里可以做一些清除工作</div><div class="line">            &#123;</div><div class="line">                // clean up</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            [application endBackgroundTask:taskId];</div><div class="line">            </div><div class="line">            taskId = UIBackgroundTaskInvalid;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark - Private.</div><div class="line"></div><div class="line">/**</div><div class="line"> *  当前设备是否支持后台任务.</div><div class="line"> *</div><div class="line"> *  @return YES, 支持后台任务. 否则, 不支持后台任务.</div><div class="line"> */</div><div class="line">- (BOOL)_checkSupportBackgroundTask &#123;</div><div class="line">    </div><div class="line">    SEL sel = @selector(isMultitaskingSupported);</div><div class="line">    BOOL supportBTask = [[UIDevice currentDevice] respondsToSelector:sel];</div><div class="line">    </div><div class="line">    return supportBTask;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> APNs 远程推送 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS APNs: 远程推送]]></title>
      <url>/2017/08/06/iOS-APNs-%E8%BF%9C%E7%A8%8B%E6%8E%A8%E9%80%81/</url>
      <content type="html"><![CDATA[<h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>本篇博文, 你首先需要知道的内容:</p>
<blockquote>
<p>1.了解过 Push.<br>2.阅读过 [iOS 后台模式] 这篇文章.<br>3.申请过苹果证书或者知道如何申请和制作证书.<br>4.iOS 开发基本知识.</p>
</blockquote>
<p>你在这篇博文将会学到:</p>
<blockquote>
<p>1.Push 的发展历程.<br>2.开源推送工具 NWPusher 的使用.<br>3.Push 的基本原理.</p>
</blockquote>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>APNs, 苹果推送通知服务. 全称是: Apple Push Notification Service.</p>
<p>推送指的是由 APNs 服务器、ProviderService、iOS 系统、App 构成的通讯系统，也是移动互联网与传统的 Web 最明显不同的.</p>
<p>官方有比较详细的文档介绍, 可以戳这里 <a href="https://developer.apple.com/library/content/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/APNSOverview.html#//apple_ref/doc/uid/TP40008194-CH8-SW1" target="_blank" rel="noopener">官方文档</a> 查看.</p>
<p>苹果的文档写的确实好, 但是作为程序员, 最重要的还是要结合理论去实践.</p>
<p>本篇结合自己的实践和对推送的理解, 跟大家分享一下推送相关的知识.</p>
<h2 id="Push-发展历程"><a href="#Push-发展历程" class="headerlink" title="Push 发展历程"></a>Push 发展历程</h2><p>iOS 历经很多版本, 一直在优化或者说是进化推送相关的内容, 无论是从实用性和技术上来看, 推送是至关重要的.</p>
<p>看一下 push 发展历程</p>
<ul>
<li><p>iOS 3 - 引入推送通知 UIApplication 的 registerForRemoteNotificationTypes 与 UIApplicationDelegate 的 application(:didRegisterForRemoteNotificationsWithDeviceToken:)，application(:didReceiveRemoteNotification:)</p>
</li>
<li><p>iOS 4 - 引入本地通知 scheduleLocalNotification，presentLocalNotificationNow:， application(_:didReceive:)</p>
</li>
<li><p>iOS 5 - 加入通知中心页面</p>
</li>
<li><p>iOS 6 - 通知中心页面与 iCloud 同步</p>
</li>
<li><p>iOS 7 - 后台静默推送 application(_:didReceiveRemoteNotification:fetchCompletionHandle:)</p>
</li>
<li><p>iOS 8 - 重新设计 notification 权限请求，Actionable 通知 registerUserNotificationSettings(:)，UIUserNotificationAction 与 UIUserNotificationCategory，application(:handleActionWithIdentifier:forRemoteNotification:completionHandler:) 等</p>
</li>
<li><p>iOS 9 - Text Input action，基于 HTTP/2 的推送请求 UIUserNotificationActionBehavior，全新的 Provider API 等</p>
</li>
<li><p>iOS 10- 支持Images, GIFs, Audio and Video类型, 并且有 Notification Service Extension 与 Notification Content Extension，可以实现推送数据在展示前进行下载更新、定制通知 UI, 并且统一了通知类型，具有时间间隔通知、地理位置通知和日历通知.</p>
</li>
</ul>
<p>该系列博客共分为几个部分:</p>
<ul>
<li>iOS APNs: 远程推送(本篇)</li>
<li><a href="http://www.veryitman.com/2017/08/06/iOS-APNs-%E6%9C%AC%E5%9C%B0%E6%8E%A8%E9%80%81/" target="_blank" rel="noopener">iOS APNs: 本地推送</a></li>
<li><a href="http://www.veryitman.com/2017/08/07/iOS-APNs-%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE/" target="_blank" rel="noopener">iOS APNs: 处理数据</a></li>
<li><a href="http://www.veryitman.com/2018/02/06/iOS-APNs-%E9%9D%99%E9%BB%98%E6%8E%A8%E9%80%81/" target="_blank" rel="noopener">iOS APNs: 静默推送</a></li>
<li><a href="http://www.veryitman.com/2018/02/08/iOS-APNs-Background-Fetch/" target="_blank" rel="noopener">iOS APNs: Background Fetch</a></li>
</ul>
<p>如果需要完整源码的, 可以通过邮件联系我(veritman@126.com), 后续完成后会上传到 github.</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>先看官方的流程图, 如下所示:</p>
<p><img src="/upload/images/2017/08/05/1.jpg" alt="1"></p>
<p>该流程图, 主要说明的是自己 业务服务器(Provider) 推送消息到用户(Client APP) 的流程.</p>
<p>注意: 这里说的以及本文后面说的 业务服务器, 统一指的是可以向 APNs 发送推送消息的服务器.</p>
<p>下面这张图是比较完整的一张流程图, 自己画的, 凑合看吧!</p>
<p><img src="/upload/images/2017/08/05/2.jpg" alt="1"></p>
<p>大概流程, 我详细说一下.</p>
<p>1.iOS 设备启动后连接网络, 会与苹果服务器建立一个安全的长连接.<br>这个是系统维护的, 这也是推送的关键.<br>2.用户打开 app, 授权了推送通知的权限.<br>3.授权成功后, APNs 会将 deviceToken 返回给 iOS 终端.<br>4.终端将该 deviceToken 返回给指定的 APP.<br>5.APP 拿到 deviceToken 上传给我们自己的业务服务器.<br>6.业务服务器向 APNs 发送推送请求, 带上 deviceToken.<br>7.APNs 推送内容到指定的 iOS 终端.<br>8.iOS 终端将内容推送给用户.</p>
<p>关于 deviceToken 后面会讲.</p>
<h2 id="关于-deviceToken"><a href="#关于-deviceToken" class="headerlink" title="关于 deviceToken"></a>关于 deviceToken</h2><p>这里简单介绍一下 deviceToken.</p>
<blockquote>
<p>deviceToken 是 NSData 类型的数据, 是苹果服务器根据 设备,证书等信息和一定算法生成的.<br>需要将这个 deviceToken 传送给我们的服务器端, 这样一个用户对象就绑定了一个 deviceToken.<br>当需要给用户推送消息, 通过自己的业务服务器, 找用户对应的 deviceToken 和要发送的推送内容, 发送到苹果的 APNs, 然后 APNs 将消息推送到该 deviceToken 对应的手机上.</p>
</blockquote>
<p>关于 deviceToken 是否可变的问题</p>
<p>网上有些人说, deviceToken 是可变的, 有些人说, deviceToken 是不可变的, 我也不知道他们到底有没有实践过, 今天我要告诉大家的是, deviceToken 是可变的.</p>
<p>如卸载重装 app, deviceToken 会变. 我的设备 iphone6, iOS10.3.</p>
<p>下面是我实验的数据:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">第一次安装运行得到的 deviceToken</div><div class="line"></div><div class="line">&lt;4e0f2928 5be0700c=&quot;&quot; 296bf7f1=&quot;&quot; 3b0837e4=&quot;&quot; bc9da6d1=&quot;&quot; 9fdb672e=&quot;&quot; f87446be=&quot;&quot; 1c098431=&quot;&quot;&gt;</div><div class="line">卸载后, 第一次安装运行得到的 deviceToken</div></pre></td></tr></table></figure>
<p>这说明, deviceToken 是可变的.</p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><p>上面基本都是一些理论知识, 下面结合代码, 具体实现.</p>
<h3 id="工程配置"><a href="#工程配置" class="headerlink" title="工程配置"></a>工程配置</h3><p>在写代码之前, 需要配置一下工程.关于如何创建带有 push 功能的苹果证书的操作, 大家自行去网上学习, 这里不赘述.</p>
<p>不过这里要提醒一点, 创建的证书一定要和自己项目的 appid 保持一致, 否则无法推送.</p>
<p>这个 Demo 工程的名字是 MZPush.</p>
<p>安装好证书, 打开工程, 并能让工程识别到.</p>
<p>切换到 Target, 点击 Capabilities 选项.</p>
<p>步骤1: 配置 Push, 打开开关即可.</p>
<p><img src="/upload/images/2017/08/05/3.jpg" alt="1"></p>
<p>配置后台模式, 打开开关, 选中Remote notifications.</p>
<p><img src="/upload/images/2017/08/05/4.jpg" alt="1"></p>
<p>不过这一步, 不是必须的, 如果你不配置, 工程会有警告.我建议是选上, 在后面的博文中, 再仔细说说这个东西的好处.</p>
<p>警告信息如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">You&apos;ve implemented -[&lt;UIApplicationDelegate&gt; application:didReceiveRemoteNotification:fetchCompletionHandler:], </div><div class="line">but you still need to add &quot;remote-notification&quot; to the list of your supported UIBackgroundModes in your Info.plist.</div></pre></td></tr></table></figure>
<p>步骤2: 配置完这一步后,在 Info.plist 中可以看到多了一项内容:</p>
<p><img src="/upload/images/2017/08/05/5.jpg" alt="1"></p>
<p>步骤3: 配置工程最小兼容版本</p>
<p><img src="/upload/images/2017/08/05/6.jpg" alt="1"></p>
<p>因为我要兼容 iOS7, 所以在 Xcode8 中, 自己手动改为了 7.0.</p>
<p>步骤4: 关闭 Bitcode(可选操作)</p>
<p><img src="/upload/images/2017/08/05/7.jpg" alt="1"></p>
<p>步骤5: 配置支持 HTTP(可选操作)</p>
<p>在 Info.plist 中, 添加如下:</p>
<p><img src="/upload/images/2017/08/05/8.jpg" alt="1"></p>
<h3 id="用户授权"><a href="#用户授权" class="headerlink" title="用户授权"></a>用户授权</h3><p>询问用户授权的实现</p>
<p>该实现兼容了 iOS7.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">+ (void)applyPushPermission &#123;</div><div class="line">    </div><div class="line">    UIApplication *application = [UIApplication sharedApplication];</div><div class="line">    </div><div class="line">    if (MZSysVersion &lt;= 7.0) &#123;</div><div class="line">        UIRemoteNotificationType nType = UIRemoteNotificationTypeAlert|UIRemoteNotificationTypeBadge|UIRemoteNotificationTypeSound;</div><div class="line">        [application registerForRemoteNotificationTypes:nType];</div><div class="line">    &#125;</div><div class="line">    else &#123;</div><div class="line">        UIUserNotificationType nType =  UIUserNotificationTypeBadge|UIUserNotificationTypeSound|UIUserNotificationTypeAlert;</div><div class="line">        UIUserNotificationSettings *nSettings = [UIUserNotificationSettings settingsForTypes:nType categories:nil];</div><div class="line">        [application registerUserNotificationSettings:nSettings];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>关于用户授权, 分几种情况来看待.</p>
<p>情景一. 用户不允许 APP 推送, 即不授权.</p>
<p>Appdelegate 代理调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (void)application:(UIApplication *)application didRegisterUserNotificationSettings:(UIUserNotificationSettings *)notificationSettings &#123;</div><div class="line">    </div><div class="line">    MZLOG(@&quot;App push. notificationSettings: %@&quot;, notificationSettings);</div><div class="line">    </div><div class="line">    [application registerForRemoteNotifications];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (void)application:(UIApplication *)application didFailToRegisterForRemoteNotificationsWithError:(NSError *)error</div></pre></td></tr></table></figure>
<p>error 信息大概如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Error Domain=NSCocoaErrorDomain Code=3000 &quot;未找到应用程序的“aps-environment”的授权字符串&quot;</div><div class="line">UserInfo=&#123;NSLocalizedDescription=未找到应用程序的“aps-environment”的授权字符串&#125;</div></pre></td></tr></table></figure>
<p>情景二. 用户允许授权了, 又分为两种情况</p>
<p>1.使用具有 push 功能的证书</p>
<p>一定要有带有 push 功能的证书.</p>
<p>代理调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (void)application:(UIApplication *)application didRegisterUserNotificationSettings:(UIUserNotificationSettings *)notificationSettings &#123;</div><div class="line">    </div><div class="line">    MZLOG(@&quot;App push. notificationSettings: %@&quot;, notificationSettings);</div><div class="line">    </div><div class="line">    [application registerForRemoteNotifications];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个方法大概在上面回调 1s 后才会调用.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">- (void)application:(UIApplication *)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken &#123;</div><div class="line">    </div><div class="line">    MZLOG(@&quot;App push. deviceToken: %@&quot;, deviceToken);</div><div class="line">    </div><div class="line">    // 格式化该数据</div><div class="line">    NSString *deviceTokenStr = [NSString stringWithFormat:@&quot;%@&quot;, deviceToken];</div><div class="line">    deviceTokenStr = [deviceTokenStr stringByReplacingOccurrencesOfString:@&quot;&lt;&quot; withString:@&quot;&quot;];</div><div class="line">    deviceTokenStr = [deviceTokenStr stringByReplacingOccurrencesOfString:@&quot;&gt;&quot; withString:@&quot;&quot;];</div><div class="line">    deviceTokenStr = [deviceTokenStr stringByReplacingOccurrencesOfString:@&quot; &quot; withString:@&quot;&quot;];</div><div class="line">    MZLOG(@&quot;App push. deviceToken string: %@&quot;, deviceTokenStr);</div><div class="line">    </div><div class="line">    // 可以上传该 token 到自己的业务服务器</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在 didRegisterForRemoteNotificationsWithDeviceToken 方法中可以得到 deviceToken 信息:</p>
<p><img src="/upload/images/2017/08/05/9.jpg" alt="1"></p>
<p>注意: 代码中将 NSData 的 deviceToken 转换为了 NSString 类型的数据类型.</p>
<p>2.使用一般的证书, 没有 push 功能的证书</p>
<p>这种情况和 <code>情景一</code> 一样.</p>
<h3 id="推送"><a href="#推送" class="headerlink" title="推送"></a>推送</h3><p>万事俱备, 只欠东风了.</p>
<p>今天没有准备搭建一个自己的业务服务器去推送, 可以使用推送工具来替代.</p>
<p>安装 <a href="https://github.com/noodlewerk/NWPusher" target="_blank" rel="noopener">NWPusher</a> 这个工具, 可以进行推送测试.</p>
<p>安装成功后, 打开这个 Mac APP, 填写相关信息.</p>
<p>点击 push 即可推送.</p>
<p><img src="/upload/images/2017/08/05/10.jpg" alt="1"></p>
<p>在 Appdelegate 中的代理回调中, 可以打印推送内容.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo &#123;</div><div class="line">    </div><div class="line">    MZLOG(@&quot;App push. userInfo: %@&quot;, userInfo);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>推送的内容, 如下图所示.</p>
<p><img src="/upload/images/2017/08/05/11.jpg" alt="1"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    aps =     &#123;</div><div class="line">        alert = &quot;Testing.. (6)&quot;;</div><div class="line">        badge = 1;</div><div class="line">        sound = default;</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="推荐"><a href="#推荐" class="headerlink" title="推荐"></a>推荐</h2><p>1.<a href="https://onevcat.com/2016/08/notification/" target="_blank" rel="noopener">活久见的重构 - iOS 10 UserNotifications 框架解析
</a></p>
<p>2.<a href="http://www.jianshu.com/p/ace1b422bad4" target="_blank" rel="noopener">国内 90%以上的 iOS 开发者，对 APNs 的认识都是错的
</a></p>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 推送 APNs </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS 后台模式]]></title>
      <url>/2017/07/30/iOS-%E5%90%8E%E5%8F%B0%E6%A8%A1%E5%BC%8F/</url>
      <content type="html"><![CDATA[<h2 id="应用状态"><a href="#应用状态" class="headerlink" title="应用状态"></a>应用状态</h2><p>来自苹果开发者文档 The App Life Cycle 的图.</p>
<p><img src="/upload/images/2017/07/30/Background1.jpg" alt="1"></p>
<p>下面这张图说明了应用程序的状态, 如下所示:</p>
<p><img src="/upload/images/2017/07/30/Background2.jpg" alt="1"></p>
<p>具体的说一下这5中状态:</p>
<p>1.Not running</p>
<blockquote>
<p>未运行, 程序没启动或者被系统被用户杀死</p>
</blockquote>
<p>2.Inactive</p>
<blockquote>
<p>未激活, 程序在前台运行，不过没有接收到事件.<br>在没有事件处理情况下程序通常停留在这个状态.</p>
</blockquote>
<p>3.Active</p>
<blockquote>
<p>激活, 程序在前台运行而且接收到了事件.<br>这也是前台的一个正常的模式</p>
</blockquote>
<p>4.Backgroud</p>
<blockquote>
<p>后台, 程序在后台而且能执行代码，大多数程序进入这个状态后会在在这个状态上停留一会.<br>时间到之后会进入挂起状态(Suspended). 有的程序经过特殊的请求后可以长期处于 Backgroud 状态.</p>
</blockquote>
<p>5.Suspended</p>
<blockquote>
<p>挂起, 程序在后台不能执行代码.<br>系统会自动把程序变成这个状态而且不会发出通知.<br>当挂起时, 程序还是停留在内存中的, 当系统内存低时, 系统就把挂起的程序清除掉, 为前台程序提供更多的内存.</p>
</blockquote>
<p>关于 Backgroud 状态, 是我们今天要说的重点部分.</p>
<h2 id="多任务介绍"><a href="#多任务介绍" class="headerlink" title="多任务介绍"></a>多任务介绍</h2><p>iOS 的多任务是在 iOS4 的时候被引入的，在此之前 iOS 的 APP 都是按下 Home 键就被干掉了.<br>iOS4 虽然引入了后台和多任务，但是实际上是伪多任务，一般的 APP 后台并不能执行自己的代码，只有少数几类服务在通过注册后可以真正在后台运行，并且在提交到 AppStore 的时候也会被严格审核是否有越权行为，这种限制主要是出于对于设备的续航和安全两方面进行的考虑.之后经过iOS5 和 iOS6 的逐渐发展，后台能运行的服务的种类虽然出现了增加，但是 iOS 后台的本质并没有变化.<br>在iOS7之前，系统所接受的应用多任务可以大致分为几种：</p>
<ul>
<li>后台完成某些花费时间的特定任务.</li>
<li>后台播放音乐等.</li>
<li>位置服务.</li>
<li>IP电话(VOIP).</li>
<li>Newsstand.</li>
</ul>
<p>iOS7 后台任务申请的最长时间 10分钟.<br>iOS8+ 后台任务申请最长时间 3分钟.</p>
<h2 id="示例-APP-退到后台会被挂起"><a href="#示例-APP-退到后台会被挂起" class="headerlink" title="示例: APP 退到后台会被挂起"></a>示例: APP 退到后台会被挂起</h2><p>今天跟大家分享的是一般应用如何在后台延长生命周期的知识, 关于其他特殊的 App 如上面提到的5中情况, 不是今天讨论的重点.</p>
<p>我们先看一个例子, 例子很简单.</p>
<blockquote>
<p>这里要说明一下概念, 直接锁屏和点击 Home 键, 都会导致应用处于后台模式, 这里为了说明问题, 统一点<br>击 Home 作为代名词.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    </div><div class="line">    [super viewDidLoad];    </div><div class="line">    </div><div class="line">    [[NSNotificationCenter defaultCenter] addObserver:self</div><div class="line">                                             selector:@selector(onDidEnterBackground:)</div><div class="line">                                                 name:UIApplicationDidEnterBackgroundNotification</div><div class="line">                                               object:nil];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)onDidEnterBackground:(NSNotification *)notification &#123;</div><div class="line">    </div><div class="line">    MZLOG(@&quot;App Background. Enter onDidEnterBackground.&quot;);</div><div class="line">    </div><div class="line">    int delta = 1;</div><div class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(delta * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</div><div class="line">        </div><div class="line">        MZLOG(@&quot;App Background. Enter onDidEnterBackground diapatch.&quot;);</div><div class="line">        </div><div class="line">        UILocalNotification *notification = [UILocalNotification new];</div><div class="line">        notification.fireDate = [NSDate dateWithTimeIntervalSinceNow:3];</div><div class="line">        notification.alertBody = @&quot;走, 去high吧!&quot;;</div><div class="line">        notification.soundName = UILocalNotificationDefaultSoundName;</div><div class="line">        // 可以自定义数据</div><div class="line">        notification.userInfo = @&#123;@&quot;user_info_key&quot;: @&quot;user_info_value_json_str&quot;&#125;;</div><div class="line">        </div><div class="line">        [[UIApplication sharedApplication] scheduleLocalNotification:notification];</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>UIApplicationDidEnterBackgroundNotification</code> 可以监听到用户将 APP 退到后台.</p>
<p>当 APP 退到后台, 会调用 onDidEnterBackground 这个方法.</p>
<p>在 onDidEnterBackground 这个方法中, 我故意延时执行代码, 这里使用的是 dispatch_after.</p>
<p>编译运行这个工程, 运行成功后, 可以点击 Home 键将应用退到后台.</p>
<p>可以在 Xcode 的控制台看到 App Background. Enter onDidEnterBackground. 的打印信息, 但是迟迟不见 dispatch_after 里面的代码执行.</p>
<p>这里说明, APP 退到后台后被系统挂起了.</p>
<p>另外一个例子就是使用 NSTimer, 在 APP 退到后台后, 也会被终止.</p>
<p>完整例子, 一会在文章后台附录给出.</p>
<h2 id="通过后台模式延长-APP-运行"><a href="#通过后台模式延长-APP-运行" class="headerlink" title="通过后台模式延长 APP 运行"></a>通过后台模式延长 APP 运行</h2><p>上面的例子充分说明了, 在我们没有做任何处理的情况下, iOS 系统在 APP 退到后台的情况下, 会被系统挂起, 从而终止 APP 的代码行为.</p>
<p>下面通过实例, 来开启后台任务, 让 APP 尽可能的延长声明周期.</p>
<p>在工程的基础上, 新建一个文件 <code>MZBackgroundTask</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@interface MZBackgroundTask : NSObject</div><div class="line">+ (instancetype)sharedTask;</div><div class="line">- (void)startTask;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>具体实现, 只给出关键代码.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line">- (void)startTask &#123;</div><div class="line">    </div><div class="line">    if (![self _checkSupportBackgroundTask]) &#123;</div><div class="line">        </div><div class="line">        MZLOG(@&quot;BackgroundTask. Current device don&apos;t support backgroundTask.&quot;);</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    UIApplication *application = [UIApplication sharedApplication];</div><div class="line">    </div><div class="line">    __block UIBackgroundTaskIdentifier taskId;</div><div class="line">    </div><div class="line">    /// 申请后台执行</div><div class="line">    /// 注意: 在iOS7和该版本前，后台可以用下面的的方式在后台存活5-10分钟，在iOS8及后，最多存活3分钟</div><div class="line">    &#123;</div><div class="line">        taskId = [application beginBackgroundTaskWithName:NSStringFromClass([self class]) expirationHandler:^&#123;</div><div class="line">            </div><div class="line">            MZLOG(@&quot;BackgroundTask. BackgroundTask is Over. The remained time: %f&quot;, application.backgroundTimeRemaining);</div><div class="line">            </div><div class="line">            [application endBackgroundTask:taskId];</div><div class="line">            </div><div class="line">            taskId = UIBackgroundTaskInvalid;</div><div class="line">        &#125;];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    if (UIBackgroundTaskInvalid == taskId) &#123;</div><div class="line">        </div><div class="line">        MZLOG(@&quot;BackgroundTask. Apply backgroundTask failed.&quot;);</div><div class="line">        </div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /// 可以监控后台任务剩余的时间, 针对业务可以去处理</div><div class="line">    &#123;</div><div class="line">        dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</div><div class="line">            </div><div class="line">            __block NSTimeInterval remainedTime;</div><div class="line">            </div><div class="line">            while (true) &#123;</div><div class="line">                </div><div class="line">                // 剩余可以后台执行的时间</div><div class="line">                dispatch_async(dispatch_get_main_queue(), ^&#123;</div><div class="line">                    </div><div class="line">                    // application.backgroundTimeRemaining 必须在主线程获取</div><div class="line">                    remainedTime = application.backgroundTimeRemaining;</div><div class="line">                    </div><div class="line">                    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</div><div class="line">                       </div><div class="line">                        MZLOG(@&quot;BackgroundTask. The remained time: %f&quot;, remainedTime);</div><div class="line">                        </div><div class="line">                        if (remainedTime &lt; 10) &#123;</div><div class="line">                            </div><div class="line">                            // 可以告诉其他业务, 后台申请的时间即将结束了</div><div class="line">                        &#125;</div><div class="line">                        </div><div class="line">                        if (remainedTime &lt; 2) &#123;</div><div class="line">                            </div><div class="line">                            /// 这里可以做一些清除工作</div><div class="line">                            &#123;</div><div class="line">                                // clean up</div><div class="line">                            &#125;</div><div class="line">                            </div><div class="line">                            [application endBackgroundTask:taskId];</div><div class="line">                            </div><div class="line">                            taskId = UIBackgroundTaskInvalid;</div><div class="line">                            </div><div class="line">                            return;</div><div class="line">                        &#125;</div><div class="line">                        </div><div class="line">                        // 睡眠(延时)1s</div><div class="line">                        [NSThread sleepForTimeInterval:1.f];</div><div class="line">                    &#125;);</div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>startTask 开启后台任务.</p>
<p>在 AppDelegate 中, 调用这个方法.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (void)applicationDidEnterBackground:(UIApplication *)application &#123;</div><div class="line">    </div><div class="line">    [[MZBackgroundTask sharedTask] startTask];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>再次运行工程, 可以根据日志看出, 之前的 dispatch_after 和 timer 可以运行了, 并且可以运行3分钟(180s).</p>
<p>根据 backgroundTimeRemaining 这个属性, 可以看出具体的后台可执行的剩余时间.</p>
<p><img src="/upload/images/2017/07/30/Background3.jpg" alt="1"></p>
<p>注意: 我测试的时候使用的是 iOS10 设备.</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>除了苹果规定的几种类型(如定位, 录音, VOIP 等)的应用外, 其他 APP 想申请更多的后台驻留时间, 就需要一些 <code>旁门左道</code> 的方法了.</p>
<p>苹果对后台操作做了这么多限制, 也是从用户的角度出发, 如安全, 省电, 省流量等.</p>
<p>比如, 在后台播放没有声音的音乐.</p>
<p>再比如, 申请定位服务的权限, 这样也可以保持 APP 在后台不被挂起.<br>但是, 依照苹果一贯的审核做法来看，如果声明了需要某项后台权限，你却没有相关实现的话，会直接被拒掉的.</p>
<p>这些是技术上的实现, 我没有推荐大家这么干, 现在苹果审核比以前还要严格, 大家还是悠着点干吧.如果你的 APP 不需要上架到 AppStore 的话, 就尽情的放纵吧…</p>
<h2 id="推荐博文"><a href="#推荐博文" class="headerlink" title="推荐博文"></a>推荐博文</h2><p>1.<a href="http://www.jianshu.com/p/50ff7a3a0fcd" target="_blank" rel="noopener">iOS实现无限后台background的方法</a></p>
<p>2.<a href="https://onevcat.com/2013/08/ios7-background-multitask/" target="_blank" rel="noopener">WWDC 2013 Session笔记 - iOS7中的多任务</a></p>
<p>iOS 在后台的时候如果不使用后台模式, socket 也会被系统关闭连接, 比如我们使用的 IM 功能.<br>使用后台模式后, 向系统申请的时间(3分钟内), socket 还是没有被关闭的, 除非断网或者被路由器给断开了, 在申请的这段时间内, socekt 还是可以使用的, 如果想持续的保持 socket 连接, 就需要去了解一下 VOIP Socket 相关的知识了, 实践过后, 分享给大家.</p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p>下面是具体的实现代码.</p>
<blockquote>
<p>ViewController.m</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">@interface ViewController ()</div><div class="line"></div><div class="line">@property (nonatomic, strong) NSTimer *timer;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    </div><div class="line">    [super viewDidLoad];</div><div class="line">    </div><div class="line">    [[NSNotificationCenter defaultCenter] addObserver:self</div><div class="line">                                             selector:@selector(onDidEnterBackground:)</div><div class="line">                                                 name:UIApplicationDidEnterBackgroundNotification</div><div class="line">                                               object:nil];</div><div class="line">    </div><div class="line">    // 每隔一秒执行一次</div><div class="line">    _timer = [NSTimer scheduledTimerWithTimeInterval:1</div><div class="line">                                              target:self</div><div class="line">                                            selector:@selector(onTimerDidRun:)</div><div class="line">                                            userInfo:nil repeats:YES];</div><div class="line">    </div><div class="line">    [[NSRunLoop currentRunLoop] addTimer:self.timer forMode:NSRunLoopCommonModes];</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark - Callback.</div><div class="line"></div><div class="line">- (void)onTimerDidRun:(id)sender &#123;</div><div class="line">    </div><div class="line">    MZLOG(@&quot;App Background. Timer Running.&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)onDidEnterBackground:(NSNotification *)notification &#123;</div><div class="line">    </div><div class="line">    MZLOG(@&quot;App Background. Enter onDidEnterBackground.&quot;);</div><div class="line">    </div><div class="line">    int delta = 1;</div><div class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(delta * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</div><div class="line">        </div><div class="line">        MZLOG(@&quot;App Background. Enter onDidEnterBackground diapatch.&quot;);</div><div class="line">        </div><div class="line">        UILocalNotification *notification = [UILocalNotification new];</div><div class="line">        notification.fireDate = [NSDate dateWithTimeIntervalSinceNow:3];</div><div class="line">        notification.alertBody = @&quot;走, 去high吧!&quot;;</div><div class="line">        notification.soundName = UILocalNotificationDefaultSoundName;</div><div class="line">        // 可以自定义数据</div><div class="line">        notification.userInfo = @&#123;@&quot;user_info_key&quot;: @&quot;user_info_value_json_str&quot;&#125;;</div><div class="line">        </div><div class="line">        [[UIApplication sharedApplication] scheduleLocalNotification:notification];</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark - SetupViews.</div><div class="line"></div><div class="line">- (void)_setupViews &#123;</div><div class="line">    </div><div class="line">    self.view.backgroundColor = [UIColor purpleColor];</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>MZBackgroundTask.m</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div></pre></td><td class="code"><pre><div class="line">#import &quot;MZBackgroundTask.h&quot;</div><div class="line"></div><div class="line">@implementation MZBackgroundTask</div><div class="line"></div><div class="line">+ (instancetype)sharedTask &#123;</div><div class="line">    </div><div class="line">    static MZBackgroundTask *_task;</div><div class="line">    static dispatch_once_t onceToken;</div><div class="line">    dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">        _task = [[self alloc] init];</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    return _task;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)startTask &#123;</div><div class="line">    </div><div class="line">    if (![self _checkSupportBackgroundTask]) &#123;</div><div class="line">        </div><div class="line">        MZLOG(@&quot;BackgroundTask. Current device don&apos;t support backgroundTask.&quot;);</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    UIApplication *application = [UIApplication sharedApplication];</div><div class="line">    </div><div class="line">    __block UIBackgroundTaskIdentifier taskId;</div><div class="line">    </div><div class="line">    /// 申请后台执行</div><div class="line">    /// 注意: 在iOS7和该版本前，后台可以用下面的的方式在后台存活5-10分钟，在iOS8及后，最多存活3分钟</div><div class="line">    &#123;</div><div class="line">        taskId = [application beginBackgroundTaskWithName:NSStringFromClass([self class]) expirationHandler:^&#123;</div><div class="line">            </div><div class="line">            MZLOG(@&quot;BackgroundTask. BackgroundTask is Over. The remained time: %f&quot;, application.backgroundTimeRemaining);</div><div class="line">            </div><div class="line">            [application endBackgroundTask:taskId];</div><div class="line">            </div><div class="line">            taskId = UIBackgroundTaskInvalid;</div><div class="line">        &#125;];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    if (UIBackgroundTaskInvalid == taskId) &#123;</div><div class="line">        </div><div class="line">        MZLOG(@&quot;BackgroundTask. Apply backgroundTask failed.&quot;);</div><div class="line">        </div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    /// 可以监控后台任务剩余的时间, 针对业务可以去处理</div><div class="line">    &#123;</div><div class="line">        dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</div><div class="line">            </div><div class="line">            __block NSTimeInterval remainedTime;</div><div class="line">            </div><div class="line">            while (true) &#123;</div><div class="line">                </div><div class="line">                // 剩余可以后台执行的时间</div><div class="line">                dispatch_async(dispatch_get_main_queue(), ^&#123;</div><div class="line">                    </div><div class="line">                    // application.backgroundTimeRemaining 必须在主线程获取</div><div class="line">                    remainedTime = application.backgroundTimeRemaining;</div><div class="line">                    </div><div class="line">                    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</div><div class="line">                       </div><div class="line">                        MZLOG(@&quot;BackgroundTask. The remained time: %f&quot;, remainedTime);</div><div class="line">                        </div><div class="line">                        if (remainedTime &lt; 10) &#123;</div><div class="line">                            </div><div class="line">                            // 可以告诉其他业务, 后台申请的时间即将结束了</div><div class="line">                        &#125;</div><div class="line">                        </div><div class="line">                        if (remainedTime &lt; 2) &#123;</div><div class="line">                            </div><div class="line">                            /// 这里可以做一些清除工作</div><div class="line">                            &#123;</div><div class="line">                                // clean up</div><div class="line">                            &#125;</div><div class="line">                            </div><div class="line">                            [application endBackgroundTask:taskId];</div><div class="line">                            </div><div class="line">                            taskId = UIBackgroundTaskInvalid;</div><div class="line">                            </div><div class="line">                            return;</div><div class="line">                        &#125;</div><div class="line">                        </div><div class="line">                        // 睡眠(延时)1s</div><div class="line">                        [NSThread sleepForTimeInterval:1.f];</div><div class="line">                    &#125;);</div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark - Private.</div><div class="line"></div><div class="line">/**</div><div class="line"> *  当前设备是否支持后台任务.</div><div class="line"> *</div><div class="line"> *  @return YES, 支持后台任务. 否则, 不支持后台任务.</div><div class="line"> */</div><div class="line">- (BOOL)_checkSupportBackgroundTask &#123;</div><div class="line">    </div><div class="line">    SEL sel = @selector(isMultitaskingSupported);</div><div class="line">    BOOL supportBTask = [[UIDevice currentDevice] respondsToSelector:sel];</div><div class="line">    </div><div class="line">    return supportBTask;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 后台模式 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[使用 Charles]]></title>
      <url>/2017/07/23/%E4%BD%BF%E7%94%A8-Charles/</url>
      <content type="html"><![CDATA[<h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>Charles 是 Mac 上面比较好用的抓包工具.</p>
<p>在使用微信登录 SDK 的时候, 我想看看微信请求的内容, 以及其授权过程, 发现只要连接 Charles, 跳转到微信之后无法打开微信的授权登录页面, 提示网络不可用.</p>
<p>经过研究, 是需要使用 Charles 配置 HTTPS, 配置完成后, 就可以随心所欲了.</p>
<p>所以, 今天跟大家分享一下 Charles 使用的两个点:</p>
<ul>
<li>Charles 的 HTTPS 配置.</li>
<li>使用 Charles 模拟(慢)网络.</li>
</ul>
<h2 id="工具和系统"><a href="#工具和系统" class="headerlink" title="工具和系统"></a>工具和系统</h2><ul>
<li>iPhone: iOS 10.3.</li>
<li>Mac OS: 10.12.5.</li>
<li>Charles: 4.0.2.</li>
</ul>
<h2 id="抓取-HTTPS-请求"><a href="#抓取-HTTPS-请求" class="headerlink" title="抓取 HTTPS 请求"></a>抓取 HTTPS 请求</h2><h4 id="Mac-安装证书"><a href="#Mac-安装证书" class="headerlink" title="Mac 安装证书"></a>Mac 安装证书</h4><blockquote>
<p>打开 Charles, 在 Help 选项中选择 SSL Proxying, 如下图所示:</p>
</blockquote>
<p><img src="/upload/images/2017/07/23/1.jpg" alt="1"></p>
<h4 id="Mac-信任证书"><a href="#Mac-信任证书" class="headerlink" title="Mac 信任证书"></a>Mac 信任证书</h4><blockquote>
<p>打开 Keychain Access (钥匙串), 找到刚才安装的证书, 信任证书, 如图:</p>
</blockquote>
<p><img src="/upload/images/2017/07/23/2.jpg" alt="1"></p>
<h4 id="给-iPhone-安装证书"><a href="#给-iPhone-安装证书" class="headerlink" title="给 iPhone 安装证书"></a>给 iPhone 安装证书</h4><blockquote>
<p>打开 Charles, 在 Help 选项中选择 SSL Proxying, 操作如图:</p>
</blockquote>
<p><img src="/upload/images/2017/07/23/3.jpg" alt="1"></p>
<p>在弹出的对话框中, 可以看到 <code>chls.pro/ssl</code></p>
<p><img src="/upload/images/2017/07/23/4.jpg" alt="1"></p>
<p>手机设置代理, 连接 Charles</p>
<blockquote>
<p>一定要记住: 手机一定要设置代理, 否则安装证书会失败.</p>
</blockquote>
<p>打开手机的 Safari 浏览器, 输入 <code>chls.pro/ssl</code> 这个地址.</p>
<p><img src="/upload/images/2017/07/23/5.jpg" alt="1"></p>
<p>设置信任证书, 如下图:</p>
<p><img src="/upload/images/2017/07/23/6.jpg" alt="1"></p>
<p><img src="/upload/images/2017/07/23/7.jpg" alt="1"></p>
<h2 id="模拟任意网络"><a href="#模拟任意网络" class="headerlink" title="模拟任意网络"></a>模拟任意网络</h2><p>Charles 给我们提供了可以模拟任何网速的网络环境的条件.</p>
<p><img src="/upload/images/2017/07/23/8.jpg" alt="1"></p>
<p>打开 Throttle Settings, 然后 Enable Throttling</p>
<p><img src="/upload/images/2017/07/23/9.jpg" alt="1"></p>
<p>可以看到很多类型的网络供你选择.</p>
<p>Add Preset 可以自己自定义一个网络环境.</p>
<p>这个功能非常实用, 可以让我们模拟慢网络环境, 更好地调试自己的程序.</p>
<h2 id="遇到麻烦"><a href="#遇到麻烦" class="headerlink" title="遇到麻烦"></a>遇到麻烦</h2><p>一. 如果你上面的设置都没有问题, 然而在真正抓取 HTTPS 的请求出现如下错误:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SSLHandshake: Received fatal alert: unknown_ca</div><div class="line">Charles Proxy will even offer a helpful suggestion:</div><div class="line">You may need to configure your browser or application to trust the Charles Root Certificate. See SSL Proxying in the Help menu.</div></pre></td></tr></table></figure>
<p><img src="/upload/images/2017/07/23/10.jpg" alt="1"></p>
<p>这种错误一般是出现在 iOS10 上面.</p>
<p>请在关于本机里面再设置一次 证书信任设置, 即可.</p>
<p><img src="/upload/images/2017/07/23/11.jpg" alt="1"></p>
<p>二. 系统升级后, 设置的 HTTPS 抓包失效.</p>
<p>按照上述方法, 重新设置一次即可.</p>
]]></content>
      
        <categories>
            
            <category> MacOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Charles MacOS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Cocos2d-js: 在 iOS 上运行]]></title>
      <url>/2017/07/23/Cocos2d-js-%E5%9C%A8-iOS-%E4%B8%8A%E8%BF%90%E8%A1%8C/</url>
      <content type="html"><![CDATA[<p>在我的博文 <a href="http://www.veryitman.com/2017/05/14/2017-05-14-Cocos2d-js-%E9%A6%96%E6%AC%A1%E5%9C%A8-Mac-%E4%B8%8A%E9%9D%A2%E8%BF%90%E8%A1%8C/" target="_blank" rel="noopener">Cocos2d-js: 首次在 Mac 上面运行</a> 这篇文章中, 介绍了 Cocos2d 相关的知识, 并且使用Cocos2dx 创建了一个 JS 的简单游戏项目.</p>
<p>今天跟大家分享一下, 如何在 ios 设备上面运行一个 JS 游戏项目.</p>
<p>该游戏项目(贪吃蛇)来自网络资源, 只供演示使用, 不提供任何关于游戏的资源.</p>
<h2 id="当初的想当然"><a href="#当初的想当然" class="headerlink" title="当初的想当然"></a>当初的想当然</h2><p>在 Mac 上面 so easy 的编译并运行了 JS 游戏, 我想在 iOS 设备上应该也很简单的就可以运行起来, 但是我发现我简单不加思考的想法, 是行不通的.</p>
<p>博文 <a href="http://www.veryitman.com/2017/05/14/2017-05-14-Cocos2d-js-%E9%A6%96%E6%AC%A1%E5%9C%A8-Mac-%E4%B8%8A%E9%9D%A2%E8%BF%90%E8%A1%8C/" target="_blank" rel="noopener">Cocos2d-js: 首次在 Mac 上面运行</a> 在 FireFox 浏览器上面可以直接运行 <code>index.html</code>, 但是在 Chrome 浏览器上面就没那么顺利.</p>
<p>想到这里, 我就受到了启发, 莫非 iOS 设备上面需要自己搭建一套 Web Server?</p>
<h2 id="搭建-Web-Server"><a href="#搭建-Web-Server" class="headerlink" title="搭建 Web Server"></a>搭建 Web Server</h2><p>既然想到了这一步, 接下来就是找方案实施了.</p>
<p><a href="https://github.com/robbiehanson/CocoaHTTPServer" target="_blank" rel="noopener">CocoaHTTPServer</a> 这个可以满足我的需求, 于是, 我就直接拿来使用了.</p>
<p>项目中, 我使用了 Cocoapods 来管理第三方库.在 podfile 中直接添加下面的代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod &apos;CocoaHTTPServer&apos;, &apos;~&gt; 2.3&apos;</div></pre></td></tr></table></figure>
<p>然后 pod install 即可.</p>
<p>1.在 ViewController 中导入头文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">#import &lt;HTTPServer.h&gt;</div><div class="line">ViewController 声明部分</div><div class="line"></div><div class="line">@interface ViewController () &lt;WKNavigationDelegate&gt;</div><div class="line">@property (nonatomic, strong) WKWebView *webView;</div><div class="line">@property (nonatomic, strong) HTTPServer *localHttpServer;</div><div class="line">@property (nonatomic, strong) WKWebViewConfiguration *wbConfig;</div><div class="line">//用于调试的 UILabel</div><div class="line">@property (nonatomic, strong) IBOutlet UILabel *loadingLb;</div><div class="line">@property (nonatomic, assign) BOOL startServerSuccess;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>2.配置 Web Server</p>
<p>核心实现如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"> - (void)_configLocalHttpServer</div><div class="line">&#123;</div><div class="line">    NSString *webPath = [[NSBundle mainBundle] pathForResource:@&quot;crazySnake&quot; ofType:nil];</div><div class="line">    _localHttpServer = [[HTTPServer alloc] init];</div><div class="line">    [_localHttpServer setType:@&quot;_http.tcp&quot;];</div><div class="line">    </div><div class="line">    NSFileManager *fileManager = [[NSFileManager alloc] init];</div><div class="line">    NSLog(@&quot;%@&quot;, webPath);</div><div class="line">    </div><div class="line">    if (![fileManager fileExistsAtPath:webPath]) &#123;</div><div class="line">        NSLog(@&quot;File path error!&quot;);</div><div class="line">    &#125;</div><div class="line">    else &#123;</div><div class="line">        NSString *webLocalPath = webPath;</div><div class="line">        [_localHttpServer setDocumentRoot:webLocalPath];</div><div class="line">        NSLog(@&quot;webLocalPath:%@&quot;, webLocalPath);</div><div class="line">        [self _startWebServer];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">- (void)_startWebServer</div><div class="line">&#123;</div><div class="line">    self.loadingLb.hidden = NO;</div><div class="line">    </div><div class="line">    NSError *error;</div><div class="line">    if ([_localHttpServer start:&amp;error]) &#123;</div><div class="line">        NSLog(@&quot;Started HTTP Server on port %hu&quot;, [_localHttpServer listeningPort]);</div><div class="line">        self.port = [NSString stringWithFormat:@&quot;%d&quot;, [_localHttpServer listeningPort]];</div><div class="line">        </div><div class="line">        self.loadingLb.text = @&quot;Start Server Successfully.&quot;;</div><div class="line">        </div><div class="line">        _startServerSuccess = YES;</div><div class="line">    &#125;</div><div class="line">    else &#123;</div><div class="line">        NSLog(@&quot;Error starting HTTP Server: %@&quot;, error);</div><div class="line">        </div><div class="line">        self.loadingLb.text = @&quot;Start Server failed.&quot;;</div><div class="line">        </div><div class="line">        _startServerSuccess = NO;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>_configLocalHttpServer</code> 是配置 HTTPServer 的方法, <code>_startWebServer</code> 是开启 Web Server 的方法.</p>
<p>这样调用 <code>_configLocalHttpServer</code> 就可以开启在设备上面开启一个 Web Server 了.</p>
<h2 id="Xcode-导入-JS-游戏项目"><a href="#Xcode-导入-JS-游戏项目" class="headerlink" title="Xcode 导入 JS 游戏项目"></a>Xcode 导入 JS 游戏项目</h2><p>首先看一下我的工程和资源目录结构, 如图:</p>
<p><img src="/upload/images/2017/07/23/2_1.jpg" alt="1"></p>
<p>仔细看一下, <code>crazySnake</code> 这个文件夹是蓝色的, 不是黄色的.</p>
<p>这里特别注意, 导入这个 crazySnake 文件夹的时候, Options 一定要选择 <code>Create folder reference</code>.</p>
<p>为什么要这么做?</p>
<p>细心的朋友可以发现, 使用 <code>Create folder reference</code>导入的文件夹, 在项目打包生成的 archive 的文件中(自己可以解压看)是可以看到 crazySnake 这个文件夹的, 如果不是这种方式, 而是使用 Create groups 方式(在 Xcode 中显示黄色), 在 archive 中是看不到 crazySnake 这个文件夹的, 而是将里面的文件打散放在 archive 的根目录下面了.</p>
<blockquote>
<p>总之, 一句话, <code>Create folder reference</code> 方式导入的文件夹在打包后还是原来的文件夹, 不会将文件夹里面的文件打散.</p>
</blockquote>
<p>试想一下, 如果多加入几个这样的目录, 都打散在根目录下面, 我们就不好管理这个文件夹里面的文件了.</p>
<h2 id="配置-WKWebView"><a href="#配置-WKWebView" class="headerlink" title="配置 WKWebView"></a>配置 WKWebView</h2><blockquote>
<p>这里我使用了 WKWebView 而不是 UIWebView 作为加载 HTML 的容器.<br>当然, 你也可以使用 UIWebView.</p>
</blockquote>
<p>主要的核心代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLoad</div><div class="line">&#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    </div><div class="line">    self.navigationController.navigationBarHidden = YES;</div><div class="line">    </div><div class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(0.5 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</div><div class="line">        self.loadingLb.text = @&quot;Config server...&quot;;</div><div class="line">        [self _configLocalHttpServer];</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    /// 增加的调式方法: 可以重新启动 web server.</div><div class="line">    &#123;</div><div class="line">        SEL sel = @selector(_configLocalHttpServer);</div><div class="line">        UITapGestureRecognizer *gesture = [[UITapGestureRecognizer alloc] initWithTarget:self</div><div class="line">                                                                                  action:sel];</div><div class="line">        [self.loadingLb addGestureRecognizer:gesture];</div><div class="line">        self.loadingLb.userInteractionEnabled = YES;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">- (void)viewDidAppear:(BOOL)animated</div><div class="line">&#123;</div><div class="line">    [super viewDidAppear:animated];</div><div class="line">    </div><div class="line">    // 配置 WKWebView</div><div class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</div><div class="line">        </div><div class="line">        _wbConfig = [[WKWebViewConfiguration alloc] init];</div><div class="line">        self.wbConfig.userContentController = [[WKUserContentController alloc] init];</div><div class="line">        </div><div class="line">        _webView = [[WKWebView alloc] initWithFrame:self.view.bounds configuration:self.wbConfig];</div><div class="line">        </div><div class="line">        _webView.frame = self.view.bounds;</div><div class="line">        _webView.scrollView.showsHorizontalScrollIndicator = NO;</div><div class="line">        _webView.scrollView.showsVerticalScrollIndicator   = NO;</div><div class="line">        </div><div class="line">        [self.view addSubview:self.webView];</div><div class="line">        self.webView.frame = self.view.bounds;</div><div class="line">        self.webView.navigationDelegate = self;</div><div class="line">        </div><div class="line">        if (self.startServerSuccess) &#123;</div><div class="line">            self.loadingLb.hidden = YES;</div><div class="line">            </div><div class="line">            NSString *gameUrl = [[NSBundle mainBundle] pathForResource:@&quot;index&quot;</div><div class="line">                                                                ofType:@&quot;html&quot;</div><div class="line">                                                           inDirectory:@&quot;crazySnake&quot;];</div><div class="line">            NSURL *url = [NSURL fileURLWithPath:gameUrl];</div><div class="line">            </div><div class="line">            url = [NSURL URLWithString:[NSString stringWithFormat:@&quot;http://127.0.0.1:%@/index.html&quot;, self.port]];</div><div class="line">            [self.webView loadRequest:[NSURLRequest requestWithURL:url]];</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>代码很简单, 就是使用 WKWebView 加载一个 HTML 文件并启动 Web Server.</p>
<h2 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h2><p>接下来, 就是见证奇迹的时刻了…</p>
<p>上面配置了 Web Server 和 加载 html 的 WKWebView, 现在可以直接运行项目看效果了.</p>
<p>无论你是在模拟器还是在真机上面都可以运行这个 JS 游戏项目了.</p>
<p><img src="/upload/images/2017/07/23/2_2.jpg" alt="1"></p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>上面的例子本人亲自实践过的, 给大家提供了一个实现思路, 算是抛砖引玉.</p>
<p>如果想做好这个模式, 还需要很多工作要做, 这里列出来给大家分享一下.</p>
<blockquote>
<p>1.游戏资源包管理和下载.<br>2.游戏中需要和 Native 的交互逻辑.<br>3.数据加密.<br>4.移动端游戏本身的加载优化.</p>
</blockquote>
<p>如果你有更好的方案和想法, 我很乐意邮件 (veryitman@126.com) 与你沟通, 非常感谢!</p>
<p>代码示例我放在了 GitHub, 点击 <a href="https://github.com/veryitman/MZMWPlay" target="_blank" rel="noopener">MZMWPlay</a> 前往下载体验.</p>
]]></content>
      
        <categories>
            
            <category> Game </category>
            
        </categories>
        
        
        <tags>
            
            <tag> cocos Cocos2d-js </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android: Chrome 调试 WEB 页面]]></title>
      <url>/2017/06/01/Android-Chrome-%E8%B0%83%E8%AF%95-WEB-%E9%A1%B5%E9%9D%A2/</url>
      <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>在 Mac OS 上面通过 Safari 调试 iOS 设备或者模拟器的 WEB 页面, 比较方便.</p>
<p>关于具体如何使用 Safari 来调试 iOS 设备, 可以参考 [Safari 的开发者模式] 这篇文章.</p>
<p>自从踏上开发的道路, 电脑上就安装了 Chrome 浏览器, 并且一直保持着更新, Chrome 以其简单设计和高效的用法吸引了大批开发者.</p>
<p>使用 Chrome 调试 Android 设备的 WEB 页面, 易如反掌.</p>
<h2 id="Chrome-调试条件"><a href="#Chrome-调试条件" class="headerlink" title="Chrome 调试条件"></a>Chrome 调试条件</h2><p>使用这项技能的条件如下:</p>
<blockquote>
<p>1.Android 设备系统最低为4.4, 也就是 android-19</p>
<p>2.Chrome 最好使用最新版本的, 以前的版本不支持, 最低兼容版本目前尚不清楚.</p>
<p>3.配置 Android WebView, 使其支持 Debug 和使能 JavaScript 功能.</p>
<p>4.设备和 PC 通过 USB 连接正常, 且支持 USB 调试的.</p>
</blockquote>
<p>我目前使用的设备和 Chrome 版本信息如下:</p>
<blockquote>
<p>Android 设备: 5.1.1版本<br>Chrome: Version 58.0.3029.110 (64-bit)</p>
</blockquote>
<p>我们在地址栏中输入:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chrome://inspect</div></pre></td></tr></table></figure>
<p>就可以打开设备列表界面.<br><img src="/upload/images/2017/06/01/14962450324558.jpg" alt="1"></p>
<p>可以看到我的 Android 设备已经显示出来了.</p>
<p>下面举个例子说明该调试工具的使用.</p>
<h2 id="简单的-Android-工程示例"><a href="#简单的-Android-工程示例" class="headerlink" title="简单的 Android 工程示例"></a>简单的 Android 工程示例</h2><p>该工程只有一个 Activity, 使用 WebView 加载本地 HTML 文件.</p>
<h4 id="1-创建-assets-目录"><a href="#1-创建-assets-目录" class="headerlink" title="1. 创建 assets 目录"></a>1. 创建 assets 目录</h4><p>工程切换到 Project Files 视图<br><img src="/upload/images/2017/06/01/14962453176556.jpg" alt="1"></p>
<p>这样就可以在 src/main 目录下新建了 assets 文件夹了.</p>
<h4 id="2-创建-HTML-文件"><a href="#2-创建-HTML-文件" class="headerlink" title="2. 创建 HTML 文件"></a>2. 创建 HTML 文件</h4><blockquote>
<p>该 HTML 文件, 命名为 local.html, 放在 assets 目录下面.</p>
</blockquote>
<p>local.html 源文件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;button onclick=&quot;myFunction()&quot;&gt;Click me&lt;/button&gt;</div><div class="line">&lt;p id=&quot;demo&quot;&gt;&lt;/p&gt;</div><div class="line">&lt;p&gt;A function is triggered when the button is clicked.&lt;/p&gt;</div><div class="line">&lt;script&gt;</div><div class="line">    function myFunction() &#123;</div><div class="line">        console.log(&apos;js console.&apos;);</div><div class="line">    &#125;</div><div class="line">&lt;/script&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<h4 id="3-在-Activity-中配置-WebView"><a href="#3-在-Activity-中配置-WebView" class="headerlink" title="3.在 Activity 中配置 WebView."></a>3.在 Activity 中配置 WebView.</h4><p>Activity.java 源文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">public class MZWebPage extends AppCompatActivity &#123;</div><div class="line">    private WebView webView;</div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_mzweb_page);</div><div class="line">        webView = (WebView) this.findViewById(R.id.ui_web_view);</div><div class="line">        // 设置 WebView 的 Debug 为可用状态</div><div class="line">        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</div><div class="line">            WebView.setWebContentsDebuggingEnabled(true);</div><div class="line">        &#125;</div><div class="line">        WebSettings settings = webView.getSettings();</div><div class="line">        </div><div class="line">        // 设置 JavaScript 可以使用, 否则在 HTML 中无法调用 JavaScript 代码</div><div class="line">        settings.setJavaScriptEnabled(true);</div><div class="line">        // 本地文件</div><div class="line">        String url = &quot;file:///android_asset/local.html&quot;;</div><div class="line">        webView.loadUrl(url);</div><div class="line">        webView.setWebViewClient(new WebViewClient() &#123;</div><div class="line">            @Override</div><div class="line">            public boolean shouldOverrideUrlLoading(WebView view, WebResourceRequest request) &#123;</div><div class="line">                return super.shouldOverrideUrlLoading(view, request);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        // 设置渲染视图</div><div class="line">        webView.setWebChromeClient(new WebChromeClient());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对应的 xml 布局文件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;LinearLayout</div><div class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</div><div class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    tools:context=&quot;demo.droidsdk.near.idreamsky.com.nearsdk.MZWebPage&quot;&gt;</div><div class="line">    &lt;WebView</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;match_parent&quot;</div><div class="line">        android:id=&quot;@+id/ui_web_view&quot;&gt;</div><div class="line">    &lt;/WebView&gt;</div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure>
<h4 id="4-运行程序"><a href="#4-运行程序" class="headerlink" title="4. 运行程序"></a>4. 运行程序</h4><p>在 Chrome 中输入 chrome://inspect 打开, 可以看到正在运行的 local.html.<br><img src="/upload/images/2017/06/01/14962458882973.jpg" alt="1"></p>
<p>点击 <code>inspect</code>, 进入调试界面.</p>
<p>在调试界面, 点击页面的 Click me, 按钮, 对应的会有 log 输出.<br><img src="/upload/images/2017/06/01/14962459967493.jpg" alt="1"></p>
<h4 id="5-调试出错的-HTML"><a href="#5-调试出错的-HTML" class="headerlink" title="5.调试出错的 HTML"></a>5.调试出错的 HTML</h4><p>修改一下 local.html 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;button onclick=&quot;myFunction()&quot;&gt;Click me&lt;/button&gt;</div><div class="line">&lt;p id=&quot;demo&quot;&gt;&lt;/p&gt;</div><div class="line">&lt;p&gt;A function is triggered when the button is clicked.&lt;/p&gt;</div><div class="line">&lt;script&gt;</div><div class="line">    function myFunction() &#123;</div><div class="line">        console.log(&apos;js console.&apos; + var_error);</div><div class="line">    &#125;</div><div class="line">&lt;/script&gt;</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<p>这里可以看出 <code>var_error</code> 是一个不存在的变量.</p>
<p>重新运行, 点击 Click me, 可以看到右侧的 error:<br><img src="/upload/images/2017/06/01/14962461463698.jpg" alt="1"></p>
<p>关于 Chrome 开发者工具的更多使用, 可以参考官方文档 <a href="https://developers.google.com/web/tools/chrome-devtools/?hl=zh-cn" target="_blank" rel="noopener">Chrome 开发者工具</a>.</p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Chrome Web Debug </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[保持你的好习惯]]></title>
      <url>/2017/05/29/%E4%BF%9D%E6%8C%81%E4%BD%A0%E7%9A%84%E5%A5%BD%E4%B9%A0%E6%83%AF/</url>
      <content type="html"><![CDATA[<p><img src="/upload/images/2017/05/29/1.jpeg" alt="1"></p>
<p>明天就是传统的端午节了, 提前祝大家端午安康!</p>
<p>今天老婆让我帮忙把粽叶子洗洗, 说要包粽子, 我听话地把刚买来的粽叶子洗了个干净, 那都是带有绿色的叶子, 生机勃勃, 让我从指尖中感到无比的温馨和无尽的希望.</p>
<p>小的时候, 我很享受妈妈为我们包粽子的过程, 说实话, 我不是很喜欢吃粽子, 但是特别喜欢粽子锅里面的煮鸡蛋, 特别美味.</p>
<p>老家的粽子没有什么特色, 就是简简单单的糯米被包在叶子中, 然后放在锅里慢慢的煮, 熟了之后, 蘸点白糖就可以吃了.</p>
<p>到了南方之后, 我才发现世界上原来有各种各样的粽子, 红枣的, 绿豆的, 猪肉馅的, 鸡肉馅的…等等!</p>
<p>这些都是偶发的回忆, 和今天的推文没有关系, 不信, 你接着往下看.</p>
<h2 id="养成阅读的习惯"><a href="#养成阅读的习惯" class="headerlink" title="养成阅读的习惯"></a>养成阅读的习惯</h2><p>我不是一个聪明的孩子, 直到小学三年级, 我才真正的开始明白学习到底是怎么一回事, 用老家人的话说算是开窍了.</p>
<p>后来我很顺利的上了初中, 家里的大部分收入要靠庄家, 一年四季能够风调雨顺的话, 也能过个不错的年, 至少能把学费给交上.</p>
<p>初中二年级的时候, 我辍学了, 也许是命运的安排吧, 当时自己也没有多想, 毅然决定下学去寻找另一种人生.</p>
<p>于是, 我选择了理发这个行业. 和师傅在风风雨雨中度过了一年多的时间, 在当时的农村, 不上学有门手艺也算是对自己和父母有个交代.</p>
<p>我的内心仍然渴望去上学, 虽然不知道为什么要去上学也不知道上学后能干什么, 但是心里面总是觉得自己不能放弃学业.在理发的一年多时间里, 我没有放弃过学习.<br>冥冥之中自有安排, 妈妈有次问我: “还想去上学不?”, 我想都没想就情不自禁的点头了, 妈妈又说:”我就知道你没有放弃, 去继续上学吧, 不要留下遗憾!”.当时的我甭提有多高兴了.</p>
<p>再次回到校园的我比以前更加努力和拼命了, 更加懂得如何珍惜这来之不易的学习机会了.</p>
<p>直到大学毕业, 参加工作以及有了孩子后, 我也能保持自我学习和自我激励的状态, 保持好的阅读习惯, 让我受益终身.</p>
<p>有次孩子早晨起床忙完后, 就开始坐在那里看书, 有好几次晚上, 我也发现他洗完澡后, 坐在那里看书, 或者是做手工, 或是画画.</p>
<p>我感到很好奇, 决定找个机会问问他.</p>
<p>有一个周末的上午, 早餐过后, 我就把他拉到身边, 和他一起看儿童读物, 问他:”宝贝, 你为什么喜欢看书呢?”, 他说:”爸爸, 是你影响了我, 你喜欢看书, 我也喜欢看书.”, 看着他一副天真的样子, 我真的不敢相信几岁的孩子能说出这样的话, 但我内心感到无比的欣慰.原来好的习惯会传染给自己身边的人, 并且能让你感到自豪.</p>
<h2 id="坚持写博客"><a href="#坚持写博客" class="headerlink" title="坚持写博客"></a>坚持写博客</h2><p>写博客或者是生活日记, 确实很”浪费”时间, 甚至会占用你任何休息的时间, 写博客偶尔也会让你抓耳挠腮, 感叹:”书到用时方恨少”!</p>
<p>所以, 读, 写不能分家, 更应该是将二者紧密的联合在一起.<br>多阅读多写, 才会让你更加的通透, 当然了, 我只是喜欢写, 写的质量也很一般, 只是为了满足内心的那一点点对知识的渴望.</p>
<p>写的多了, 你就更加愿意去思考了, 思考多了, 很多事情你就看开了, 对你的生活和工作都有好处.</p>
<p>从09年到现在我一直坚持写博客, 刚开始也是无从下笔, 不知道自己到底该写一写什么东西, 写了之后, 是不是别人看了会嘲笑我, 诸如此类的担心太多太多, 后来我也想明白了, 你写的再好也有人比你写得好, 也会有人说你写的不好.那我何必去计较这么些个事儿了, 只管动手写吧!</p>
<p>然后, 就在博客网站上面耕耘, 技术的, 吐槽的, 生活的我都喜欢写, 不管你喜不喜欢看, 它都在那里, 哈哈!</p>
<p>我把博客当做自己的朋友, 心情好亦或是不好的时候, 我都会向他倾诉, 希望自己写下的东西或多或少能帮助一些人, 这也许是我坚持写博客的最大动力了.</p>
<p>如果你也喜欢写博客或者是准备写博客, 就开始动手写吧, 不要再犹豫了.</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>这个世界上, 没多少人喜欢听别人啰嗦, 即使听了你的啰嗦, 也不一定会付出实践, 即使你是长者或者是智者, 况且我只是一介平民.</p>
<p>但是我还是要啰嗦一句:”保持持续学习的习惯, 会消耗你的勤奋, 但会让你受益终生”, 信不信由你!</p>
]]></content>
      
        <categories>
            
            <category> 随笔 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 思考 生活 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Safari 的开发者模式]]></title>
      <url>/2017/05/15/Safari-%E7%9A%84%E5%BC%80%E5%8F%91%E8%80%85%E6%A8%A1%E5%BC%8F/</url>
      <content type="html"><![CDATA[<h2 id="设置-Safari"><a href="#设置-Safari" class="headerlink" title="设置 Safari"></a>设置 Safari</h2><p>1.打开 Safari 的 Preference<br><img src="/upload/images/2017/05/15/14948249631231.jpg" alt="1"></p>
<p>2.切换到 Advanced 选项<br><img src="/upload/images/2017/05/15/14948250437147.jpg" alt="1"></p>
<p>将 <code>Show Develop menu in menu bar</code> 选中.</p>
<p>可以看到 Safari 多了 Develop 选项<br><img src="/upload/images/2017/05/15/14948254198174.jpg" alt="1"></p>
<h2 id="设置设备或者模拟器"><a href="#设置设备或者模拟器" class="headerlink" title="设置设备或者模拟器"></a>设置设备或者模拟器</h2><h3 id="在-iphone或者模拟器-中设置-Safari"><a href="#在-iphone或者模拟器-中设置-Safari" class="headerlink" title="在 iphone或者模拟器 中设置 Safari"></a>在 iphone或者模拟器 中设置 Safari</h3><h4 id="打开-Safari-的高级选项"><a href="#打开-Safari-的高级选项" class="headerlink" title="打开 Safari 的高级选项"></a>打开 Safari 的高级选项</h4><p><img src="/upload/images/2017/05/15/14948252328005.jpg" alt="1"></p>
<h4 id="打开-Web-检查器"><a href="#打开-Web-检查器" class="headerlink" title="打开 Web 检查器"></a>打开 Web 检查器</h4><p><img src="/upload/images/2017/05/15/14948252717169.jpg" alt="1"></p>
<p>上面设置完毕后, 运行你的程序, 在 Safari 的 Develop 中可以看到对应设备, 从而可以调试 HTML 页面了.<br><img src="/upload/images/2017/05/15/14948259031169.jpg" alt="1"></p>
<p>在调试窗口中，可以看到当前正在加载网页的各种信息，如源码、请求头、图片、加载的资源与脚本、控制台输出等.</p>
<p>也可以直接修改网页的 CSS 样式和布局等进行修改，而不用重新运行 App.<br><img src="/upload/images/2017/05/15/14948635711574.jpg" alt="1"></p>
<p>使用 Safari 的开发者模式, 可以帮助我们调试前端页面, 解决一些问题, 比较方便.</p>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> iOS Safari </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS: 自定义 UIWebView 和 WKWebView 的 UserAgent]]></title>
      <url>/2017/05/14/iOS-%E8%87%AA%E5%AE%9A%E4%B9%89-UIWebView-%E5%92%8C-WKWebView-%E7%9A%84-UserAgent/</url>
      <content type="html"><![CDATA[<h2 id="导言"><a href="#导言" class="headerlink" title="导言"></a>导言</h2><p>在 iOS8, 苹果推出了 WKWebView, 目的很明显: 取代 UIWebView.</p>
<p>随着时间的推移, 越来越多的应用开始最低版本支持为 iOS8, 大家也纷纷的开始使用 WKWebView 组件.</p>
<p>在 iOS10.x 版本上, UIWebView 的表现不尽如人意, 在我们的后台日志和用户反馈, 存在很多莫名其妙的 crash 以及卡顿现象, 内存飙升等问题. 针对不同的 JS 游戏引擎, UIWebView 表现也不够好, 所以是时候使用 WKWebView 了.</p>
<p>但是话又说回来, 如果你最低版本支持 iOS8, 也不能完全放弃 UIWebView, WKWebView 有一部分 API 只有 iOS9+ 才有, 如果你的应用在 iOS8 运行而使用 iOS9 的 API, 肯定会 crash.</p>
<p>例如:</p>
<blockquote>
<p>1.清除缓存.<br>2.设置 user-agent.</p>
</blockquote>
<p>今天要说的是关于设置自定义 UIWebView 和 WKWebView 的 UserAgent 问题.</p>
<h2 id="WKWebView-UserAgent"><a href="#WKWebView-UserAgent" class="headerlink" title="WKWebView UserAgent"></a>WKWebView UserAgent</h2><h4 id="默认的-UserAgent"><a href="#默认的-UserAgent" class="headerlink" title="默认的 UserAgent"></a>默认的 UserAgent</h4><p>使用下面的代码, 可以输出 WKWebView 的默认 UserAgent.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidload </div><div class="line">&#123;</div><div class="line">	[self.wkWebView evaluateJavaScript:@&quot;navigator.appName&quot; completionHandler:^(id __nullable appName, NSError * __nullable error) &#123;</div><div class="line">        NSLog(@&quot;navigator.appName: %@&quot;, appName);</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    [self.wkWebView evaluateJavaScript:@&quot;navigator.userAgent&quot; completionHandler:^(id __nullable userAgent, NSError * __nullable error) &#123;</div><div class="line">    	NSLog(@&quot;navigator.userAgent: %@&quot;, userAgent);</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>navigator.appName 无论在 iOS8, iOS9 还是 iOS10, 输出结果都是一致的.</p>
<p>navigator.userAgent 在不同的 iOS 系统上面输出结果略有不同.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// iOS 8.3</div><div class="line">// Mozilla/5.0 (iPhone; CPU iPhone OS 8_3 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Mobile/12F70</div><div class="line">// iOS 9.0</div><div class="line">// Mozilla/5.0 (iPhone; CPU iPhone OS 9_0 like Mac OS X) AppleWebKit/601.1.32 (KHTML, like Gecko) Mobile/13A4254v</div><div class="line">// iOS 10.x</div><div class="line">//Mozilla/5.0 (iPhone; CPU iPhone OS 10_3 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E269</div></pre></td></tr></table></figure>
<h4 id="自定义-UserAgent"><a href="#自定义-UserAgent" class="headerlink" title="自定义 UserAgent"></a>自定义 UserAgent</h4><p>修改默认的 UserAgent, 需要使用下面的方法.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">self.wkWebView.customUserAgent = @&quot;CustomUserAgent&quot;</div></pre></td></tr></table></figure>
<p>这样, 就改变了其默认的 UserAgent 值了.</p>
<p>特别需要注意: customUserAgent 是 iOS9 之后才有的字段.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/*! @abstract The custom user agent string or nil if no custom user agent string has been set.</div><div class="line">*/</div><div class="line">@property (nullable, nonatomic, copy) NSString *customUserAgent API_AVAILABLE(macosx(10.11), ios(9.0));</div></pre></td></tr></table></figure>
<p>所以在 iOS8.x, 如果你想改变 UserAgent, 还是要使用 UIWebView.</p>
<h2 id="HTML-使用-UserAgent"><a href="#HTML-使用-UserAgent" class="headerlink" title="HTML 使用 UserAgent"></a>HTML 使用 UserAgent</h2><p>HTML 中可以根据自定义的 UserAgent, 做出不同的行为, 如自定的 UserAgent 可以包括应用的版本号, HTML 可以根据不同的版本来做版本区分等逻辑.</p>
<p>在 HTML 中, 可以使用 JS 来获取 UserAgent 的值.</p>
<p>Demo.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html lang=&quot;en&quot; xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</div><div class="line">    &lt;head&gt;</div><div class="line">        &lt;meta charset=&quot;utf-8&quot; /&gt;</div><div class="line">        &lt;title&gt;user-agent&lt;/title&gt;</div><div class="line">        &lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">            function getUserAgent() &#123;</div><div class="line">                var ug = navigator.userAgent;</div><div class="line">                document.getElementById(&quot;mySpan&quot;).innerHTML = ug;</div><div class="line">            &#125;</div><div class="line">        &lt;/script&gt;</div><div class="line">    &lt;/head&gt;</div><div class="line">    &lt;body&gt;</div><div class="line">        &lt;h1&gt;显示 user-agent&lt;/h1&gt;</div><div class="line">        &lt;p&gt;&lt;span style=&quot;font-size:30px&quot; id=&quot;mySpan&quot;&gt;..&lt;/span&gt;&lt;/p&gt;</div><div class="line">        &lt;p&gt;&lt;input type=&quot;button&quot; value=&quot;点击显示 user-agent&quot; onclick=&quot;getUserAgent()&quot;  class=&quot;button&quot;/&gt;&lt;/p&gt;</div><div class="line">    &lt;/body&gt;</div><div class="line">    </div><div class="line">    &lt;style&gt;</div><div class="line">        .button &#123;</div><div class="line">            background-color: #4C0950;</div><div class="line">            border: none;</div><div class="line">            color: white;</div><div class="line">            padding: 15px 32px;</div><div class="line">            text-align: center;</div><div class="line">            text-decoration: none;</div><div class="line">            display: inline-block;</div><div class="line">            font-size: 40px;</div><div class="line">            margin: 20px 200px 100px 300px;</div><div class="line">            cursor: pointer;</div><div class="line">            border-radius: 15;</div><div class="line">        &#125;</div><div class="line">    &lt;/style&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<p>使用 WKWebView 加载该 Demo.html 文件, 效果图如下:<br><img src="/upload/images/2017/05/14/webView.jpg" alt="1"></p>
<h2 id="UIWebView-UserAgent"><a href="#UIWebView-UserAgent" class="headerlink" title="UIWebView UserAgent"></a>UIWebView UserAgent</h2><h4 id="默认的-UserAgent-1"><a href="#默认的-UserAgent-1" class="headerlink" title="默认的 UserAgent"></a>默认的 UserAgent</h4><p>使用下面的代码, 可以输出 UIWebView 的默认 UserAgent.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">NSString *appName = [self.webView stringByEvaluatingJavaScriptFromString:@&quot;navigator.appName&quot;];</div><div class="line">NSLog(@&quot;navigator.appName: %@&quot;, appName);</div><div class="line">    </div><div class="line">NSString *userAgent = [self.webView stringByEvaluatingJavaScriptFromString:@&quot;navigator.userAgent&quot;];</div><div class="line">NSLog(@&quot;navigator.userAgent %@&quot;, userAgent);</div></pre></td></tr></table></figure>
<p>打印输出结果和 WKWebView 的结果一致.</p>
<h4 id="设置自定的-UserAgent"><a href="#设置自定的-UserAgent" class="headerlink" title="设置自定的 UserAgent"></a>设置自定的 UserAgent</h4><p>设置一个 key 为 @”UserAgent” 的本地存储即可.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[[NSUserDefaults standardUserDefaults] registerDefaults:@&#123;@&quot;UserAgent&quot;:@&quot;CustomUserAgent-UIWebView&quot;&#125;];</div><div class="line">    </div><div class="line">NSString *appName = [self.webView stringByEvaluatingJavaScriptFromString:@&quot;navigator.appName&quot;];</div><div class="line">NSLog(@&quot;navigator.appName: %@&quot;, appName);</div><div class="line">    </div><div class="line">NSString *userAgent = [self.webView stringByEvaluatingJavaScriptFromString:@&quot;navigator.userAgent&quot;];</div><div class="line">NSLog(@&quot;navigator.userAgent %@&quot;, userAgent);</div></pre></td></tr></table></figure>
<p>这样就改变了 UIWebView 的默认 UserAgent 了.</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>应用最低版本支持 iOS7/8 的开发者们, 可以考虑 UIWebView 和 WKWebView 并存的开发模式. iOS9及以上的开发者你们, 可以完全放弃 UIWebView, 大胆的拥抱 WKWebView 了.</p>
<p>移植 UIWebView 到 WKWebView 的成本不算大.<br>如果你现在有时间, 可以开始着手做这些事了.前端和客户端需要考虑之前交互那部分的逻辑, 即 JS 调用 Native 或者 Native 调用 JS 的需要做些调整, 因为 WKWebView 的调用方式和 UIWebView 不一样了, 前端页面要考虑版本兼容性.</p>
<p>新的 WKWebView 虽然存在一些坑, 但是使用它亦是大势所趋, 正所谓 存在即合理, 你没有理由拒绝它.</p>
<p>后续, 我会写一写在 WKWebView 上面遇到的一些问题, 分享给大家.</p>
<p>之前我也写过一篇文章, 是关于 UIWebView 缓存的, 不妨, 你也瞅瞅 [iOS: 聊聊 UIWebView 缓存].</p>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> UIWebView WKWebView UserAgent </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Cocos2d-js: 首次在 Mac 上面运行]]></title>
      <url>/2017/05/14/Cocos2d-js-%E9%A6%96%E6%AC%A1%E5%9C%A8-Mac-%E4%B8%8A%E9%9D%A2%E8%BF%90%E8%A1%8C/</url>
      <content type="html"><![CDATA[<h2 id="Cocos2d-js-介绍"><a href="#Cocos2d-js-介绍" class="headerlink" title="Cocos2d-js 介绍"></a>Cocos2d-js 介绍</h2><p>如果你是刚接触 Cocos2d-js 开发的人, 一定会被 Cocos2d-js 和 Cocos2d-HTML5 以及 Cocos2d-x 搞得晕头转向.</p>
<p>下面简单介绍一下 Cocos2d-js 的前世今生.</p>
<p>目前 Cocos2d-x 支持使用 C++、Lua、Javascript 语言来进行开发，且内置 JavaScript 引擎，通过 C++ 解析 Javascript 去执行.</p>
<p>Cocos2d-HTML5 是使用 JavaScript 进行开发，最终运行在浏览器里的.</p>
<p>v3.0 后，Cocos2d-HTML5 和 Cocos2d-x JSBinding 被合到了一起，称作 Cocos2d-JS.</p>
<p>与 Cocos2d-HTML5 不同的是，Cocos2d-js 开发的程序不仅能运行在浏览器里，还能编译运行在 Mac OSX, Windows, iOS, Android 平台上.</p>
<p>从 Cocos2d-x v3.7 版本之后, js 版本被合并到 Cocos2d-x 中了.</p>
<p>具体可以看 <a href="https://github.com/cocos2d/cocos2d-x/blob/cocos2d-x-3.7/docs/RELEASE_NOTES.md" target="_blank" rel="noopener">Release Note</a> 这个说明.</p>
<p>这个版本的发布日期是在2015年7月21.</p>
<p>原来的 Cocos2d-js 版本在 [GitHub] 上面已经停止更新了.</p>
<p>说明如下:</p>
<blockquote>
<p>2/27/2016 - This repository is no longer active.<br>Cocos2d-JS was merged with Cocos2d-x starting at version 3.7.</p>
</blockquote>
<p>可以看出, Cocos2d-js 原来独立的项目被合并到了 Cocos2d-x 中了.</p>
<p>现在使用 Cocos2d-x 不仅可以创建 cpp 项目和 lua 项目, 也可以创建 js 项目了.</p>
<p>官方有说明的:</p>
<blockquote>
<p>Cocos2d-JS is Cocos2d-x engine’s JavaScript version that includes Cocos2d-html5 and Cocos2d-x JavaScript Bindings.</p>
</blockquote>
<p>至于什么是 Cocos2d-x JavaScript Bindings, 大家自行 google, 这里不赘述.</p>
<p>关系图大概如下:<br><img src="/upload/images/2017/05/14/3.png" alt="1"></p>
<p>Cocos2d-x 框架图<br><img src="/upload/images/2017/05/14/4.jpg" alt="1"></p>
<h2 id="搭建-Cocos2d-js-开发环境"><a href="#搭建-Cocos2d-js-开发环境" class="headerlink" title="搭建 Cocos2d-js 开发环境"></a>搭建 Cocos2d-js 开发环境</h2><h4 id="1-下载-Cocos2d-x"><a href="#1-下载-Cocos2d-x" class="headerlink" title="1.下载 Cocos2d-x"></a>1.下载 Cocos2d-x</h4><p>可以在官网下载最新的 Release 包, 点击 下载地址, 我下载的最新包是 cocos2d-x-3.15.</p>
<p>下载解压即可, 这里我把 cocos2d-x-3.15 修改为 cocos2d-x.</p>
<h4 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h4><p>在 cocos2d-x 目录, 执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python setup.py</div></pre></td></tr></table></figure>
<p>执行完毕后, 可以看到 ‘~/.bash_profile` 的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># Add environment variable COCOS_CONSOLE_ROOT for cocos2d-x</div><div class="line">export COCOS_CONSOLE_ROOT=/Users/mark/workspace/mzProjs/c2dx/cocos2d-x/tools/cocos2d-console/bin</div><div class="line">export PATH=$COCOS_CONSOLE_ROOT:$PATH</div><div class="line"># Add environment variable COCOS_TEMPLATES_ROOT for cocos2d-x</div><div class="line">export COCOS_TEMPLATES_ROOT=/Users/mark/workspace/mzProjs/c2dx/cocos2d-x/templates</div><div class="line">export PATH=$COCOS_TEMPLATES_ROOT:$PATH</div></pre></td></tr></table></figure>
<p>这里, 没有看到我的 <code>ANT_ROOT</code> 路径, 其实该脚本智能的找到 <code>/usr/local/Cellar/ant/1.9.7/bin</code>, 但是我不想使用这个 ant, 想使用自己下载的 ant, 修改该文件如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># Add environment variable COCOS_CONSOLE_ROOT for cocos2d-x</div><div class="line">export COCOS_CONSOLE_ROOT=/Users/mark/workspace/mzProjs/c2dx/cocos2d-x/tools/cocos2d-console/bin</div><div class="line">export PATH=$COCOS_CONSOLE_ROOT:$PATH</div><div class="line"># Add environment variable ANT_ROOT for cocos2d-x</div><div class="line">export ANT_ROOT=/Users/mark/developer/apache/apache-ant-1.10.1/bin</div><div class="line">export PATH=$ANT_ROOT:$PATH</div><div class="line"># Add environment variable COCOS_TEMPLATES_ROOT for cocos2d-x</div><div class="line">export COCOS_TEMPLATES_ROOT=/Users/mark/workspace/mzProjs/c2dx/cocos2d-x/templates</div><div class="line">export PATH=$COCOS_TEMPLATES_ROOT:$PATH</div></pre></td></tr></table></figure>
<p>最后执行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source ~/.bash_profile</div></pre></td></tr></table></figure>
<p>使环境变量立即生效.</p>
<h4 id="创建-js-工程"><a href="#创建-js-工程" class="headerlink" title="创建 js 工程"></a>创建 js 工程</h4><p>cd 到任意目录, 执行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cocos new HelloJs -l js -d .</div></pre></td></tr></table></figure>
<blockquote>
<p>new HelloJs 表示工程名字为 HelloJs<br>-l js 表示创建 js 工程.<br>-d . 表示在当前路径创建该工程</p>
</blockquote>
<p>可以看到下面创建工程的过程:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Copy template into /Users/mark/workspace/mzProjs/c2dx/works/HelloJs</div><div class="line">Copying directory from cocos root directory...</div><div class="line">Copying files from template directory...</div><div class="line">Copying Cocos2d-x files...</div><div class="line">Rename project name from &apos;HelloJavascript&apos; to &apos;HelloJs&apos;</div><div class="line">Replace the project name from &apos;HelloJavascript&apos; to &apos;HelloJs&apos;</div><div class="line">Replace the project package name from &apos;org.cocos2dx.hellojavascript&apos; to &apos;org.cocos2dx.HelloJs&apos;</div><div class="line">Replace the Mac bundle id from &apos;org.cocos2dx.hellojavascript&apos; to &apos;org.cocos2dx.HelloJs&apos;</div><div class="line">Replace the iOS bundle id from &apos;org.cocos2dx.hellojavascript&apos; to &apos;org.cocos2dx.HelloJs&apos;</div></pre></td></tr></table></figure>
<p>工程目录:<br><img src="/upload/images/2017/05/14/1.jpg" alt="1"></p>
<h4 id="工程发布"><a href="#工程发布" class="headerlink" title="工程发布"></a>工程发布</h4><p>将上面的工程编译发布.</p>
<p>编译发布:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cocos compile -p web -m release</div></pre></td></tr></table></figure>
<blockquote>
<p>-p web 表示编译 web 平台.<br>-m release 表示编译为 release 模式.</p>
</blockquote>
<p>编译输出:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Building mode: release</div><div class="line">running: &apos;/Users/mark/developer/apache/apache-ant-1.10.1/bin/ant -f /Users/mark/workspace/mzProjs/c2dx/works/HelloJs/publish/html5/build.xml&apos;</div><div class="line">Buildfile: /Users/mark/workspace/mzProjs/c2dx/works/HelloJs/publish/html5/build.xml</div><div class="line">compile:</div><div class="line">   [jscomp] Compiling 156 file(s) with 42 extern(s)</div><div class="line">   [jscomp] 0 error(s), 0 warning(s)</div><div class="line">BUILD SUCCESSFUL</div><div class="line">Total time: 8 seconds</div></pre></td></tr></table></figure>
<p>如果你在这一步编译报错, 或者执行不下去, 一般都是没有在环境变量中配置好 ant.</p>
<p>编程成功后, 会多出 publish 目录:<br><img src="/upload/images/2017/05/14/2.jpg" alt="1"></p>
<h4 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h4><p>执行 cocos run 命令来在系统默认的浏览器上面运行.</p>
<p>cd 到工程目录, 执行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cocos run -p web -s . --port 9009</div></pre></td></tr></table></figure>
<p>这样会帮我们在本地启动一个 webServer 来运行示例, 直接打开了默认使用的浏览器.</p>
<blockquote>
<p>-s: 表示当前需要执行的源码路径<br>–port: 指定端口, 如果不指定端口, 默认在 8000 端口执行.</p>
</blockquote>
<p>更多 cocos run 命令可以, 使用下面的命令来查看帮助:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cocos run --help</div></pre></td></tr></table></figure>
<h2 id="本地运行-index-html-的问题"><a href="#本地运行-index-html-的问题" class="headerlink" title="本地运行 index.html 的问题"></a>本地运行 index.html 的问题</h2><p>你可以用火狐浏览器(FireFox)打开本地工程目录中的 index.html, 即可看到运行效果了.<br>FireFox 应该是在本地启动了一个 WebServer 来运行.</p>
<p>在 chrome 中直接运行 index.html, 无法看到最终效果, 一直卡在 loading 界面.</p>
<p>打开 inspect, 可以看到报错信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">XMLHttpRequest cannot load file:/xx/publish/html5/project.json.</div><div class="line">Cross origin requests are only supported for protocol schemes: http, data, chrome, chrome-extension, https.</div></pre></td></tr></table></figure>
<p>网上有人讨论过过问题, 说是 chrome 跨域不支持 file 协议，那么即使你允许 chrome 跨域支持, 直接运行本地的 index.html 还是报错:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">game.min.js:54 Uncaught TypeError: Cannot read property &apos;modules&apos; of null</div></pre></td></tr></table></figure>
<p>在 MacOS 上面允许 chrome 跨域访问文件的方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">open /Applications/Google\ Chrome.app --args --allow-file-access-from-files</div></pre></td></tr></table></figure>
<p>可以看出, 在这方面, FireFox 做的比 chrome 好.</p>
<h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><blockquote>
<p>更新时间 2017-10-15</p>
</blockquote>
<p>在微信公众号上面看到 <a href="https://mp.weixin.qq.com/s?__biz=MjM5ODAxNTM2NA==&amp;mid=2659646056&amp;idx=1&amp;sn=239871c3775ae12af5edf9ac2381b0b2" target="_blank" rel="noopener">一招教你辨别 Cocos、Cocos2d、Cocos2d-x</a> 这篇文章, 大家可以看看, 对 cocos 会有更加深入的了解.</p>
]]></content>
      
        <categories>
            
            <category> Game </category>
            
        </categories>
        
        
        <tags>
            
            <tag> cocos cocos2d-js </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[小小篮球队]]></title>
      <url>/2017/04/29/%E5%B0%8F%E5%B0%8F%E7%AF%AE%E7%90%83%E9%98%9F/</url>
      <content type="html"><![CDATA[<p><img src="/upload/images/2017/04/29/hua.jpeg" alt="1"></p>
<p>篮球, 我最喜欢的一项体育运动, 大学的业余时间基本都”泡”在球场, 压根不知道什么是累.</p>
<p>毕业后的第一份工作, 做的比较开心, 大家年龄相仿, 兴趣相投.</p>
<p>小小的团队, 没有任何纷争, 大家互相学习, 氛围及其融洽.</p>
<p>每个周五我们几个人都会提前下班去打一场篮球, 完事后, 一起喝点小酒, 那日子甭提有多他NND的惬意.</p>
<p>公司解散后, 大家各奔东西, 事过境迁, 各有各的工作和生活, 聚在一起的日子也是少之又少, 以前的日子只能怀念了.</p>
<p>人总需要一些非工作之外的兴趣, 整天围绕着工作, 早晚都会疯掉.</p>
<p>有些人喜欢泡泡图书馆, 有些人喜欢打打游戏, 有些人喜欢跑跑步, 有些人喜欢唱唱歌…</p>
<p>不管怎么样, 你需要某种爱好, 来润色一下你的生活, 我选择了篮球运动.</p>
<p>下面, 来说说篮球队中典型的几种人, 大家结合自己的工作和生活, 思考一下吧~</p>
<h2 id="单打独斗"><a href="#单打独斗" class="headerlink" title="单打独斗"></a>单打独斗</h2><p>篮球运动是一项集体运动, 需要每个人发挥自己应有的水平, 才能发挥团队的力量.</p>
<p>有些人喜欢单打独斗, 完全不考虑团队中其他成员的感受, 只要球到了他手中, 其他人只能看他的表演, 任凭你喊破嗓子, 他也不会理你.</p>
<p>这种人, 其实是有一定能力的人, 不然也不会也不可能这么做, 只是他们觉得凭一己之力就可以让大家高正无忧了, 自己没有思考过这样做是不是最合适的.</p>
<p>久而久之, 大家看着他的”表演”, 再也不想发挥了, 单打独斗的人慢慢的也累了, 最后大家都身心疲惫, 球队被对方轻而易举地打败.</p>
<h2 id="“指挥官”"><a href="#“指挥官”" class="headerlink" title="“指挥官”"></a>“指挥官”</h2><p>球队中有一种人, 自己不努力, 总是喜欢颐指气使, 经常听到他们说这样的话:</p>
<blockquote>
<p>你快点跑呀, 积极点…<br>死死地防着他, 不要让他进攻, 快…<br>你传球给我呀, 让你别着急, 好了吧, 输了吧…<br>输了, 都怪你…</p>
</blockquote>
<p>听到这些话, 再好脾气的人估计都难以接受, 脾气不好的直接开始打他了吧!</p>
<p>这种人最不受待见, 也最遭人唾骂, 这种人在实际工作中, 可能是你的领导.</p>
<h2 id="偷懒的"><a href="#偷懒的" class="headerlink" title="偷懒的"></a>偷懒的</h2><p>篮球运动的确很消耗体力, 如果在万箭齐发的时刻, 有人故意掉链子, 那将是功亏一篑.</p>
<p>大家在打球的时候, 都在为”荣誉”而战, 但是偏偏有人会使点小心眼, 能少跑一步就少跑一步, 能放对方走就放对方走, 绝对不伤害对方一毛一线. 明明可以稍微努力一下, 就可以拿到篮板, 偏偏让对方比自己还矮小的轻而易举的拿走了篮板.</p>
<p>要知道比自己矮小的那个人, 只是努力的跳了一下.</p>
<p>球场上虽然不是让你拼个你死我活, 不要求你全力以赴, 但是尽力而为总是要有的, 这是一种态度.</p>
<p>在实际工作中, 这种”队友”比比皆是, 但是不一定遭人恨, 有些还是很招人喜欢的, 毕竟他们没有抢你的功劳, 处处让着你, 没有他们的这些所谓的付出, 哪能衬托出你的光芒.</p>
<h2 id="鼓励你的"><a href="#鼓励你的" class="headerlink" title="鼓励你的"></a>鼓励你的</h2><p>上面说的都是一些”负能量”, 大家一笑而过吧.下面说点正能量的.</p>
<p>在球队中, 还有一种这样的人, 他会察言观色, 觉得你累了, 就告诉大家: “我们应该节奏慢一点, 缓冲一下.”,</p>
<p>当你手感不好的时候, 他会告诉你, 没事, 多来几次就好了, 不要有压力.</p>
<p>当你防守遇到困难时, 他会默默的给你补防, 给你接力, 最大程度的给你信心.</p>
<p>当大家士气不高的时候, 他会站出来投几个漂亮的球, 抑或给对方一个完美的盖帽, 并且鼓励大家不要放弃, 给大家信心, 做大家坚固的后盾.</p>
<p>这种人除了自己有一定的能力外, 还能顾全大局, 并且可以帮助队友, 帮助团队渡过难关, 确实难得.</p>
<h2 id="渴望进步的"><a href="#渴望进步的" class="headerlink" title="渴望进步的"></a>渴望进步的</h2><p>球队中, 存在一些新人, 或者是渴望自己能投出漂亮弧线球的人, 他们比不上那些资历老且经验丰富的前辈, 但是他们内心有一份信念: “我要变强!”.</p>
<p>这种人, 跟你讨论球技, 虚心向你学习一切可以提高球技的方法, 即使在观众席上, 他们也能聚精会神的观看, 自己领悟其中的奥妙. 只要你约他出来打球, 他都在第一时间出现在球场, 因为他不想放弃学习的机会.</p>
<p>久而久之, 这些人会变得越来越厉害, 通过不断的学习和摸索, 有了一套自己的打法, 步伐稳健, 再也不是那种接球不稳, 传球频频失误的”毛头小子”了.</p>
<p>这种人, 值得我们去挖掘和鼓励, 如果你正好是那个资历老且经验丰富的前辈, 就传授”真经”给他们吧.<br>对于你来说, 有人愿意跟你学习, 跟你分享, 也是美事一桩.</p>
<p>何乐而不为呢?</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>不管你遇到什么样的队友, 如果你愿意, 请胸怀宇宙(当然不是 孙连城 那种啊).</p>
<p>万事万物皆有联系, 愿你能偶尔放下手中的工作, 去选择和爱上另一种乐趣.</p>
<p>五一放假了, 祝大家节日快乐!</p>
]]></content>
      
        <categories>
            
            <category> 随笔 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 生活 思考 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS: 应用内打开 AppStore]]></title>
      <url>/2017/04/15/iOS-%E5%BA%94%E7%94%A8%E5%86%85%E6%89%93%E5%BC%80-AppStore/</url>
      <content type="html"><![CDATA[<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><p>我们的 App 需要在 AppStore 上面打开某个 App 或者游戏, 目的最常见的有:</p>
<blockquote>
<p>1.评分评论.<br>2.推荐下载(App 或者游戏).</p>
</blockquote>
<p>很多开发者知道打开 AppStore 只需要一句代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[[UIApplication sharedApplication] openURL:[NSURL URLWithString:@&quot;itunes app url&quot;]];</div></pre></td></tr></table></figure>
<p>这样就很简单的打开 AppStore 了, 但是产品经理问了, 能在我们应用内打开 AppStore 吗?</p>
<p>你当时懵逼了吗?</p>
<p>不要懵逼, 以后只要遇到类似这种问题, 你就问产品经理哪个 APP 这样做了?<br>然后, 他就给你看别人家的效果, 你就理直气壮地说: “别人可以做到的, 我们也可以做到!”.</p>
<p>应用内打开 AppStore 也很简单.<br>在 iOS6之后, 苹果已经给我们提供了 <a href="https://developer.apple.com/reference/storekit/skstoreproductviewcontroller#//apple_ref/doc/c_ref/SKStoreProductViewController" target="_blank" rel="noopener">SKStoreProductViewController</a>, 大家看一下文档, 你就笑了.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SKStoreProductViewController</div><div class="line">/* View controller to display iTunes Store product information */</div></pre></td></tr></table></figure>
<h2 id="应用内打开-AppStore"><a href="#应用内打开-AppStore" class="headerlink" title="应用内打开 AppStore"></a>应用内打开 AppStore</h2><p>这里我以在应用内打开 <code>微信</code> 为例子.</p>
<p>效果图如下:<br><img src="/upload/images/2017/04/15/eff_appstore_1.png" alt="1"></p>
<p>从效果图可以看出, 用户在自己的应用内打开 AppStore 后, 不仅可以下载或者打开微信, 还可以直接评论评分, 简直爽(也难怪产品经理这么干).</p>
<p>那我们说一下如何实现上面的效果.</p>
<p>实现方案和步骤</p>
<p>1.包含头文件 <code>#import &lt;StoreKit/StoreKit.h&gt;</code></p>
<p>2.实现 <code>SKStoreProductViewControllerDelegate</code></p>
<p>具体代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">- (void)openAppFromAppStore:(NSString *)appid</div><div class="line">&#123;</div><div class="line">	if (nil == appid || appid.length &lt;= 0) &#123;</div><div class="line">		return;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	// 加个 loading</div><div class="line">	</div><div class="line">	SKStoreProductViewController *store = [[SKStoreProductViewController alloc] init];</div><div class="line">	    </div><div class="line">	    store.delegate = self;</div><div class="line">	    </div><div class="line">	    NSDictionary&lt;NSString *, id&gt; *parameters = @&#123;SKStoreProductParameterITunesItemIdentifier: appid&#125;;</div><div class="line">	</div><div class="line">	    [store loadProductWithParameters:parameters completionBlock:^(BOOL result, NSError *error) &#123;</div><div class="line">	    </div><div class="line">	        // 结束 loading</div><div class="line">	        </div><div class="line">	        if (error) &#123;</div><div class="line">	            </div><div class="line">	            NSLog(@&quot;error %@ with userInfo %@&quot;, error, [error userInfo]);</div><div class="line">	            </div><div class="line">	            // 提示用户发生了错误</div><div class="line">	            </div><div class="line">	            // 或者通过 URL 打开 AppStore App.</div><div class="line">	            </div><div class="line">	            // NSString *url = @&quot;https://itunes.apple.com/in/app/wechat/id414478124?mt=8&quot;;</div><div class="line">	            </div><div class="line">	            //[[UIApplication sharedApplication] openURL:[NSURL URLWithString:url]];</div><div class="line">	        &#125;</div><div class="line">	        else &#123;</div><div class="line">	            </div><div class="line">	            [self presentViewController:store animated:YES completion:^&#123;</div><div class="line">	            &#125;];</div><div class="line">	        &#125;</div><div class="line">	    &#125;];</div><div class="line">&#125;</div><div class="line">/// 用户点击取消会执行该方法</div><div class="line">- (void)productViewControllerDidFinish:(SKStoreProductViewController *)viewController</div><div class="line">&#123;</div><div class="line">    [viewController dismissViewControllerAnimated:YES completion:^&#123;</div><div class="line">        </div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>调用(@”414478124” 是 微信 的)方式:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[self openAppFromAppStore:@&quot;414478124&quot;];</div></pre></td></tr></table></figure>
<h2 id="修改-AppStore-的导航栏"><a href="#修改-AppStore-的导航栏" class="headerlink" title="修改 AppStore 的导航栏"></a>修改 AppStore 的导航栏</h2><p>产品经理说, 既然你已经实现了上面的功能, 看看能不能把 AppStore 的导航栏改一个牛逼的颜色, 就像上面的大红色.</p>
<p>~</p>
<p>可以, 干!</p>
<p>直接上代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">- (void)openAppFromAppStore:(NSString *)appid</div><div class="line">&#123;</div><div class="line">	if (nil == appid || appid.length &lt;= 0) &#123;</div><div class="line">		return;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	// 加个 loading</div><div class="line">	</div><div class="line">	// 导航栏上面的文字和图片颜色变了</div><div class="line">	[[UINavigationBar appearance] setTintColor:[UIColor greenColor]];</div><div class="line">    </div><div class="line">    // 导航栏的大红色出来了</div><div class="line">    [[UINavigationBar appearance] setBarTintColor:[UIColor redColor]];</div><div class="line">    </div><div class="line">    [UINavigationBar appearanceWhenContainedIn:[SKStoreProductViewController class], nil];</div><div class="line">	</div><div class="line">	SKStoreProductViewController *store = [[SKStoreProductViewController alloc] init];</div><div class="line">	    </div><div class="line">	    store.delegate = self;</div><div class="line">	    </div><div class="line">	    NSDictionary&lt;NSString *, id&gt; *parameters = @&#123;SKStoreProductParameterITunesItemIdentifier: appid&#125;;</div><div class="line">	</div><div class="line">	    [store loadProductWithParameters:parameters completionBlock:^(BOOL result, NSError *error) &#123;</div><div class="line">	        </div><div class="line">	        // 结束 loading</div><div class="line">	        </div><div class="line">	        if (error) &#123;</div><div class="line">	            </div><div class="line">	            NSLog(@&quot;error %@ with userInfo %@&quot;, error, [error userInfo]);</div><div class="line">	            </div><div class="line">	            // 提示用户发生了错误</div><div class="line">	            </div><div class="line">	            // 或者通过 URL 打开 AppStore App.</div><div class="line">	        &#125;</div><div class="line">	        else &#123;</div><div class="line">	            </div><div class="line">	            [self presentViewController:store animated:YES completion:^&#123;</div><div class="line">	            &#125;];</div><div class="line">	        &#125;</div><div class="line">	    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>1.打开 <code>SKStoreProductViewController</code> 目前只能使用 <code>present</code> 方式, 不可以使用 <code>push</code> 的方式.</p>
<p>否则会报错:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//Terminating app due to uncaught exception &apos;SKUnsupportedPresentationException&apos;,</div><div class="line">//reason: &apos;SKStoreProductViewController must be used in a modal view controller&apos;</div></pre></td></tr></table></figure>
<p>2.加入 loading</p>
<p>在应用内打开 AppStore, 为了不让用户傻等(网络不好的时候, 打开很慢), 可以加入 loading, 缓解一下用户急躁的心情.</p>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> AppStore iOS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[找合伙人, 不易]]></title>
      <url>/2017/03/26/%E6%89%BE%E5%90%88%E4%BC%99%E4%BA%BA-%E4%B8%8D%E6%98%93/</url>
      <content type="html"><![CDATA[<p>早在高中时期, 读过 &lt;三言&gt; 中的 &lt;警世通言&gt;, 第一章写的是 <code>俞伯牙摔琴谢知音</code>, 讲的是钟子期和俞伯牙的故事.</p>
<p>读完之后, 整个人都觉得难受, 心理有说不出的滋味, 眼泪竟夺眶而出.</p>
<p>流传的这首诗, 可以感受下.</p>
<blockquote>
<p>摔碎瑶琴凤尾寒，子期不在对谁弹！<br>春风满面皆朋友，欲觅知音难上难。<br>势利交怀势利心，斯文谁复念知音！<br>伯牙不作钟期逝，千古令人说破琴。</p>
</blockquote>
<p>自己工作之后, 对 <code>欲觅知音难上难</code> 这句话尤为赞同.</p>
<p>年少轻狂的你, 藏着要改变世界的心, 残酷的现实会抹去你凸起的棱角, 岁月和环境会让你变得越发不安.</p>
<p>不安的世界, 让你茫然.</p>
<p>于是, 点上一支烟, 回顾折腾的人生, 笑叹: 别人笑我太疯癫, 我笑他人看不穿.</p>
<p>可惜, 我们不是唐寅, 没有这份洒脱和奔放, 毕竟时代也大相径庭.</p>
<p>~ 好了, 回到现实中来.</p>
<p>刚毕业, 你会把主要精力放在如何把工作做好, 维持自己的生计上面, 如果能跟身边的大牛学到一些专业知识, 再苦再累, 你都是开心的.</p>
<p>渐渐地, 你发现知识(专业的和非专业的知识)真是要活到老学到老, 永无止境, 无法像武侠片里面演得那样移花接木, 斗转星移. 呜呼, 脚踏实地的做好本职工作, 顺便能拓展一下自己的交际圈, 扩大自己的知识面, 还是很有必要的.</p>
<p>各行各业都有非常突出的人才, 很多时候, 我们只能望洋兴叹.</p>
<p>如果你能遇到一个肯与你分享和交流, 或者是愿意将自己的实践分享给你的人, 那你算是上辈子积了大德了. 阿弥陀佛!</p>
<p>我把这样的人称之为 <code>恩人</code>, 也算是 <code>知音</code>.</p>
<p>以前, 很多朋友会问如果将来自己开公司, 是否愿意接受现在的自己, 我的回答是一定接受. 如果还有人问这个问题, 我会另外再追加一个问题:</p>
<blockquote>
<p>如果你开公司, 你是否愿意接受和你现在一起工作的同事?或者说你是否愿意让他成为你的合伙人?</p>
</blockquote>
<p>这些问题, 看似玩笑, 实则很现实很残酷, 一旦你决定要去做成某件事情, 立志要实现自己的抱负和理想的时候, 你的立场会和其他人千差外别.首先要考虑的是要和谁一起共谋事, 才能真正的帮到自己, 并且也能帮到别人.因为选择是双向的, 能找到和你一拍即合的人, 也确实不易.但愿任何一个渴望成功并付出行动的人, 能找到自己的合伙人, 找到自己的知音.</p>
<p>真正的成功者, 不是沉浸在多少人让你成功的喜悦中, 而是你让多少人和你一起分享了成功的喜悦的人.</p>
<p>说到这里, 本人只是想说明白一个道理, 送给即将或者已经在职场奋斗的人:</p>
<blockquote>
<p>踏踏实实的做事并没有错, 但是找到值得 “托付终身” 的人确实不易, 你现在能做的只有用知识来武装自己, 让自己变强.</p>
</blockquote>
<p>在职场中, 你会遇到很多让你不爽的人或者事. 记住, 要做到 <code>对事不对人</code>, 不要太委屈自己, 大丈夫能屈能伸, 该出手时就出手, 没有什么大不了.</p>
<p>如果真的觉得有些人或者有些事不值得你浪费时间, 就离它们远点. 惹不起但可以躲得起, 你说呢?</p>
<p>酌一壶小酒, 老夫聊发少年狂!</p>
]]></content>
      
        <categories>
            
            <category> 随笔 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 思考 生活 合伙人 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[让自己变强]]></title>
      <url>/2017/03/10/%E8%AE%A9%E8%87%AA%E5%B7%B1%E5%8F%98%E5%BC%BA/</url>
      <content type="html"><![CDATA[<p>当你读到这篇文章的时候, 我其实还不知道『怎么让自己变强』.<br>具体说, 就是没有一套让你或者让他变强的武林秘籍.</p>
<p>只能结合自己经历的事, 分享给大家, 希望能感同身受!</p>
<p>这几天加班加地有点猛, 浑然不知周末轮回了.<br>心理总是在念叨, 好久没有在公众号涂鸦了, 手痒痒了.<br>趁今晚回来早(22:30回到家), 就动笔了.</p>
<p>『让自己变强』, 这句话说着很简单, 但不是任何人都能意识到这几个字带来的力量.</p>
<p>在「明朝那些事儿」中有这么一段:</p>
<blockquote>
<p>我们经常会产生一个疑问，那就是怎样才能获得其他国家及其人民的尊重，在世界上风光自豪一把，其实答案很简单——国家强大。</p>
</blockquote>
<p>看到这里, 感触颇深.</p>
<h2 id="在团队中成长"><a href="#在团队中成长" class="headerlink" title="在团队中成长"></a>在团队中成长</h2><p>团队成长的主观条件是团队的成员要成长, 不然团队哪里来的成长.</p>
<p>如果你是作为一个团队或者小组的负责人, 会面临各种各样的问题, 比如需要跟团队以外的部门谈合作, 需要跟老板汇报工作, 还要处理内部的问题等等诸如此类!</p>
<p>我觉得安邦需安内, 也就是说要先搞定团队内部的各种事物, 人是比较复杂的感情动物, 你不好也不能控制别人的情绪. 所以, 需要对事不对人!你不能说, 你看他长得不好看, 就知道工作做不好类似的话.</p>
<p>这样一说, 基本两个人就结下了梁子.迟早会爆发.</p>
<p>首先, 要给团队成员希望, 让大家都认识到有统一的目标.</p>
<p>其次, 让每个人给出工作和实行计划, 制定自己的考核目标.对做出突出贡献的成员奖励, 每个人都需要得到尊重, 而奖励是最大的尊重.</p>
<p>最后, 加强与团队成员之间的沟通, 互相帮助, 让大家能够相互信任和鼓励, 良好有效的沟通, 事半功倍.</p>
<p>作为团队负责人, 肯定希望手下的人各个骁勇善战, 百战百胜, 但是现实中很难做到, 其实也没有必要.<br>西游记告诉我们, 唐僧带领的团队才是最好的团队.</p>
<h2 id="少埋怨多给予帮助"><a href="#少埋怨多给予帮助" class="headerlink" title="少埋怨多给予帮助"></a>少埋怨多给予帮助</h2><p>每个人生活和工作的环境不一样, 在不同的地点不同的时间面对不同的事情, 都会有不同的看法.</p>
<p>世界上任何一种选择, 都是命中注定的, 没有人能强迫你去做出任何错误的选择, 除了你自己.</p>
<p>在自己所处的环境中, 要么你能改变环境使其来适应自己, 要么就离开这个自己不适应的环境, 不要去抱怨.</p>
<p>唉声叹气, 不仅仅影响自己的工作效率和生活质量, 还会影响到别人.<br>成天在抱怨, 觉得谁谁都不行, 自己才是最牛逼的, 日行见久, 你就是那个充满负能量的人, 当别人觉悟到的时候, 就会离你而去, 岂不咎由自取?!我想这也是微信朋友圈只有点赞没有非点赞的原因吧!</p>
<p>如果觉得自己的同事或者朋友有所欠缺, 就想办法去帮助他, 鼓励他, 把你认为一些好的方式和方法传授给他. 说不定哪天因为你的一句话或者一个方法, 他就走上人生巅峰了, 哈哈!</p>
<p>从现在开始, 忘记埋怨, 给予别人更多的帮助和鼓励.</p>
<h2 id="培养自己的专注力"><a href="#培养自己的专注力" class="headerlink" title="培养自己的专注力"></a>培养自己的专注力</h2><p>专注力, 是一个很神奇的东西.</p>
<p>如果一个人没有专注力, 很难再有所突破, 据说牛顿是在做梦的时候, 发明了很多折磨广大青少年的牛顿定律的.</p>
<p>每个人在自己的行业上, 多少都有短板. 有短板是情有可原的, 但是首先你得认识到自己的短板, 然后再指定计划去突破他.</p>
<blockquote>
<p>要想进步, 必须面对自己的不足.</p>
</blockquote>
<p>比如, 工作上需要你学会某种技术, 如果在某个时间点, 你没有学会, 可能就会丢掉饭碗, 你就会不顾一切的去学习, 直到学会会用为止. 这个过程, 你就是在专注这件事情, 回头想想咬咬牙, 还是可以办到的, 没有什么大不了的.</p>
<p>每天给自己一点时间, 专注去做一件事情, 坚持下来, 你会发现, 学习和进步就是 feel feel 倍儿爽.</p>
<h2 id="最后分享给大家一句话"><a href="#最后分享给大家一句话" class="headerlink" title="最后分享给大家一句话:"></a>最后分享给大家一句话:</h2><blockquote>
<p>不能改变别人的时候, 试着改变一下自己或许就能把事情变通了.</p>
</blockquote>
]]></content>
      
        <categories>
            
            <category> 随笔 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 随笔 生活 反思 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Tomcat8 配置 HTTPS]]></title>
      <url>/2017/02/15/Tomcat8-%E9%85%8D%E7%BD%AE-HTTPS/</url>
      <content type="html"><![CDATA[<p>博客 [Tomcat8 域名配置] 介绍了如何在本地配置 Tomcat8 的域名以及通过域名来访问对应的资源.</p>
<p>今天继续跟大家分享如何配置 Tomcat8 的 HTTPS (单向认证), 本篇博客的主要内容如下:</p>
<blockquote>
<p>1.配置 Tomcat 的 HTTPS.<br>2.通过 HTTPS + ip 的方式来访问资源.<br>3.通过 HTTPS + 域名 的方式来访问资源.</p>
</blockquote>
<h2 id="配置要求"><a href="#配置要求" class="headerlink" title="配置要求"></a>配置要求</h2><p>1.安装了 JDK, 并配置了其相关的环境变量.可参考 Mac 配置 JDK1.8.</p>
<p>2.安装了 Tomcat8, 并配置了其相关的环境变量.可参考 Mac 配置 Tomcat8.</p>
<h2 id="生成证书"><a href="#生成证书" class="headerlink" title="生成证书"></a>生成证书</h2><blockquote>
<p>获取证书可以去购买, 这里是在本地机器搭建, 使用 JDK 自带的工具 keytool 生成即可.</p>
</blockquote>
<p>打开 mac 终端, 执行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">keytool -v -genkey -alias tomcat -keyalg RSA -keystore ~/Desktop/tomcat.keystore</div></pre></td></tr></table></figure>
<p>紧接着, 会出现一些让你输入信息的交互信息, 第一个是让你输入 密钥库密码(口令), 我输入的是 1234567, 其他信息可以任意输入内容, 在最后一步, 问你生成的 密钥口令 和 密钥库的口令 是否相同, 如果相同就直接回车, 我这里是直接回车的, 即密码相同, 都是 1234567.</p>
<p>这样就生成了所谓的证书.</p>
<h2 id="配置-HTTPS"><a href="#配置-HTTPS" class="headerlink" title="配置 HTTPS"></a>配置 HTTPS</h2><blockquote>
<p>通过修改 server.xml 来配置.</p>
</blockquote>
<p>将 tomcat.keystore 文件复制到 Tomcat 的 conf 目录.</p>
<p>修改 server.xml 文件, 增加一个 Connector, 内容如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;Connector port=&quot;8443&quot; protocol=&quot;org.apache.coyote.http11.Http11NioProtocol&quot;  </div><div class="line">           maxThreads=&quot;150&quot; SSLEnabled=&quot;true&quot; scheme=&quot;https&quot; secure=&quot;true&quot;  </div><div class="line">           clientAuth=&quot;false&quot; sslProtocol=&quot;TLS&quot; keystoreFile=&quot;conf/tomcat.keystore&quot; keystorePass=&quot;1234567&quot;/&gt;</div></pre></td></tr></table></figure>
<p>注意, keystoreFile 是证书文件, keystorePass 是密码, 这里配置一定要正确.</p>
<h2 id="配置-HTTPS-IP"><a href="#配置-HTTPS-IP" class="headerlink" title="配置 HTTPS + IP"></a>配置 HTTPS + IP</h2><p>配置一个虚拟主机, 修改 server.xml 文件, 增加 Host:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;Host name=&quot;192.168.1.103&quot; debug=&quot;0&quot; appBase=&quot;webapps&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot; xmlValidation=&quot;false&quot;  xmlNamespaceAware=&quot;false&quot;&gt;</div><div class="line">	&lt;Context path=&quot;&quot; docBase=&quot;test&quot; debug=&quot;0&quot; reloadable=&quot;true&quot; crossContext=&quot;true&quot;/&gt;</div><div class="line">	&lt;Logger className=&quot;org.apache.catalina.logger.FileLogger&quot; directory=&quot;logs&quot; prefix=&quot;tot_log.&quot; suffix=&quot;.txt&quot; timestamp=&quot;true&quot;/&gt;</div><div class="line">&lt;/Host&gt;</div></pre></td></tr></table></figure>
<p>配置 name=”192.168.1.103” 是你本机的 ip 地址.</p>
<p>这个在博客 [iOS: 聊聊 UIWebView 缓存] 中有详细的介绍, 这里不再赘述.</p>
<p>启动 Tomcat, 进行测试.</p>
<p>这里需要到 Tomcat 的 bin 目录下, 执行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo startup.sh</div></pre></td></tr></table></figure>
<p>启动成功后, 打开浏览器, 输入: <a href="https://192.168.1.103:8443/test.html" target="_blank" rel="noopener">https://192.168.1.103:8443/test.html</a>, 这个时候, 会弹出如下的警告(提示不安全):<br><img src="/upload/images/2017/02/15/1.png" alt="1"></p>
<p>直接点击 Advanced 后再点击 Proceed to 192.168.1.103:8443(unsafe) 处理即可看到页面内容.</p>
<h2 id="配置-HTTPS-域名"><a href="#配置-HTTPS-域名" class="headerlink" title="配置 HTTPS + 域名"></a>配置 HTTPS + 域名</h2><p>修改 server.xml, 增加 Connector:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;Connector port=&quot;8443&quot; protocol=&quot;org.apache.coyote.http11.Http11NioProtocol&quot;  </div><div class="line">          maxThreads=&quot;150&quot; SSLEnabled=&quot;true&quot; scheme=&quot;https&quot; secure=&quot;true&quot;  </div><div class="line">          clientAuth=&quot;false&quot; sslProtocol=&quot;TLS&quot; keystoreFile=&quot;conf/tomcat.keystore&quot; keystorePass=&quot;1234567&quot;/&gt;</div></pre></td></tr></table></figure>
<p>修改 server.xml, 增加 Host:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;Host name=&quot;www.mark.com&quot; debug=&quot;0&quot; appBase=&quot;webapps&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot; xmlValidation=&quot;false&quot;  xmlNamespaceAware=&quot;false&quot;&gt;</div><div class="line">	&lt;Context path=&quot;&quot; docBase=&quot;test&quot; debug=&quot;0&quot; reloadable=&quot;true&quot; crossContext=&quot;true&quot;/&gt;</div><div class="line">	&lt;Logger className=&quot;org.apache.catalina.logger.FileLogger&quot; directory=&quot;logs&quot; prefix=&quot;tot_log.&quot; suffix=&quot;.txt&quot; timestamp=&quot;true&quot;/&gt;</div><div class="line">&lt;/Host&gt;</div></pre></td></tr></table></figure>
<p>修改 /etc/host 文件, 增加:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">127.0.0.1 www.mark.com</div></pre></td></tr></table></figure>
<p>启动 Tomcat, 在 bin 目录, 执行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">shutdown.sh</div><div class="line">sudo startup.sh</div></pre></td></tr></table></figure>
<p>启动成功后, 打开浏览器, 输入 <a href="https://www.mark.com:8443/test.html" target="_blank" rel="noopener">https://www.mark.com:8443/test.html</a>, 如果弹出警告, 可以像如上处理来显示页面内容.</p>
<p>如果你这里配置失败了, 请修改一下端口号, 如将 8443 改为 8433.<br>重启 Tomcat 在试一下.</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>Apache 官方文档: <a href="https://tomcat.apache.org/tomcat-8.0-doc/ssl-howto.html" target="_blank" rel="noopener">ssl-howto</a></p>
]]></content>
      
        <categories>
            
            <category> Server </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Tomcat Java Apache </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Tomcat8 域名配置]]></title>
      <url>/2017/02/13/Tomcat8-%E5%9F%9F%E5%90%8D%E9%85%8D%E7%BD%AE/</url>
      <content type="html"><![CDATA[<p>博客 [Mac 配置 Tomcat8] 介绍了在 Mac 下安装和启动 Tomcat.</p>
<p>接下来介绍, 如何在本地配置 Tomcat8 的域名.</p>
<p>网上有很多关于 Tomcat 如何配置单域名或者多域名的文章, 很多都是翻译或者复制别人的, 根本没有实践过, 害人不浅!</p>
<p>结合自己的实践, 把配置的整个过程分享给大家, 希望能帮到你.</p>
<p>下面进入正题.</p>
<h2 id="修改端口"><a href="#修改端口" class="headerlink" title="修改端口"></a>修改端口</h2><p>在 Tomcat 的安装(其实是解压的)目录 /conf 下有 server.xml 文件.</p>
<p>将下面内容:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;</div><div class="line">              connectionTimeout=&quot;20000&quot;</div><div class="line">              redirectPort=&quot;8443&quot; /&gt;</div></pre></td></tr></table></figure>
<p>修改为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;Connector port=&quot;80&quot; protocol=&quot;HTTP/1.1&quot;</div><div class="line">              connectionTimeout=&quot;20000&quot;</div><div class="line">              redirectPort=&quot;8443&quot; /&gt;</div></pre></td></tr></table></figure>
<h2 id="添加-web-项目"><a href="#添加-web-项目" class="headerlink" title="添加 web 项目"></a>添加 web 项目</h2><blockquote>
<p>这一步主要是为了后面测试.</p>
</blockquote>
<p>很简单, 在 Tomcat 的安装目录 webapps 下面新建 test 文件夹, 里面创建一个 html 文件即可.<br>这里将其命名为 test.html.</p>
<p>test.html 内容见后面的附录即可.</p>
<h2 id="配置域名"><a href="#配置域名" class="headerlink" title="配置域名"></a>配置域名</h2><blockquote>
<p>增加虚拟主机配置.还需要修改 server.xml 文件.</p>
</blockquote>
<p>在 server.xml 文件中, 在标签 <engine> 和</engine> 之间增加下面的内容:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;Host name=&quot;www.mark.com&quot; debug=&quot;0&quot; appBase=&quot;webapps&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot; xmlValidation=&quot;false&quot;  xmlNamespaceAware=&quot;false&quot;&gt;</div><div class="line">    &lt;Context path=&quot;&quot; docBase=&quot;test&quot; debug=&quot;0&quot; reloadable=&quot;true&quot; crossContext=&quot;true&quot;/&gt;</div><div class="line">    &lt;Logger className=&quot;org.apache.catalina.logger.FileLogger&quot; directory=&quot;logs&quot; prefix=&quot;tot_log.&quot; suffix=&quot;.txt&quot; timestamp=&quot;true&quot;/&gt;</div><div class="line">&lt;/Host&gt;</div></pre></td></tr></table></figure>
<p>其中, www.mark.com 是我自己任意取的一个域名, docBase=”test” 是指向上面新建的 test 目录.</p>
<h2 id="配置域名解析"><a href="#配置域名解析" class="headerlink" title="配置域名解析"></a>配置域名解析</h2><p>由于部署在本地, 需要修改 host.</p>
<p>修改 /etc/host 文件, 需要 sudo 权限:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo vim /etc/host</div></pre></td></tr></table></figure>
<p>增加如下内容:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">127.0.0.1 www.mark.com</div></pre></td></tr></table></figure>
<h2 id="验证配置"><a href="#验证配置" class="headerlink" title="验证配置"></a>验证配置</h2><blockquote>
<p>这一步, 验证配置是否生效.</p>
</blockquote>
<p>启动 Tomcat, 这里的操作比较特殊, 需要 sudo 权限来启动 Tomcat, 否则会报下面的错误:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">org.apache.coyote.AbstractProtocol.init Failed to initialize end point associated with ProtocolHandler [&quot;http-nio-80&quot;]</div><div class="line"> java.net.SocketException: Permission denied</div></pre></td></tr></table></figure>
<p>因为, 只有 root 用户才可以使用 1024 以下的端口号.</p>
<p>正确姿势:</p>
<p>cd 进入 Tomcat 的 bin 目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cd ~/Tomcat/bin</div></pre></td></tr></table></figure>
<p>执行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo startup.sh</div></pre></td></tr></table></figure>
<p>成功后, 打开浏览器, 输入 <a href="http://www.mark.com/test.html" target="_blank" rel="noopener">http://www.mark.com/test.html</a>, 即可看到页面内容.</p>
<h2 id="配置另一个域名"><a href="#配置另一个域名" class="headerlink" title="配置另一个域名"></a>配置另一个域名</h2><p>可以配置另外的一个域名, 比如 www.ithome.com, 即多增加一个虚拟主机配置.</p>
<p>在 server.xml 增加:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;Host name=&quot;www.ithome.com&quot; debug=&quot;0&quot; appBase=&quot;webapps&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot; xmlValidation=&quot;false&quot;  xmlNamespaceAware=&quot;false&quot;&gt;</div><div class="line">    &lt;Context path=&quot;&quot; docBase=&quot;test&quot; debug=&quot;0&quot; reloadable=&quot;true&quot; crossContext=&quot;true&quot;/&gt;</div><div class="line">    &lt;Logger className=&quot;org.apache.catalina.logger.FileLogger&quot; directory=&quot;logs&quot; prefix=&quot;tot_log.&quot; suffix=&quot;.txt&quot; timestamp=&quot;true&quot;/&gt;</div><div class="line">&lt;/Host&gt;</div></pre></td></tr></table></figure>
<p>配置 DNS, 同理修改 etc/host 文件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">127.0.0.1 www.ithome.com</div></pre></td></tr></table></figure>
<p>可以看出, 在浏览器输入 <a href="http://www.ithome.com/test.html" target="_blank" rel="noopener">http://www.ithome.com/test.html</a> 和 <a href="http://www.mark.com/test.html" target="_blank" rel="noopener">http://www.mark.com/test.html</a> 效果是一样的.</p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p>test.html 文件内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">&lt;p&gt;</div><div class="line">&lt;em&gt;Sample&lt;/em&gt; text&lt;/p&gt;</div><div class="line">&lt;p&gt;</div><div class="line">Now I input another line, with fancy&lt;u&gt;&lt;strong&gt;&lt;em&gt;styles&lt;/em&gt;&lt;/strong&gt;</div><div class="line">&lt;/u&gt;.&lt;/p&gt;</div><div class="line">&lt;p&gt;</div><div class="line">&lt;em&gt;Sample&lt;/em&gt; text&lt;/p&gt;</div><div class="line">&lt;p&gt;</div><div class="line">Now I input another line, with fancy &lt;u&gt;&lt;strong&gt;&lt;em&gt;styles&lt;/em&gt;&lt;/strong&gt;</div><div class="line">&lt;/u&gt;.&lt;/p&gt;</div><div class="line">&lt;p&gt;</div><div class="line">    mark.zhang is an itman.</div><div class="line">&lt;/p&gt;</div><div class="line">&lt;style&gt;</div><div class="line">.button &#123;</div><div class="line">    background-color: #4CAF50;</div><div class="line">    border: none;</div><div class="line">    color: white;</div><div class="line">    padding: 15px 32px;</div><div class="line">    text-align: center;</div><div class="line">    text-decoration: none;</div><div class="line">    display: inline-block;</div><div class="line">    font-size: 86px;</div><div class="line">    margin: 50px 200px 100px 300px;</div><div class="line">    cursor: pointer;</div><div class="line">    border-radius: 15;</div><div class="line">&#125;</div><div class="line">&lt;/style&gt;</div><div class="line">&lt;p&gt;</div><div class="line">   &lt;button type=&quot;button&quot; onclick=&quot;myFunction()&quot; class=&quot;button&quot;&gt;Try it&lt;/button&gt;</div><div class="line">&lt;/p&gt;</div><div class="line">&lt;script&gt;</div><div class="line">   function myFunction() &#123;</div><div class="line">       alert(&quot;Blog: www.veryitman.com&quot;);</div><div class="line">   &#125;;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Server </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Tomcat Java </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ATS: HTTPS 认证]]></title>
      <url>/2017/02/08/ATS-HTTPS-%E8%AE%A4%E8%AF%81/</url>
      <content type="html"><![CDATA[<p>在 ATS: HTTP/HTTPS 协议介绍 中介绍了一些关于 HTTP/HTTPS 的概念以及相关的基本知识.</p>
<p>今天来聊聊关于 HTTPS 的认证方式和过程.</p>
<p>说 HTTPS 认证前, 先了解几个概念.</p>
<h2 id="关于加密的几个概念"><a href="#关于加密的几个概念" class="headerlink" title="关于加密的几个概念"></a>关于加密的几个概念</h2><h4 id="1-SSL-协议加密方式"><a href="#1-SSL-协议加密方式" class="headerlink" title="1. SSL 协议加密方式"></a>1. SSL 协议加密方式</h4><blockquote>
<p>SSL 既用了对称加密, 也用了非对称加密(公钥加密).</p>
</blockquote>
<p>在建立传输链路时, SSL 首先对对称加密的密钥使用公钥进行非对称加密, 链路建立好之后，SSL 对传输内容使用对称加密.</p>
<p>下面是两种加密方式的对比:</p>
<p>1.对称加密</p>
<blockquote>
<p>对称加密采用了对称密码编码技术，它的特点是文件加密和解密使用相同的密钥，即加密密钥也可以用作解密密钥，这种方法在密码学中叫做 对称加密算法，对称加密算法使用起来简单快捷，密钥较短，且破译困难，除了数据加密标准（DES），另一个对称密钥加密系统是国际数据加密算法（IDEA），它比DES的加密性好，而且对计算机功能要求也没有那么高.<br>IDEA 加密标准由 PGP（Pretty Good Privacy）系统使用.</p>
</blockquote>
<p>该加密方式, 速度快, 可加密内容较大, 用来加密会话过程中的消息.</p>
<p>2.公钥加密(非对称加密)</p>
<blockquote>
<p>1976年，美国学者 Dime 和 Henman 为解决信息公开传送和密钥管理问题，提出一种新的密钥交换协议，允许在不安全的媒体上的通讯双方交换信息，安全地达成一致的密钥，这就是“公开密钥系统”.<br>相对于 对称加密算法 这种方法也叫做 非对称加密算法.<br>与对称加密算法不同，非对称加密算法需要两个密钥：公开密钥（publickey）和私有密钥（privatekey）. 公开密钥与私有密钥是一对，如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密；如果用私有密钥对数据进行加密，那么只有用对应的公开密钥才能解密.<br>因为加密和解密使用的是两个不同的密钥，所以这种算法叫作非对称加密算法。</p>
</blockquote>
<p>该加密方式, 速度较慢, 能提供更好的身份认证技术, 用来加密对称加密的密钥.</p>
<h4 id="2-数字证书"><a href="#2-数字证书" class="headerlink" title="2. 数字证书"></a>2. 数字证书</h4><p>一种文件的名称，好比一个机构或人的签名，能够证明这个机构或人的真实性. 其中包含的信息，用于实现上述功能.</p>
<h4 id="3-加密和认证"><a href="#3-加密和认证" class="headerlink" title="3. 加密和认证"></a>3. 加密和认证</h4><p>加密 是指通信双方为了防止铭感信息在信道上被第三方窃听而泄漏，将明文通过加密变成密文，如果第三方无法解密的话，就算获得密文也无能为力.</p>
<p>认证 是指通信双方为了确认对方是值得信任的消息发送或接受方，而不是使用假身份的非法者，采取的确认身份的方式.</p>
<p>只有同时进行了加密和认证才能保证通信的安全，因此在 SSL 通信协议中这两者(加密和认证)都被使用.</p>
<p>加密一般使用 <code>对称加密算法</code> 和 <code>不对称加密算法</code>，不对称加密最常见的算法就是 RSA.</p>
<h4 id="4-消息摘要"><a href="#4-消息摘要" class="headerlink" title="4. 消息摘要"></a>4. 消息摘要</h4><p>这个技术主要是为了避免消息被篡改.</p>
<p>消息摘要是把一段信息, 通过某种算法, 得出一串字符串.<br>这个字符串就是消息的摘要.如果消息被篡改(发生了变化), 那么摘要也一定会发生变化(如果2个不同的消息生成的摘要是一样的，那么这就叫发生了碰撞).</p>
<p>消息摘要的算法主要有 MD5 和 SHA，在证书领域，一般都是用 SHA(安全哈希算法).</p>
<p>数字证书、加密和认证、消息摘要三个技术结合起来，就是在 HTTPS 中广泛应用的证书(certificate), 证书本身携带了加密/解密的信息，并且可以标识自己的身份，也自带消息摘要.</p>
<h2 id="HTTPS-认证方式"><a href="#HTTPS-认证方式" class="headerlink" title="HTTPS 认证方式"></a>HTTPS 认证方式</h2><p>分为单向和双向认证.</p>
<h3 id="单向认证"><a href="#单向认证" class="headerlink" title="单向认证"></a>单向认证</h3><blockquote>
<p>单向认证较简单, 只需要服务端校验服务端的证书的合法性.</p>
</blockquote>
<p>该认证过程使用下面的流程图来表示:<br><img src="/upload/images/2017/02/08/HTTPS_Single.png" alt="1"></p>
<h3 id="双向认证"><a href="#双向认证" class="headerlink" title="双向认证"></a>双向认证</h3><p>双向认证和单向认证原理基本一致，但是需要双方都校验对方的证书的合法性.</p>
<p>该认证过程使用下面的流程图来表示:<br><img src="/upload/images/2017/02/08/HTTPS_Double.png" alt="1"></p>
<h3 id="随机数的产生"><a href="#随机数的产生" class="headerlink" title="随机数的产生"></a>随机数的产生</h3><p>不管是单向认证, 还是双向认证, 都有随机数的产生和发送.</p>
<p>下图是随机数的产生流程图:<br><img src="/upload/images/2017/02/08/HTTPS_Random.png" alt="1"></p>
<p>生成对话密钥, 一共需要三个随机数.</p>
<h2 id="推荐"><a href="#推荐" class="headerlink" title="推荐"></a>推荐</h2><p>推荐在线流程图工具:</p>
<p><a href="http://www.veryitman.com/2017/02/08/www.processon.com" target="_blank" rel="noopener">ProcessOn</a>.</p>
<p>推荐博文:</p>
<p>1.<a href="http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html" target="_blank" rel="noopener">图解SSL/TLS协议</a></p>
<p>2.<a href="http://www.ruanyifeng.com/blog/2011/02/seven_myths_about_https.html" target="_blank" rel="noopener">HTTPS的七个误解(译文)</a></p>
<p>3.<a href="http://blog.sina.com.cn/s/blog_56d8ea900100bzpr.html" target="_blank" rel="noopener">对称加密和非对称加密介绍和区别</a></p>
<p>本文中引用了上面文章的部分内容, 感谢这些作者.</p>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> HTTP HTTPS TLS SSL </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ATS: HTTP/HTTPS 协议介绍]]></title>
      <url>/2017/02/06/ATS-HTTP-HTTPS-%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/</url>
      <content type="html"><![CDATA[<p>苹果在2017年要求 App 必须支持 HTTPS, 不过, 这个要求, 最后又被苹果自己延期了.</p>
<p>我只能说, 苹果的开发哥哥们真会玩…</p>
<p>该系列博客介绍 iOS 上面的 ATS 以及相关的 HTTPS 知识, 分为三篇来分享.</p>
<p>本篇是第一篇.</p>
<p>第二篇: [ATS: HTTPS 认证]</p>
<p>今天先简单了解一下 HTTPS 以及相关的知识.</p>
<h2 id="相关名词"><a href="#相关名词" class="headerlink" title="相关名词"></a>相关名词</h2><p>先了解一下相关的常用名词.</p>
<h4 id="1-HTTP"><a href="#1-HTTP" class="headerlink" title="1.HTTP"></a>1.HTTP</h4><p>HyperText Transfer Protocol, 超文本传输协议.</p>
<h4 id="2-HTTPS"><a href="#2-HTTPS" class="headerlink" title="2.HTTPS"></a>2.HTTPS</h4><p>Hyper Text Transfer Protocol over Secure Socket Layer, 安全的超文本传输协议.</p>
<h4 id="3-SSL"><a href="#3-SSL" class="headerlink" title="3.SSL"></a>3.SSL</h4><p>Secure Socket Layer, 安全套接字层.</p>
<h4 id="4-TLS"><a href="#4-TLS" class="headerlink" title="4.TLS"></a>4.TLS</h4><p>Transport Layer Security, 传输层安全.其前身就是 SSL.</p>
<h4 id="5-ATS"><a href="#5-ATS" class="headerlink" title="5.ATS"></a>5.ATS</h4><p>App Transport Security, 应用传输安全.</p>
<h2 id="协议介绍"><a href="#协议介绍" class="headerlink" title="协议介绍"></a>协议介绍</h2><h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h3><p>HyperText Transfer Protocol, 超文本传输协议，是互联网上使用最广泛的一种协议，所有 WWW 文件必须遵循的标准.</p>
<p>HTTP 协议传输的数据都是未加密的, 也就是明文的, 因此使用 HTTP 协议传输隐私信息非常不安全.</p>
<p>默认使用 TCP 端口为 80.</p>
<h3 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h3><p>安全的超文本传输协议, <code>Hyper Text Transfer Protocol over Secure Socket Layer</code>, 网景公式设计了 SSL(Secure Socket Layer) 协议用于对 HTTP 协议传输的数据进行加密，保证会话过程中的安全性.</p>
<p>默认使用 TCP 端口为 443.</p>
<h3 id="拆分-HTTPS"><a href="#拆分-HTTPS" class="headerlink" title="拆分 HTTPS"></a>拆分 HTTPS</h3><h4 id="SSL-协议加密方式"><a href="#SSL-协议加密方式" class="headerlink" title="SSL 协议加密方式"></a>SSL 协议加密方式</h4><p>SSL 协议即用到了对称加密也用到了非对称加密(公钥加密)，在建立传输链路时，SSL 首先对对称加密的密钥使用公钥进行非对称加密，链路建立好之后，SSL 对传输内容使用对称加密.</p>
<blockquote>
<p>1.对称加密<br>速度高，可加密内容较大，用来加密会话过程中的消息.</p>
<p>2.公钥加密<br>加密速度较慢，但能提供更好的身份认证技术，用来加密对称加密的密钥.</p>
</blockquote>
<h4 id="HTTP-SSL"><a href="#HTTP-SSL" class="headerlink" title="HTTP+SSL"></a>HTTP+SSL</h4><p>HTTPS, 可以看做是 HTTP+SSL, 所以重点在 SSL 上面.</p>
<h4 id="HTTPS-1"><a href="#HTTPS-1" class="headerlink" title="HTTPS"></a>HTTPS</h4><p>在 HTTP (超文本传输协议)基础上提出的一种安全的 HTTP 协议，因此可以称为安全的超文本传输协议。</p>
<p>HTTP 协议直接放置在 TCP 协议之上，而 HTTPS 提出在 HTTP 和 TCP 中间加上一层加密层.</p>
<p>从发送端看，这一层负责把 HTTP 的内容加密后送到下层的 TCP，从接收方看，这一层负责将 TCP 送来的数据解密还原成 HTTP 的内容.</p>
<h4 id="SSL-Secure-Socket-Layer"><a href="#SSL-Secure-Socket-Layer" class="headerlink" title="SSL(Secure Socket Layer)"></a>SSL(Secure Socket Layer)</h4><p>是 Netscape 公司设计的主要用于 WEB 的安全传输协议.<br>它在 HTTPS 协议栈中负责实现上面提到的加密层.</p>
<p>一个 HTTPS 协议栈大致是这样的：<br><img src="/upload/images/2017/02/06/HTTP+SSL.png" alt="1"></p>
<h4 id="TLS"><a href="#TLS" class="headerlink" title="TLS"></a>TLS</h4><p>HTTPS，也称作 HTTP over TLS.</p>
<p>TLS(传输层安全, Transport Layer Security) 的前身是 SSL，TLS 1.0 通常被标示为 SSL 3.1，TLS 1.1 为 SSL 3.2，TLS 1.2 为 SSL 3.3.</p>
<blockquote>
<p>苹果 ATS(App Transport Security), 要求支持 HTTPS 的 TLS 版本最低为 V1.2.</p>
</blockquote>
<p>下图描述了在 TCP/IP 协议栈中 TLS(各子协议）和 HTTP 的关系:<br><img src="/upload/images/2017/02/06/tcp-ip-model.png" alt="1"></p>
<p>其中 Handshake protocol，Change Ciper Spec protocol 和 Alert protocol 组成了 SSL Handshaking Protocols.</p>
<p>SSL 和 TLS 的发展历史:</p>
<blockquote>
<p>1994年，NetScape 公司设计了 SSL 协议（Secure Sockets Layer）的 1.0 版，但是未发布.</p>
<p>1995年，NetScape 公司发布 SSL 2.0 版，很快发现有严重漏洞.</p>
<p>1996年，SSL 3.0 版问世，得到大规模应用.</p>
<p>1999年，互联网标准化组织 ISOC 接替 NetScape 公司，发布了 SSL 的升级版 TLS 1.0 版.</p>
<p>2006年和2008年，TLS 进行了两次升级，分别为 TLS 1.1 版和 TLS 1.2 版.最新的变动是2011年 TLS 1.2 的修订版.</p>
<p>TLS 1.3 改动会比较大，目前还在草案阶段.</p>
</blockquote>
<h2 id="HTTP-和-HTTPS-区别"><a href="#HTTP-和-HTTPS-区别" class="headerlink" title="HTTP 和 HTTPS 区别"></a>HTTP 和 HTTPS 区别</h2><p>HTTPS 和 HTTP 的区别主要为以下四点:</p>
<blockquote>
<p>1.HTTPS 协议需要到 CA 申请证书，一般免费证书很少，需要交费.</p>
<p>2.HTTP 是超文本传输协议，信息是明文传输，HTTPS 则是具有安全性的 SLL/TLS 加密传输协议(非对称加密).</p>
<p>3.HTTP 和 HTTPS 不同的连接方式，用的端口也不一样，前者是 80，后者是 443.</p>
<p>4.HTTP 的连接很简单，是无状态的；<br>HTTPS 协议是由 SSL+HTTP 协议构建的可进行加密传输、身份认证的网络协议，比 HTTP 协议安全.</p>
</blockquote>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ATS HTTP HTTPS SSL TLS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[RN: Yarn]]></title>
      <url>/2017/02/05/RN-Yarn/</url>
      <content type="html"><![CDATA[<p>React Native 正式版已经更新到 0.41.1 了.</p>
<p>最近使用 <code>react-native-cli</code> 来创建 React Native 工程, 提示如下信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">This will walk you through creating a new React Native project in /Users/mark/workspace/mzProjs/ReactNative/LatestRN</div><div class="line">Installing react-native...</div><div class="line">Consider installing yarn to make this faster: https://yarnpkg.com</div></pre></td></tr></table></figure>
<p>其实 Yarn 也一直在更新, 最新版本 v0.20.0.</p>
<p>官网对应的有中文版本和中文文档, 可以 <a href="http://yarnpkg.top/" target="_blank" rel="noopener">点此进入</a>.</p>
<h2 id="Yarn-简介"><a href="#Yarn-简介" class="headerlink" title="Yarn 简介"></a>Yarn 简介</h2><p>一句话介绍:</p>
<blockquote>
<p>A new package manager for JavaScript</p>
</blockquote>
<p>Yarn 是一个依赖管理工具，它能够管理你的代码，并与全世界的开发者分享你的代码.</p>
<p>Yarn 是高效、安全和可靠.</p>
<blockquote>
<p>1.高效: 使用了缓存, 可以很快的获取已经 download 的包.<br>2.安全: 在代码被执行之前，会使用CheckSum算法验证每一个依赖包的完整性.<br>3.可靠: 在不同平台(windows/mac/linux)只要是同一份配置文件, 执行结果是一样的.</p>
</blockquote>
<p>还有很多特性:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Offline Mode</div><div class="line">If you&apos;ve installed a package before, you can install it again without any internet connection.</div><div class="line">Deterministic</div><div class="line">The same dependencies will be installed the same exact way across every machine regardless of install order.</div><div class="line">Network Performance</div><div class="line">Yarn efficiently queues up requests and avoids request waterfalls in order to maximize network utilization.</div><div class="line">Same Packages</div><div class="line">Install any package from npm and keep your package workflow the same.</div><div class="line">Network Resilience</div><div class="line">A single request failing won&apos;t cause an install to fail. Requests are retried upon failure.</div><div class="line">Flat Mode</div><div class="line">Resolve mismatching versions of dependencies to a single version to avoid creating duplicates.</div></pre></td></tr></table></figure>
<p>Yarn 能够让你使用其他开发者开发的代码，让你更容易的开发软件.</p>
<p>代码是通过依赖包 (有时也被称为组件). 在每一个依赖中会定义一个 package.json 文件，用来描述这个依赖包中所有要被分享的代码.</p>
<p>Yarn 是开源的, 点击 <a href="http://yarnpkg.top/" target="_blank" rel="noopener">Github</a> 了解更多.</p>
<p>对比 npm 和 yarn, 可以阅读文章:<br><a href="https://www.sitepoint.com/yarn-vs-npm/" target="_blank" rel="noopener">Yarn vs npm: Everything You Need to Know</a></p>
<p>中文版:<br><a href="https://gold.xitu.io/entry/580de578bf22ec0058330692" target="_blank" rel="noopener">译 Yarn vs npm: 你需要知道的一切</a></p>
<h2 id="安装-Yarn"><a href="#安装-Yarn" class="headerlink" title="安装 Yarn"></a>安装 Yarn</h2><p>具体安装的教程, 可以参考官网的 <a href="http://yarnpkg.top/Installation.html" target="_blank" rel="noopener">安装教程</a>.</p>
<p>在 MacOS 上面使用 Homebrew 安装很方便, 两个命令即可完成.</p>
<p>下面具体说说操作步骤.</p>
<p>强烈开发同事购买一个 VPN, 这个年头没有 VPN, 日子不好过.</p>
<p>1.更新 brew</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew update --verbose</div></pre></td></tr></table></figure>
<p>最后加上参数 <code>--verbose</code>, 不然等待的过程很煎熬, 没有任何提示信息.</p>
<p>2.安装 yarn</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install yarn</div></pre></td></tr></table></figure>
<p>在安装过程中, 如果提示如下信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Please note by default only English locale support is provided. If you need</div><div class="line">full locale support you should either rebuild with full icu:</div><div class="line">  `brew reinstall node --with-full-icu`</div><div class="line">or add full icu data at runtime following:</div><div class="line">  https://github.com/nodejs/node/wiki/Intl#using-and-customizing-the-small-icu-build</div></pre></td></tr></table></figure>
<p>可以重新安装已经安装的 node, 执行命令:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew reinstall node --with-full-icu</div></pre></td></tr></table></figure>
<p>在执行上面安装命令的时候, 如果卡住不动或者很久, Ctrl+C 终止当前的操作, 重新操作一遍即可.</p>
<p>安装成功后, 可以查看安装的版本信息, 执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yarn --verbose</div></pre></td></tr></table></figure>
<p>会显示如下信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">yarn install v0.20.0</div><div class="line">verbose Performing &quot;GET&quot; request to &quot;https://yarnpkg.com/latest-version&quot;.</div><div class="line">[1/4] 🔍  Resolving packages...</div><div class="line">success Already up-to-date.</div><div class="line">✨  Done in 0.29s.</div></pre></td></tr></table></figure>
<p>使用 brew 安装 Yarn 后, 不需要设置环境变量.</p>
<h2 id="Yarn-与-React-Native"><a href="#Yarn-与-React-Native" class="headerlink" title="Yarn 与 React Native"></a>Yarn 与 React Native</h2><p>在 <code>React Native 0.37</code> 版本中已经加入了对 Yarn 的支持.</p>
<p>可以在 React Native 的官方的这篇 <a href="https://facebook.github.io/react-native/blog/2016/11/08/introducing-button-yarn-and-a-public-roadmap.html" target="_blank" rel="noopener">Blog</a> 找到更多信息.</p>
<p>用 Yarn 创建 React Native 工程</p>
<p>既然 RN 已经支持了 Yarn, 那么就可以使用 Yarn 来管理和创建 RN 工程了.</p>
<p>使用 Yarn, 必须满足几个条件:</p>
<blockquote>
<p>1.react-native-cli 的版本不能小于 1.2.0 版本.<br>2.React Natvie 必须是 0.37 及以上的版本.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">react-native init MZLatestRN</div></pre></td></tr></table></figure>
<p>当你安装好 Yarn 后, 执行上面的命令可以出现提示信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">This will walk you through creating a new React Native project in ~/workspace/Projs/ReactNative/MZLatestRN</div><div class="line">Using yarn v0.20.0</div><div class="line">Installing react-native...</div></pre></td></tr></table></figure>
<p>可以看出, RN 会使用 Yarn 来创建工程.</p>
<p>其中, <code>~/workspace/Projs/ReactNative</code> 是我本地的工作目录. <code>MZLatestRN</code> 是要创建的 RN 工程名称.</p>
<p>如果你的网络好的话, 大概1分钟就可以创建成功.</p>
<p>工程目录:<br><img src="/upload/images/2017/02/05/1.png" alt="1"></p>
<p>可以看出多了 <code>yarn.lock</code> 文件.</p>
<p>Yarn 还在茁壮成长, 希望它越来越好, 更多的使用和工作原理可以参考 <a href="https://yarnpkg.com/docs" target="_blank" rel="noopener">官方 Doc</a>, 介绍的很详细.</p>
]]></content>
      
        <categories>
            
            <category> ReactNative </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ReactNative iOS Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[安装 PHP 遇到的问题]]></title>
      <url>/2017/02/02/%E5%AE%89%E8%A3%85-PHP-%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>在博客 [PHP 开发准备] 介绍了安装并部署 PHP 程序到 Nginx.</p>
<p>今天分享在安装中遇到的问题和其他工具的安装, 以及常用的操作, 包括 MySQL, Nginx 等.</p>
<h2 id="pecl-安装"><a href="#pecl-安装" class="headerlink" title="pecl 安装"></a>pecl 安装</h2><blockquote>
<p>PEAR 是 PHP 扩展与应用库(PHP Extension and Application Repository) 的缩写。它是一个 PHP 扩展及应用的一个代码仓库，简单地说，PEAR 就是 PHP 的 CPAN.</p>
<p>PECL (PHP Extension Community Library)，PHP 的扩展库，它提供了一系列已知的扩展库，由 C++ 等其他语言编写而成，以 .so 形式出现，.so 为共享库, 是 shared object, 用于动态连接的, 和 dll 差不多，为比 PEAR 更快，但是与 PEAR 不同的是，PECL 需要在服务器上配置并被注册到主机中.</p>
<p>最直接的表述: PEAR 是 PHP 的上层扩展，PECL 是 PHP 的底层扩展.</p>
</blockquote>
<p>下面说如何安装 pecl 和 pear.</p>
<p>1.下载 pear</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -O http://pear.php.net/go-pear.phar</div></pre></td></tr></table></figure>
<p>2.安装 pear</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo php -d detect_unicode=0 go-pear.phar</div></pre></td></tr></table></figure>
<p>3.执行以上命令后会进行安装过程，会有一些配置选项</p>
<p>输入1，回车，配置 pear 路径为：<code>/usr/local/pear</code><br>输入4，回车，配置命令路径为：<code>/usr/local/bin</code></p>
<p>4.回车两次，其他让其默认，安装完成.</p>
<p>5.可以通过命令检查 pear 是否安装成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pear version</div></pre></td></tr></table></figure>
<p>或者执行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pecl version</div></pre></td></tr></table></figure>
<p>可以看到类似信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">PEAR Version: 1.10.1</div><div class="line">PHP Version: 5.6.27</div><div class="line">Zend Engine Version: 2.6.0</div></pre></td></tr></table></figure>
<h2 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h2><h4 id="MySQL-操作"><a href="#MySQL-操作" class="headerlink" title="MySQL 操作"></a>MySQL 操作</h4><p>基本操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mysql.server start #启动</div><div class="line">mysql.server stop  #停止</div><div class="line">mysql -u root -p   #用 user 和 pwd 连接</div><div class="line">php-fpm 相关操作</div></pre></td></tr></table></figure>
<p>1.运行 php-fpm</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo php-fpm -D</div></pre></td></tr></table></figure>
<p>2.关闭 php-fpm</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo killall php-fpm</div></pre></td></tr></table></figure>
<p>3.查看 php-fpm 运行状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo lsof -Pni4 | grep LISTEN | grep php</div></pre></td></tr></table></figure>
<p>可以看到 (fpm 默认在 9000 端口)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">php-fpm  84200   root  8u  IPv4 0x91959c43a1ea5abd  0t0  TCP 127.0.0.1:9000 (LISTEN)</div><div class="line">php-fpm  84201   _www  0u  IPv4 0x91959c43a1ea5abd  0t0  TCP 127.0.0.1:9000 (LISTEN)</div><div class="line">php-fpm  84202   _www  0u  IPv4 0x91959c43a1ea5abd  0t0  TCP 127.0.0.1:9000 (LISTEN)</div><div class="line">php-fpm  84203   _www  0u  IPv4 0x91959c43a1ea5abd  0t0  TCP 127.0.0.1:9000 (LISTEN)</div></pre></td></tr></table></figure>
<p>4.php-fpm 开机启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ln -sfv /usr/local/opt/php56/*.plist ~/Library/LaunchAgents</div><div class="line">launchctl load ~/Library/LaunchAgents/homebrew.mxcl.php56.plist</div></pre></td></tr></table></figure>
<h4 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h4><p>1.测试配置是否有语法错误</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nginx -t</div></pre></td></tr></table></figure>
<p>2.启动 nginx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nginx</div></pre></td></tr></table></figure>
<p>3.重新加载配置|重启|停止|退出 nginx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nginx -s reload|reopen|stop|quit</div></pre></td></tr></table></figure>
<p>4.开机启动：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ln -sfv /usr/local/opt/nginx/*.plist ~/Library/LaunchAgents</div><div class="line">launchctl load ~/Library/LaunchAgents/homebrew.mxcl.nginx.plist</div></pre></td></tr></table></figure>
<p>5.nginx 监听 80 端口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo chown root:wheel /usr/local/Cellar/nginx/1.6.0_1/bin/nginx</div><div class="line">sudo chmod u+s /usr/local/Cellar/nginx/1.6.0_1/bin/nginx</div></pre></td></tr></table></figure>
<h2 id="常用目录"><a href="#常用目录" class="headerlink" title="常用目录"></a>常用目录</h2><p>因为使用了 Homebrew 安装的 PHP, 配置文件的目录不是常规的 /etc</p>
<p>这里有几个目录需要知道, 如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/private/etc</div><div class="line">/usr/local/etc/php/5.6</div><div class="line">/usr/local/var/www</div></pre></td></tr></table></figure>
<h2 id="遇到问题"><a href="#遇到问题" class="headerlink" title="遇到问题"></a>遇到问题</h2><p>1.执行 sudo php-fpm -D 报 php56-intl/intl.so 加载问题</p>
<p>warning 的内容大致如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">NOTICE: PHP message: PHP Warning:  PHP Startup: Unable to load dynamic library &apos;/usr/local/opt/php56-intl/intl.so&apos; - dlopen(/usr/local/opt/php56-intl/intl.so, 9): image not found in Unknown on line 0</div><div class="line">&lt;br /&gt;</div><div class="line">&lt;b&gt;Warning&lt;/b&gt;:  PHP Startup: Unable to load dynamic library &apos;/usr/local/opt/php56-intl/intl.so&apos; - dlopen(/usr/local/opt/php56-intl/intl.so, 9): image not found in &lt;b&gt;Unknown&lt;/b&gt; on line &lt;b&gt;0&lt;/b&gt;&lt;br /&gt;</div><div class="line">Unknown(0) : Warning - PHP Startup: Unable to load dynamic library &apos;/usr/local/opt/php56-intl/intl.so&apos; - dlopen(/usr/local/opt/php56-intl/intl.so, 9): image not found</div><div class="line">[31-Dec-2016 22:40:38] NOTICE: PHP message: PHP Warning:  PHP Startup: mcrypt: Unable to initialize module</div><div class="line">Module compiled with build ID=API20131226,NTS</div><div class="line">PHP    compiled with build ID=API20131226,NTS,debug</div><div class="line">These options need to match</div><div class="line"> in Unknown on line 0</div></pre></td></tr></table></figure>
<p>解决方案: 执行下面的命令, 即可解决.<br>方案来源 <a href="https://github.com/Homebrew/homebrew-php/issues/2544" target="_blank" rel="noopener">Github</a>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew reinstall --build-from-source php56-intl</div></pre></td></tr></table></figure>
<p>2.执行 sudo php-fpm -D 报 PHP Startup: mcrypt: Unable to initialize module</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">31-Dec-2016 22:56:51] NOTICE: PHP message: PHP Warning:  PHP Startup: mcrypt: Unable to initialize module</div><div class="line">Module compiled with build ID=API20131226,NTS</div><div class="line">PHP    compiled with build ID=API20131226,NTS,debug</div><div class="line">These options need to match</div><div class="line"> in Unknown on line 0</div><div class="line">&lt;br /&gt;</div><div class="line">&lt;b&gt;Warning&lt;/b&gt;:  PHP Startup: mcrypt: Unable to initialize module</div><div class="line">Module compiled with build ID=API20131226,NTS</div><div class="line">PHP    compiled with build ID=API20131226,NTS,debug</div><div class="line">These options need to match</div><div class="line"> in &lt;b&gt;Unknown&lt;/b&gt; on line &lt;b&gt;0&lt;/b&gt;&lt;br /&gt;</div><div class="line">Unknown(0) : Warning - PHP Startup: mcrypt: Unable to initialize module</div><div class="line">Module compiled with build ID=API20131226,NTS</div><div class="line">PHP    compiled with build ID=API20131226,NTS,debug</div><div class="line">These options need to match</div></pre></td></tr></table></figure>
<p>解决方案:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew reinstall --build-from-source php56-intl</div></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Server </category>
            
        </categories>
        
        
        <tags>
            
            <tag> PHP MySql </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[PHP 开发准备]]></title>
      <url>/2017/02/02/PHP-%E5%BC%80%E5%8F%91%E5%87%86%E5%A4%87/</url>
      <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>亲自实践在 MacOS 上面安装 PHP+MySQL+Nginx.</p>
<p>将自己遇到的问题和对应的解决方案, 分享出来, 希望能帮到你.</p>
<p>MacOS 上面搭建 PHP 开发环境, 使用 Homebrew 来安装对应的开发套件, 就更加简单了.</p>
<p>这篇博客的目的就是安装 PHP 开发环境, 并将第一个 PHP 程序部署在 Nginx 上面.</p>
<p>如果在安装和使用过程中遇到问题, 可以查看这篇博客: [Mac PHP 安装遇到的问题]</p>
<p>下面开始介绍具体的安装步骤.</p>
<h2 id="一-安装-Homebrew"><a href="#一-安装-Homebrew" class="headerlink" title="一. 安装 Homebrew"></a>一. 安装 Homebrew</h2><p>这个大家可以自行访问 <a href="http://brew.sh/" target="_blank" rel="noopener">Homebrew</a> 了解, 这里不再涉及具体的安装过程和方法.</p>
<h2 id="二-安装-php56"><a href="#二-安装-php56" class="headerlink" title="二. 安装 php56"></a>二. 安装 php56</h2><blockquote>
<p>1.加入官方源</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">brew tap homebrew/dupes</div><div class="line">brew tap homebrew/versions</div><div class="line">brew tap homebrew/php</div></pre></td></tr></table></figure>
<blockquote>
<p>2.安装 PHP</p>
</blockquote>
<p>默认安装会运行在 Apache 下.<br>而我们要使它运行在 PHP-fpm 下，所以要增加参数:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">--with-fpm --without-apache</div></pre></td></tr></table></figure>
<p>查看所有安装参数可以输入:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew option php56</div></pre></td></tr></table></figure>
<p>进行查看，参考安装指令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">brew install php56 \</div><div class="line">--without-snmp \</div><div class="line">--without-apache \</div><div class="line">--with-debug \</div><div class="line">--with-fpm \</div><div class="line">--with-intl \</div><div class="line">--with-homebrew-curl \</div><div class="line">--with-homebrew-libxslt \</div><div class="line">--with-homebrew-openssl \</div><div class="line">--with-imap \</div><div class="line">--with-mysql \</div><div class="line">--with-tidy</div></pre></td></tr></table></figure>
<p>这里使用了下面的选项:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">with-homebrew-curl</div></pre></td></tr></table></figure>
<p>我试过不带此选项, 安装 PHP56 会失败, 找不到 curl.</p>
<p>安装成功后, 可以查看版本信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">php -v</div><div class="line">php-fpm -v</div></pre></td></tr></table></figure>
<p>此时看到是的系统自带的版本.</p>
<p>下面一步是增加环境变量, 完成后在看版本信息, 即可.</p>
<blockquote>
<p>3.配置 PHP 环境变量</p>
</blockquote>
<p>配置环境变量的目的是要使用 brew 安装的 PHP 和 PHP-fpm, 不使用 MacOS 自带的 PHP 版本.</p>
<p><code>/usr/local/sbin/</code> 下面是我们 brew 安装的 PHP, 其实他是一个软连接指向:<br><code>/usr/local/Cellar/php56/5.6.27_4/sbin</code></p>
<p><code>/usr/local/bin/</code> 下面也是 brew 安装的 PHP, 指向:<br><code>/usr/local/Cellar/php56/5.6.27_4/bin</code></p>
<p>vim ~/.bash_profile 增加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">export PATH=&quot;/usr/local/sbin:$PATH&quot;</div></pre></td></tr></table></figure>
<p>使其立即生效, 执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source ~/.bash_profile</div></pre></td></tr></table></figure>
<p>或者重启终端.</p>
<p>如果想看系统的 PHP 版本可以这样:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/bin/php -v</div></pre></td></tr></table></figure>
<blockquote>
<p>4.配置 php-fpm</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo cp /private/etc/php-fpm.conf.default /private/etc/php-fpm.conf</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo vi /private/etc/php-fpm.conf</div></pre></td></tr></table></figure>
<p>找到 error_log 项，添加下面配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">error_log = /usr/local/var/log/php-fpm.log</div><div class="line">pid = /usr/local/var/run/php-fpm.pid</div></pre></td></tr></table></figure>
<p>否则会报:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">FPM initialization failed</div></pre></td></tr></table></figure>
<h2 id="三-安装-nginx"><a href="#三-安装-nginx" class="headerlink" title="三. 安装 nginx"></a>三. 安装 nginx</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install nginx</div></pre></td></tr></table></figure>
<p>创建文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mkdir -p /usr/local/var/logs/nginx</div><div class="line">mkdir -p /usr/local/etc/nginx/sites-available</div><div class="line">mkdir -p /usr/local/etc/nginx/sites-enabled</div><div class="line">mkdir -p /usr/local/etc/nginx/conf.d</div><div class="line">mkdir -p /usr/local/etc/nginx/ssl</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">sudo mkdir -p /var/www</div><div class="line">sudo chown :staff /var/www</div><div class="line">sudo chmod 775 /var/www</div><div class="line">vi /var/www/info.php</div><div class="line">vi /var/www/index.html</div><div class="line">vi /var/www/403.html</div><div class="line">vi /var/www/404.html</div></pre></td></tr></table></figure>
<p>改变 nginx.conf 配置文件</p>
<p>该配置文件在 <code>/usr/local/etc/nginx/nginx.conf</code> 下面.</p>
<p>我的配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">worker_processes  1;</div><div class="line"> </div><div class="line">error_log  /usr/local/etc/nginx/logs/error.log debug;</div><div class="line">pid        /usr/local/var/run/nginx.pid;</div><div class="line"> </div><div class="line">events &#123;</div><div class="line">    worker_connections  256;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">http &#123;</div><div class="line">    include             mime.types;</div><div class="line">    default_type        application/octet-stream;</div><div class="line"> </div><div class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</div><div class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</div><div class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</div><div class="line"> </div><div class="line">    access_log  /usr/local/etc/nginx/logs/access.log  main;</div><div class="line"> </div><div class="line">    sendfile            on;</div><div class="line"> </div><div class="line">    keepalive_timeout   65;</div><div class="line"> </div><div class="line">    index index.html index.php;</div><div class="line"> </div><div class="line">    include /usr/local/etc/nginx/sites-enabled/*; </div><div class="line">    include /usr/local/etc/nginx/conf.d/*;</div><div class="line">     server &#123;</div><div class="line">        listen       8080;</div><div class="line">        server_name  localhost;</div><div class="line">        #charset koi8-r;</div><div class="line">        #access_log  logs/host.access.log  main;</div><div class="line">        location / &#123;</div><div class="line">            root   /Users/mark/workspace/mzProjs/phpdev/nginx/nginx_sites/; #web的根目录</div><div class="line">            index  index.php index.html index.htm; #加index.php</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注意:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">location / &#123;</div><div class="line">            root   /Users/mark/workspace/mzProjs/phpdev/nginx/nginx_sites/; #web的根目录</div><div class="line">            index  index.php index.html index.htm; #加index.php</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>配置了我的 web 目录和支持的文件.</p>
<h2 id="四-运行-PHP"><a href="#四-运行-PHP" class="headerlink" title="四. 运行 PHP"></a>四. 运行 PHP</h2><p>创建 index.php</p>
<p>启动 PHP-fpm</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo php-fpm</div></pre></td></tr></table></figure>
<p>或者以守护进程的方式来启动 PHP-fpm</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo php-fpm -D</div></pre></td></tr></table></figure>
<p>启动 Nginx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo nginx</div></pre></td></tr></table></figure>
<p>编辑 index.php</p>
<p>在 web 目录(我配置的) <code>/Users/mark/workspace/mzProjs/phpdev/nginx/nginx_sites/</code> 新建文件 <code>index.php</code>.</p>
<p>index.php 里面可以编写代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;!-- lang: php --&gt;</div><div class="line">&lt;!-- ~/nginx_sites/index.php --&gt;</div><div class="line">&lt;?php</div><div class="line">    echo &quot;Hello PHP&quot;;</div><div class="line">    echo &quot;&lt;/br&gt;&quot;;</div><div class="line">    </div><div class="line">    echo &quot;学习 php&quot;;</div><div class="line">    echo &quot;&lt;/br&gt;&quot;;</div><div class="line">    echo phpinfo();</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<p>打开浏览器, 你会看到下面的页面:<br><img src="/upload/images/2017/02/02/php1.png" alt="1"></p>
<p>也可以在该目录下创建其他 php 文件, 如 mark.php 文件.</p>
<p>浏览器中输入:<br><a href="http://localhost:8080/mark.php" target="_blank" rel="noopener">http://localhost:8080/mark.php</a> 可以执行相对应的文件.</p>
<p>这里的 <code>mark.php</code> 是自己新建的 php 文件.</p>
<h2 id="五-安装-MySQL"><a href="#五-安装-MySQL" class="headerlink" title="五. 安装 MySQL"></a>五. 安装 MySQL</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install mysql</div></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Server </category>
            
        </categories>
        
        
        <tags>
            
            <tag> PHP MySql </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[过年回家这几天]]></title>
      <url>/2017/01/31/%E8%BF%87%E5%B9%B4%E5%9B%9E%E5%AE%B6%E8%BF%99%E5%87%A0%E5%A4%A9/</url>
      <content type="html"><![CDATA[<p>从放假回家到现在已经一个多星期了, 感触颇多.</p>
<p>主要有以下几个感触:</p>
<blockquote>
<p>1.健康最重要.<br>2.坚持做好一件事情.<br>3.感恩.</p>
</blockquote>
<p><img src="/upload/images/2017/01/31/1.jpeg" alt="1"></p>
<h2 id="健康"><a href="#健康" class="headerlink" title="健康"></a>健康</h2><p>前两年回家, 还能见着很多长辈, 互相嘘寒问暖, 家长里短的闲聊, 如今有些已离我远去.</p>
<p>无情的疾病夺走了尚未花甲的他们, 让人不禁感叹生命的脆弱.</p>
<p>我小的时候, 很喜欢和长辈们聊天.</p>
<p>主要是他们讲, 我做一个小小的听众, 觉得他们懂得特别多, 从天文到地里, 从文学到艺术, 讲的有声有色.<br>每逢夏季, 我都会搬着小板凳, 在屋前的老树下, 纠缠他们, 逼着嚷着让他们给我讲故事, 甭提有多高兴.</p>
<p>如今, 老树犹在, 他们已不在人世.睹物思人.</p>
<p>农村大部分人, 不太关注自己的健康, 唯一衡量自己身体状况的标准就是 <code>米饭馒头能吃多少</code>.</p>
<p>很多人, 明明已经感觉到身体不适, 也不愿意去医院做检查, 就这样日积月累成疾.<br>等实在忍受不了才去医院检查, 为时已晚.</p>
<p>平时不注意自己的身体, 身体早晚都会让你注意.</p>
<p>无论平时工作再忙, 也要坚持锻炼, 没有健康的体魄, 其他的都是扯淡.</p>
<h2 id="坚持"><a href="#坚持" class="headerlink" title="坚持"></a>坚持</h2><p>农村这几年鼓励年轻人在家创业, 搞养殖. 有很多人放弃了打工, 回家拿着补贴开始有模有样的创业.</p>
<p>前几年回老家, 看到各种搞养殖的, 有养鸡养鸭养鹅的, 有养羊养猪养牛的, 如雨后春笋, 遍地开花.</p>
<p>但是今年回家, 看到很多荒凉的房子, 无人问津.</p>
<p>我问过几个小伙子(之前在家搞养殖的人, 最后放弃了的).他们跟我说的基本都一样, 太累了, 收益慢!<br>搞养殖, 的确很累, 也很枯燥无味, 每天和这些不会说话的动物们待在一起, 喂它们吃喝, 管他们温饱, 实在乏味.</p>
<p>另外有两个年轻人, 从开始养殖到现在已经坚持五六年了, 搞得风生水起, 家里盖起了楼房, 取了巧媳妇, 生了胖小子, 一家人其乐融融.<br>他们跟我说的基本一样, 只要坚持, 就有收获!</p>
<p>这两个坚持下来的年轻人, 他们相信自己能够把这份事业做好, 他们把别人眼中的脏活累活当做一种快乐, 一种享受!</p>
<p>刚开始, 很艰难, 他们也想过放弃, 但是又舍不得这几年的付出, 于是就坚持下来了, 并且收获了不少意想不到的知识, 不管是物质上还是精神上都得到了满足.</p>
<p>世上, 没有一帆风顺的事业.</p>
<p>只要自己喜欢, 感兴趣的行业, 就值得你去坚持.<br>如果你从内心都不感兴趣, 趁早放弃, 因为你很难坚持下来.</p>
<p>想投机取巧的成就一份事业, 只有神话故事里有吧!</p>
<p>不经一番寒彻骨, 哪得梅花扑鼻香!</p>
<h2 id="感恩"><a href="#感恩" class="headerlink" title="感恩"></a>感恩</h2><p>小的时候, 家里很拮据, 我能够把大学念完, 简直就是天意.</p>
<p>父母永远只会对我说一句话, 只要你想上学, 我们就支持到底.</p>
<p>我知道家里的经济情况, 所以在学习上也是不遗余力, 每次放学除了帮爸爸妈妈干农活, 就是完成家庭作业, 练字背书.</p>
<p>那个时候, 不知道哪来的狠劲, 即使是寒冬腊月, 也要坚持写作业, 即使是手都冻肿了, 也要练字.</p>
<p>当我接到重点高中通知书的那天, 父亲高兴的合不拢嘴, 心理充满了骄傲.</p>
<p>我能感觉到……</p>
<p>然而考上高中, 接下来就是凑钱交学费, 隔壁有个伯伯, 他说学费不够, 算他的.<br>那个时候, 大家家里都不宽裕, 能借钱给你的, 简直就是大恩人.<br>一直到现在, 我都很感激他, 每年过年回家, 我都会给伯伯买点礼物, 给个红包, 陪他聊聊天.他还开玩笑的说, 当年自己的投资, 算是有了回报了.</p>
<p>这辈子, 我们最应该感谢的是我们自己的父母, 养育我们成人, 送我们读书上学. 过年回家, 要多陪陪他们, 珍惜和他们在一起的每一刻.</p>
]]></content>
      
        <categories>
            
            <category> 随笔 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 生活 反思 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[学习杂谈]]></title>
      <url>/2017/01/27/%E5%AD%A6%E4%B9%A0%E6%9D%82%E8%B0%88/</url>
      <content type="html"><![CDATA[<p>今天是中国传统节日, 大年三十, 祝大家新年快乐, 身体健康, 幸福美满.</p>
<h2 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h2><p>最近无论是朋友还是同事或者博友, 都问过我关于学习方面的事情.</p>
<p>探讨的问题大概分为如下几种:</p>
<p>怎么有效的学习新知识?<br>怎么快速掌握新知识?<br>是否有必要每天学习?<br>如何坚持学习?<br>谈到关于学习的话题, 我也不是什么专家, 更不是心理咨询师, 只是谈谈个人的一些看法和经历, 希望能给大家带来一点点的帮助.</p>
<p>不要只是嘴上说 <code>我感兴趣</code>, 如果没有驱动和目标, 兴趣永远都只是兴趣.</p>
<h2 id="你为什么学习它"><a href="#你为什么学习它" class="headerlink" title="你为什么学习它"></a>你为什么学习它</h2><p>学习知识之前, 问问自己为什么要学它? 大部分人学习新东西都是为了工作或者为了更好的工作或者为了转行或者其他目的, 也有一部分人是为了兴趣爱好.</p>
<p>这里我只谈为了工作而去学习新知识的内容, 其他方面的我自己也没有什么心得体会, 不能乱说.</p>
<p>既然为了工作或者更好的工作来学习, 那么我们就明确了目标, 如果你已经有了目标, 恭喜你, 你即将成功了.</p>
<p>有一些人说, 我学习它, 这个东西不一定哪天就有用了, 我怕将来失业.<br>这中担心不是在杞人忧天, 特别是在互联网的时代, 如果不学习很容易就落伍啦, 君担心完全在理!</p>
<p>但是, 当下你最应该考虑的是目前掌握的技能是否已经熟练了, 是否是能够独当一面了, 如果深学下去会不会更有前途? 如果是, 请你深入去学习, 不要太杞人忧天了!</p>
<p>在精钻一门学问的情况下, 可以扩大自己的知识面, 而不是 <code>吃着碗里看着锅里</code> 的, 要脚踏实地的大步向前.</p>
<h2 id="坚持学习"><a href="#坚持学习" class="headerlink" title="坚持学习"></a>坚持学习</h2><p>上面的扯淡有点多啊.回正题.</p>
<p>既然搞清楚了为什么学习它, 接下来就是搞定它.</p>
<p>你需要有坚持学习的态度和行动, 不然一切都会成为云烟. 那么当初咬牙切齿的抱负, 结果都是冲动的惩罚.</p>
<p>学习新知识的前期是很累的, 但是只要你意志足够坚定, 一定可以克服种种困难.</p>
<p>记得当初接手一个二手项目, 项目也是足够复杂, 并且有很多引擎之前都没有用过, 上面领导逼得比较紧, 没办法, 只能将其拿下, 每天晚上挑灯夜战, 在 log 的海洋里遨游.</p>
<p>很快自己掌握了新的知识, 结合项目, 不断的去调试和总结, 最终按期完成需求, 回过头想想, 想要坚持做好一件事情, 除了自身的自我约束, 还需要外界环境的 倒逼.</p>
<p>当你坚持不住的时候, 问问自己, 是否已经到了极限, 如果感到累了, 适当的放松一下, 比如出去跑个步, 打个球或者找朋友叙叙旧.</p>
<p>适当的给自己一点压力, 事半功倍.</p>
<h2 id="学习的渠道"><a href="#学习的渠道" class="headerlink" title="学习的渠道"></a>学习的渠道</h2><p>刚开始学习新知识, 大家都渴望有一些大牛能够指导自己, 或者能够从前辈那里获取一些武林秘籍, 这些都是学习的渠道.</p>
<p>有些小伙伴在学习的过程中, 会遇到各种各样的困难, 比如在学习一门知识的时候, 发现竟然还需要学习另一门新知识, 真是日了狗了!<br>到这里, 可能有些人就会情不自禁的选择了放弃, 嘴上说还在学习, 其实心里已经疲倦.</p>
<p>还有一些初学者, 他们没有什么经验, 如果主动性再差点, 动辄遇到问题就问, 根本没有过思考, 哪怕是一点点的思考都没有.其实他们不是不想搞, 就怕搞错了.仅仅是因为怕, 就戛然而止了!<br>这种人, 确实可惜, 所以他们需要更多的指导和教育.这里提醒大家, 学习知识, 不要怕犯错, 大胆的去试错, 在错误中成长, 这样你才能有所收获.</p>
<p>记得以前为了安装 linux, 我把办公室的办公电脑都格式化了, 组长差点要开除我了, 现在想想虽然挨了骂, 但是挺值得.</p>
<p>现在互联网很发达, 想学习的东西基本网上都有, 你可以没有智商, 没有情商, 但是你一定要有 <code>搜商 (搜索能力)</code>.<br>当你自己经过思考, 无法解决问题, 就去搜索相关的知识, 如果搜索也失败了, 再去请教别人, 这样你就可以从中收获意外的惊喜.</p>
<p>所以, 学习渠道的重要来源之一就是在互联网搜索, 培养自己的搜索能力很重要, 我建议大家使用谷歌浏览器, 然后使用 google 的搜索引擎, 搭建一套翻墙的 VPN, 这样你可以在知识的海洋里爽翻.</p>
<p>另外一个比较重要的学习渠道就是你认为的牛人, 向他们学习相关的学习方法, 问他们是怎么学习的, 然后结合自己的实际情况加以运用, 跟他们多交流.</p>
<h2 id="对自己’狠’一些"><a href="#对自己’狠’一些" class="headerlink" title="对自己’狠’一些"></a>对自己’狠’一些</h2><p>我之前有个坏习惯, 喜欢晚上躺在床上看视频, 这些视频可能是优酷或者腾讯视频客户端的, 也有可能是新闻类的 app 来源的视频.<br>视频只要看起来, 时间就不受控制了.第二天早晨起床也很困难.</p>
<p>最后自己把视频类和新闻类 app 全部卸载掉了, 然后把目标转移到 stackoverflow 和 github 上面.<br>那里才是程序员的世界, 只有你想不到的, 没有做不到的.</p>
<p>为了学习新知识, 你需要对自己狠一点, 每天拿点时间出来总结和学习, 一个月一个季度一年下来, 你比别人都进步了很多.</p>
<p>养成一个好习惯, 终生受益.</p>
]]></content>
      
        <categories>
            
            <category> 随笔 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 学习 生活 反思 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS: 聊聊 UIWebView 缓存]]></title>
      <url>/2017/01/15/iOS-%E8%81%8A%E8%81%8A-UIWebView-%E7%BC%93%E5%AD%98/</url>
      <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在开发项目过程中, 一些若交互的页面会使用 HTML 展示.</p>
<p>在 iOS 中, 使用 UIWebView 的频率还是比较高的.</p>
<p>今天跟大家聊聊 UIWebView 缓存相关的话题.</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>我今天使用 Tomcat 来作为 web 容器, 在本机搭建一个 web 服务器, 然后使用 iPhone 访问该 web 页面, 展示和梳理 UIWebview 关于缓存的问题.</p>
<p>如果你对 Tomcat 还不熟悉, 希望你可以先去大概了解一下, 如何在 Mac os 上面安装和使用 Tomcat, 可以参考我的博文: [Mac 配置 Tomcat8].</p>
<blockquote>
<p>Tomcat 是一个开放源代码、运行 servlet 和 JSP Web 应用软件的基于 Java 的 Web 应用软件容器.<br>Tomcat Server 是根据 servlet 和 JSP 规范执行的，因此可以说 Tomcat Server 实行了 Apache-Jakarta 规范，且比绝大多数商业应用软件服务器要好.<br>但是 Tomcat 对静态文件、高并发的处理比较弱.</p>
</blockquote>
<p>写这篇文章的时候, 我使用的版本分别是 <code>apache-tomcat-8.5.8</code>, <code>jdk1.8</code>.</p>
<h2 id="配置-Tomcat"><a href="#配置-Tomcat" class="headerlink" title="配置 Tomcat"></a>配置 Tomcat</h2><h3 id="修改-server-xml-文件"><a href="#修改-server-xml-文件" class="headerlink" title="修改 server.xml 文件"></a>修改 server.xml 文件</h3><p>文件在 Tomcat 的根目录的 conf 目录下, 如我的文件在这个目录:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">apache-tomcat-8.5.8/conf/server.xml</div></pre></td></tr></table></figure>
<p>增加如下内容:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;Host name=&quot;&lt;your local ip&gt;&quot; debug=&quot;0&quot; appBase=&quot;&lt;base dir&gt;&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot; xmlValidation=&quot;false&quot;  xmlNamespaceAware=&quot;false&quot;&gt;</div><div class="line">	&lt;Context path=&quot;&quot; docBase=&quot;&lt;html file path&gt;&quot; debug=&quot;0&quot; reloadable=&quot;true&quot; crossContext=&quot;true&quot;/&gt;</div><div class="line">	&lt;Logger className=&quot;org.apache.catalina.logger.FileLogger&quot; directory=&quot;logs&quot; prefix=&quot;tot_log.&quot; suffix=&quot;.txt&quot; timestamp=&quot;true&quot;/&gt;</div><div class="line">&lt;/Host&gt;</div></pre></td></tr></table></figure>
<p>注意:<br>1.将上述内容放到 <code>&lt;/Host&gt;</code> 和 <code>&lt;/Engine&gt;</code> 节点中间.<br>2.将 <code>name=&quot;&lt;your local ip&gt;&quot;</code> 中的 <your local="" ip=""> 改为你本机的 ip 地址.<br>查看本机的 ip 地址方法很简单:</your></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ifconfig | grep &quot;inet &quot; | grep -v 127.0.0.1</div></pre></td></tr></table></figure>
<p>3.将 appBase=”<base dir="">“ 中的 <base dir=""> 改为你的 web 目录.<br>4.将 docBase=”<html file="" path="">“ 中的 <html file="" path=""> 改为你的 html 目录.</html></html></p>
<p>我的配置如下(部分):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">	&lt;Host name=&quot;localhost&quot;  appBase=&quot;webapps&quot;</div><div class="line">            unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;&gt;</div><div class="line">        &lt;!-- SingleSignOn valve, share authentication between web applications</div><div class="line">             Documentation at: /docs/config/valve.html --&gt;</div><div class="line">        &lt;!--</div><div class="line">        &lt;Valve className=&quot;org.apache.catalina.authenticator.SingleSignOn&quot; /&gt;</div><div class="line">        --&gt;</div><div class="line">        &lt;!-- Access log processes all example.</div><div class="line">             Documentation at: /docs/config/valve.html</div><div class="line">             Note: The pattern used is equivalent to using pattern=&quot;common&quot; --&gt;</div><div class="line">        &lt;Valve className=&quot;org.apache.catalina.valves.AccessLogValve&quot; directory=&quot;logs&quot;</div><div class="line">               prefix=&quot;localhost_access_log&quot; suffix=&quot;.txt&quot;</div><div class="line">               pattern=&quot;%h %l %u %t &amp;quot;%r&amp;quot; %s %b&quot; /&gt;</div><div class="line">	&lt;/Host&gt;</div><div class="line">        &lt;!--mark 配置静态网页. [BEGIN] --&gt;</div><div class="line">        &lt;Host name=&quot;192.168.1.103&quot; debug=&quot;0&quot; appBase=&quot;webapps&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot; xmlValidation=&quot;false&quot;  xmlNamespaceAware=&quot;false&quot;&gt;</div><div class="line">            &lt;Context path=&quot;&quot; docBase=&quot;test&quot; debug=&quot;0&quot; reloadable=&quot;true&quot; crossContext=&quot;true&quot;/&gt;</div><div class="line">            &lt;Logger className=&quot;org.apache.catalina.logger.FileLogger&quot; directory=&quot;logs&quot; prefix=&quot;tot_log.&quot; suffix=&quot;.txt&quot; timestamp=&quot;true&quot;/&gt;</div><div class="line">        &lt;/Host&gt;</div><div class="line">        &lt;!--mark 配置静态网页. [END] --&gt;</div><div class="line">    &lt;/Engine&gt;</div><div class="line">  &lt;/Service&gt;</div><div class="line">&lt;/Server&gt;</div></pre></td></tr></table></figure>
<p>搞定上面的配置, 接下来可以配置相关目录了.</p>
<p>在 Tomcat 的根目录有个文件夹 webapps, 在 webapps 目录下新建目录 test 即可.</p>
<h2 id="构建-HTML-页面"><a href="#构建-HTML-页面" class="headerlink" title="构建 HTML 页面"></a>构建 HTML 页面</h2><p>在 test 目录, 新建一个 html 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">touch test.html</div></pre></td></tr></table></figure>
<p>文件内容如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"> &lt;p&gt;</div><div class="line">&lt;em&gt;Sample&lt;/em&gt; text&lt;/p&gt;</div><div class="line">&lt;p&gt;</div><div class="line">Now I input another line, with fancy&lt;u&gt;&lt;strong&gt;&lt;em&gt;styles&lt;/em&gt;&lt;/strong&gt;</div><div class="line">&lt;/u&gt;.&lt;/p&gt;</div><div class="line">&lt;p&gt;</div><div class="line">&lt;em&gt;Sample&lt;/em&gt; text&lt;/p&gt;</div><div class="line">&lt;p&gt;</div><div class="line">Now I input another line, with fancy &lt;u&gt;&lt;strong&gt;&lt;em&gt;styles&lt;/em&gt;&lt;/strong&gt;</div><div class="line">&lt;/u&gt;.&lt;/p&gt;</div><div class="line">&lt;p&gt;</div><div class="line">    mark.zhang is itman.</div><div class="line">&lt;/p&gt;</div><div class="line">&lt;style&gt;</div><div class="line">.button &#123;</div><div class="line">    background-color: #4CAF50;</div><div class="line">    border: none;</div><div class="line">    color: white;</div><div class="line">    padding: 15px 32px;</div><div class="line">    text-align: center;</div><div class="line">    text-decoration: none;</div><div class="line">    display: inline-block;</div><div class="line">    font-size: 86px;</div><div class="line">    margin: 50px 200px 100px 300px;</div><div class="line">    cursor: pointer;</div><div class="line">    border-radius: 15;</div><div class="line">&#125;</div><div class="line">&lt;/style&gt;</div><div class="line">&lt;p&gt;</div><div class="line">   &lt;button type=&quot;button&quot; onclick=&quot;myFunction()&quot; class=&quot;button&quot;&gt;Try it&lt;/button&gt;</div><div class="line">&lt;/p&gt;</div><div class="line">&lt;script&gt;</div><div class="line">   function myFunction() &#123;</div><div class="line">       alert(&quot;Blog: www.veryitman.com&quot;);</div><div class="line">   &#125;;</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
<p>搭建完成后, 启动 Tomcat 服务器.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">startup.sh</div></pre></td></tr></table></figure>
<p>在浏览器里面通过 ip:port/test.html 的方式来访问该页面.</p>
<p>看到类似下面的效果即表示搭建成功:</p>
<p><img src="/upload/images/2017/01/15/html.png" alt="1"></p>
<h2 id="客户端访问"><a href="#客户端访问" class="headerlink" title="客户端访问"></a>客户端访问</h2><p>客户端访问该页面, 使用 UIWebview 来请求(HTTP 协议)页面内容.</p>
<p>一般请求会使用下面的方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">+ (instancetype)requestWithURL:(NSURL *)URL;</div></pre></td></tr></table></figure>
<p>该方法的描述如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Creates and returns a URL request for a specified URL with default cache policy and timeout value.</div><div class="line">The default cache policy is NSURLRequestUseProtocolCachePolicy and the default timeout interval is 60 seconds.</div></pre></td></tr></table></figure>
<p>大概意思是使用的缓存策略是根据协议来的, 即 NSURLRequestUseProtocolCachePolicy. 超时时间默认是60s.</p>
<p>也就是说类似如下的请求:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSURLRequest *urlReq = [NSURLRequest requestWithURL:url cachePolicy:NSURLRequestUseProtocolCachePolicy timeoutInterval:60.f];</div></pre></td></tr></table></figure>
<p>如果协议支持缓存的话, UIWebview 请求到的数据就是缓存数据.该缓存是需要 WEB 服务器支持的.</p>
<p>这里我没有配置 Tomcat 的缓存.可以抓包看下:</p>
<p><img src="/upload/images/2017/01/15/rsp1.png" alt="2"></p>
<p>后续博客会分别为大家介绍在 Tomcat 和 Nginx 配置缓存下, 客户端 UIWebview 请求的相关问题.</p>
<p>客户端显示页面效果:<br><img src="/upload/images/2017/01/15/c1.jpeg" alt="2"></p>
<p>ViewController 代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line"></div><div class="line">static NSString * const H5Url = @&quot;http://192.168.1.104:8080/test.html&quot;;</div><div class="line"></div><div class="line">@interface ViewController () &lt;UIWebViewDelegate&gt;</div><div class="line"></div><div class="line">@property (nonatomic, strong) UIWebView *webView;</div><div class="line"></div><div class="line">@property (nonatomic, strong) UIButton *refBtn;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad</div><div class="line">&#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    </div><div class="line">    _webView = [[UIWebView alloc] init];</div><div class="line">    CGSize boundsSize = self.view.bounds.size;</div><div class="line">    self.webView.frame = CGRectMake(0, 20, boundsSize.width, boundsSize.height);</div><div class="line">    self.webView.backgroundColor = [UIColor whiteColor];</div><div class="line">    self.webView.scrollView.showsHorizontalScrollIndicator = NO;</div><div class="line">    self.webView.scrollView.showsVerticalScrollIndicator   = NO;</div><div class="line">    self.webView.scalesPageToFit = YES;</div><div class="line">    self.webView.delegate = self;</div><div class="line">    [self.view addSubview:self.webView];</div><div class="line">    </div><div class="line">    UIButton *refreshBtn = [UIButton buttonWithType:UIButtonTypeCustom];</div><div class="line">    [self.view addSubview:refreshBtn];</div><div class="line">    [refreshBtn addTarget:self action:@selector(onRefreshWebView) forControlEvents:UIControlEventTouchUpInside];</div><div class="line">    refreshBtn.backgroundColor = [UIColor redColor];</div><div class="line">    refreshBtn.layer.masksToBounds = YES;</div><div class="line">    refreshBtn.layer.cornerRadius = 5.f;</div><div class="line">    refreshBtn.frame = CGRectMake(50, 250, 200, 50);</div><div class="line">    [refreshBtn setTitle:@&quot;刷新页面&quot; forState:UIControlStateNormal];</div><div class="line">    _refBtn = refreshBtn;</div><div class="line">    </div><div class="line">    [self loadDataUsingCache];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)webView:(UIWebView *)webView didFailLoadWithError:(NSError *)error</div><div class="line">&#123;</div><div class="line">    NSLog(@&quot;didFailLoadWithError: %@&quot;, error);</div><div class="line">    </div><div class="line">    [self hideLoading];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request</div><div class="line"> navigationType:(UIWebViewNavigationType)navigationType</div><div class="line">&#123;</div><div class="line">    NSLog(@&quot;shouldStartLoadWithRequest: %@&quot;, request);</div><div class="line">    return YES;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)webViewDidStartLoad:(UIWebView *)webView</div><div class="line">&#123;</div><div class="line">    NSLog(@&quot;webViewDidStartLoad&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)webViewDidFinishLoad:(UIWebView *)webView</div><div class="line">&#123;</div><div class="line">    NSLog(@&quot;webViewDidFinishLoad&quot;);</div><div class="line">    </div><div class="line">    [self hideLoading];</div><div class="line">&#125;</div><div class="line"></div><div class="line">//刷新页面.</div><div class="line">- (void)onRefreshWebView</div><div class="line">&#123;</div><div class="line">    // 方式1: 不使用缓存请求数据</div><div class="line">    //[self loadDataNoUsingCache];</div><div class="line">    </div><div class="line">    // 方式2: 清除 NSCache 缓存, 再请求数据</div><div class="line">    [self clearAllCache];</div><div class="line">    [self loadDataUsingCache];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)loadDataUsingCache</div><div class="line">&#123;</div><div class="line">    [self showLoading];</div><div class="line">    </div><div class="line">    NSURL *url = [NSURL URLWithString:H5Url];</div><div class="line">    </div><div class="line">    NSURLRequest *urlReq = [NSURLRequest requestWithURL:url</div><div class="line">                                            cachePolicy:NSURLRequestReturnCacheDataDontLoad</div><div class="line">                                        timeoutInterval:10.f];</div><div class="line">    </div><div class="line">    [self.webView loadRequest:urlReq];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)loadDataWithProtocol</div><div class="line">&#123;</div><div class="line">    [self showLoading];</div><div class="line">    </div><div class="line">    NSURL *url = [NSURL URLWithString:H5Url];</div><div class="line">    </div><div class="line">    [NSURLRequest requestWithURL:url];</div><div class="line">    </div><div class="line">    NSURLRequest *urlReq = [NSURLRequest requestWithURL:url</div><div class="line">                                            cachePolicy:NSURLRequestUseProtocolCachePolicy</div><div class="line">                                        timeoutInterval:60.f];</div><div class="line">    </div><div class="line">    [self.webView loadRequest:urlReq];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)loadDataNoUsingCache</div><div class="line">&#123;</div><div class="line">    [self showLoading];</div><div class="line">    </div><div class="line">    NSURL *url = [NSURL URLWithString:H5Url];</div><div class="line">    NSURLRequest *urlReq = [NSURLRequest requestWithURL:url</div><div class="line">                                            cachePolicy:NSURLRequestReloadIgnoringCacheData</div><div class="line">                                        timeoutInterval:20.0];</div><div class="line">    [self.webView loadRequest:urlReq];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)clearAllCache</div><div class="line">&#123;</div><div class="line">    // remove cache rsp</div><div class="line">    [[NSURLCache sharedURLCache] removeAllCachedResponses];</div><div class="line">    </div><div class="line">    [[NSURLCache sharedURLCache] setDiskCapacity:0];</div><div class="line">    [[NSURLCache sharedURLCache] setMemoryCapacity:0];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)showLoading</div><div class="line">&#123;</div><div class="line">    [self.refBtn setTitle:@&quot;刷新中...&quot; forState:UIControlStateNormal];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)hideLoading</div><div class="line">&#123;</div><div class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</div><div class="line">        [self.refBtn setTitle:@&quot;刷新页面&quot; forState:UIControlStateNormal];</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>这里注意下面的 三个方法 :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// 使用缓存数据, 如果有缓存的话</div><div class="line">// 使用这个方法, 改变 HTML 或者 JS 代码</div><div class="line">// 页面不会拉取最新数据, 还是使用之前请求到的数据.</div><div class="line">// 除非重新刷新</div><div class="line">- (void)loadDataUsingCache;</div><div class="line">// 使用协议缓存, 需要 web 服务器支持.</div><div class="line">- (void)loadDataWithProtocol;</div><div class="line">// 不使用缓存, 加载数据</div><div class="line">- (void)loadDataNoUsingCache;</div></pre></td></tr></table></figure>
<p>另外, 刷新 UIWebview 的方式如下, 有 两种方式 来刷新页面:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> *  刷新页面.</div><div class="line"> */</div><div class="line">- (void)onRefreshWebView</div><div class="line">&#123;</div><div class="line">    // 方式1: 不使用缓存请求数据</div><div class="line">    //[self loadDataNoUsingCache];</div><div class="line">    </div><div class="line">    // 方式2: 清除 NSCache 缓存, 再请求数据</div><div class="line">    [self clearAllCache];</div><div class="line">    [self loadDataUsingCache];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这种刷新方式, 会重新加载数据.<br>但是不适合多层级的 HTML 页面, 比如你的 HTML 页面有很多层, 想刷新当前页面, 可以使用下面的方式:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 重新加载当前页面</div><div class="line">[self.webView reload];</div></pre></td></tr></table></figure>
<h2 id="附加"><a href="#附加" class="headerlink" title="附加"></a>附加</h2><p>查看本机 IP 的 shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#!/bin/sh</div><div class="line">ifconfig | grep &quot;inet &quot; | grep -v 127.0.0.1</div></pre></td></tr></table></figure>
<p>停止 Tomcat 的运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shutdown.sh</div></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> iOS UIWebView </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[f8app]]></title>
      <url>/2017/01/01/f8app/</url>
      <content type="html"><![CDATA[<p>本文主要探讨的是如何编译和运行 f8app.</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><code>f8app</code> 是 Facebook 开源的, 基于 React Native 开发的一款 App.</p>
<p>代码基本都是 js 的, 很少有原生的代码.</p>
<p><code>f8app</code> 是借鉴和学习 React Native 的上好资料.</p>
<p>原文介绍:</p>
<blockquote>
<p>This is the entire source code of the official F8 app of 2016, available on Google Play and the App Store.</p>
</blockquote>
<p>项目开源地址: <a href="https://github.com/fbsamples/f8app" target="_blank" rel="noopener">Github</a></p>
<h2 id="编译运行"><a href="#编译运行" class="headerlink" title="编译运行"></a>编译运行</h2><h3 id="环境要求"><a href="#环境要求" class="headerlink" title="环境要求"></a>环境要求</h3><ul>
<li>安装和配置了 React Native 开发环境.</li>
<li>Xcode 7.3 +</li>
<li>CocoaPods (only for iOS) 1.0+</li>
<li>MongoDB (needed to run Parse Server locally)</li>
</ul>
<h3 id="源码构建"><a href="#源码构建" class="headerlink" title="源码构建"></a>源码构建</h3><p>下载源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/fbsamples/f8app.git</div></pre></td></tr></table></figure>
<p>下载完成后, 进入下载的 f8app 目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd f8app</div><div class="line">npm install</div></pre></td></tr></table></figure>
<p>如果是 iOS 的话, 需要进入 iOS 目录执行 <code>pod install</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd ios</div><div class="line">pod install</div></pre></td></tr></table></figure>
<p>在项目 f8app 目录下运行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm start</div></pre></td></tr></table></figure>
<p>打开浏览器输入地址 <a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a>, 可以看到 graphql 的界面.</p>
<h3 id="安装-MongoDB"><a href="#安装-MongoDB" class="headerlink" title="安装 MongoDB"></a>安装 MongoDB</h3><p>使用 Homebrew 来安装.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install mongodb</div></pre></td></tr></table></figure>
<h3 id="导入数据"><a href="#导入数据" class="headerlink" title="导入数据"></a>导入数据</h3><p>导入例子数据.</p>
<p>注意:<br>在源码的路径即 <code>~/yourpath/f8app</code> 下面执行, 下面操作没有特殊说明都是在源码根目录下面操作.<br>你可以多开几个终端端口来进行操作.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm run import-data</div></pre></td></tr></table></figure>
<p>导入例子数据, 会报下面的 错误:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">error: Uncaught internal server error. &#123; [MongoError: connect ECONNREFUSED 127.0.0.1:27017]</div><div class="line">name: &apos;MongoError&apos;,</div><div class="line">message: &apos;connect ECONNREFUSED 127.0.0.1:27017&apos; &#125; Error: connect ECONNREFUSED 127.0.0.1:27017</div><div class="line">at Object.exports._errnoException (util.js:893:11)</div><div class="line">at exports._exceptionWithHostPort (util.js:916:20)</div><div class="line">at TCPConnectWrap.afterConnect as oncomplete</div></pre></td></tr></table></figure>
<p>需要安装 <code>mongodb-runner</code></p>
<p>安装方法如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo npm install -g parse-server mongodb-runner</div></pre></td></tr></table></figure>
<p>运行 <code>mongodb-runner</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongodb-runner start</div></pre></td></tr></table></figure>
<p>这里执行完毕后, 需要等待一会.</p>
<p>你会看到如下信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Starting a MongoDB deployment to test against...</div></pre></td></tr></table></figure>
<p>上面运行结束后, 你可以查看 MongoDB 是否在运行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lsof -iTCP:27017 -sTCP:LISTEN</div></pre></td></tr></table></figure>
<p>会显示当前正在运行的信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">COMMAND   PID USER   FD   TYPE             DEVICE    SIZE/OFF  NODE  NAME</div><div class="line">mongod  86824 mark    7u  IPv4    0x91959c43a65644ed      0t0  TCP *:27017 (LISTEN)</div></pre></td></tr></table></figure>
<p>停止 mongodb 运行的方式如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongodb-runner stop</div></pre></td></tr></table></figure>
<h2 id="查看数据"><a href="#查看数据" class="headerlink" title="查看数据"></a>查看数据</h2><p><a href="http://localhost:8080/dashboard" target="_blank" rel="noopener">Parse Dashboard</a></p>
<p><a href="http://localhost:8080/graphql" target="_blank" rel="noopener">GraphiQL</a></p>
<h3 id="启动-react-native"><a href="#启动-react-native" class="headerlink" title="启动 react-native"></a>启动 react-native</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">react-native start</div></pre></td></tr></table></figure>
<h3 id="运行-f8app"><a href="#运行-f8app" class="headerlink" title="运行 f8app"></a>运行 f8app</h3><p>Android:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">react-native run-android</div><div class="line">adb reverse tcp:8081 tcp:8081   # required to ensure the Android app can</div><div class="line">adb reverse tcp:8080 tcp:8080   # access the Packager and GraphQL server</div></pre></td></tr></table></figure>
<p>iOS:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">react-native run-ios</div></pre></td></tr></table></figure>
<p>如果出现红色背景的 error 提示, 可以不管, 直接 Dismiss 即可.</p>
<p>然后可以看到如下界面:</p>
<p><img src="/upload/images/2017/01/01/f8app.jpg" alt="1"></p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>1.在运行后关闭登录按钮, 报错: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">AppEventsLogger.logEvent</div></pre></td></tr></table></figure>
<p>解决方案:</p>
<p>在 <code>/js/store/track.js</code> 文件的第 43 行, 注释掉 log, 如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">case &apos;SKIPPED_LOGIN&apos;:</div><div class="line">      //AppEventsLogger.logEvent(&apos;Skip login&apos;, 1);</div><div class="line">      break;</div></pre></td></tr></table></figure>
<p>在模拟器上面重新 Reload 即可.</p>
]]></content>
      
        <categories>
            
            <category> ReactNative </category>
            
        </categories>
        
        
        <tags>
            
            <tag> iOS Android JavaScript </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[再见 2016]]></title>
      <url>/2016/12/11/%E5%86%8D%E8%A7%81-2016/</url>
      <content type="html"><![CDATA[<p>今天是 2016 年的最后一天, 正好赶上放假, 给自己的这一年做个小结.</p>
<p>2016, 继续做项目, 作为一名软件工程师, 不停地在学习.</p>
<p>2016, 学习到了很多关于产品和运营相关的知识. 知道了 倒逼 的作用.</p>
<p>2016, 读了 20 本非技术类书籍, 养成了读书的习惯, 并把读书的好处讲给身边的人听.</p>
<p>2016, 开始减肥, 注意锻炼身体, 几乎每周都有一次从公司到家的步行, 一次篮球或者跑步运动.</p>
<p>2016, 购买了域名, 建立了自己的 <a href="file:///Users/mark/Desktop/backups/public/2016/12/31/veryitman.com" target="_blank" rel="noopener">博客网站</a>.</p>
<p>2016, 儿子大了一岁, 自己老了一岁, 家庭依旧幸福着.渐渐地理解了做父亲的责任.</p>
<p>2016 对自己影响最大的几句话, 分享给大家:</p>
<blockquote>
<p>1.技术要给产品提供最大的自由度.<br>2.不要轻易的说 NO.<br>3.要不断的让自己值钱, 而不是简单的为了金钱而跳槽.<br>4.不要总是抱怨你的产品设计是狗屎, 学会和产品沟通更优的方案.<br>5.关注细节, 把产品做好.<br>6.多关注别人的优点.<br>7.让对方把话说完.<br>8.多看书, 多思考.</p>
</blockquote>
<p>感谢所有陪伴和支持我的朋友, 同事, 亲人!</p>
<p>祝愿所有人 2017 幸福, 健康, 快乐!</p>
]]></content>
      
        <categories>
            
            <category> 随笔 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 随笔 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Mac 配置 Tomcat8]]></title>
      <url>/2016/11/26/Mac-%E9%85%8D%E7%BD%AE-Tomcat8/</url>
      <content type="html"><![CDATA[<h2 id="Tomcat-简介"><a href="#Tomcat-简介" class="headerlink" title="Tomcat 简介"></a>Tomcat 简介</h2><p>Tomcat 是一个 Web 服务器.</p>
<blockquote>
<p>Web 服务器是指为特定组件提供服务的一个标准化的运行时的环境.<br>可为组件提供事务处理, 数据访问, 安全性和持久性等服务.</p>
</blockquote>
<p>Tomcat 是免费且开源的, 他是 Apache 软件基金会 Jakarta 项目中的其中一个子项目.由 Apache, Sun 和其他一些公司及个人共同开发完成.</p>
<p>Tomcat 也是使用最为广泛的 JSP 服务器.</p>
<blockquote>
<p>JSP 是 Java Server Pages 的简称, 是在传统的 HTML 文件中插入 Java 程序段和 JSP 标记的一种动态网页技术.</p>
</blockquote>
<h2 id="下载-Tomcat"><a href="#下载-Tomcat" class="headerlink" title="下载 Tomcat"></a>下载 Tomcat</h2><p>前往 <a href="http://tomcat.apache.org/download-80.cgi" target="_blank" rel="noopener">这里</a> 可以下载 Tomcat.</p>
<p>我目前安装的是 8.5.8 版本的.</p>
<p><img src="/upload/images/2016/11/26/tomcat1.png" alt="1"></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>先安装 JDK, 安装教程可以参考 [Mac 配置 JDK1.8] 这篇文章.</p>
<p>解压下载的 tar.gz 即可.</p>
<p>最好解压到自己的工作目录, 如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">~/workspace/developr/</div></pre></td></tr></table></figure>
<h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><p>编辑 <code>/etc/profile</code> 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo vim /etc/profile</div></pre></td></tr></table></figure>
<p>添加如下变量:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">JRE_HOME=$JAVA_HOME</div><div class="line">TOMCAT_HOME=/Users/mark/developer/apache/apache-tomcat-8.5.8</div><div class="line">PATH=$JAVA_HOME/bin:$TOMCAT_HOME/bin:$PATH</div><div class="line">export JRE_HOME</div><div class="line">export PATH</div></pre></td></tr></table></figure>
<p>其中的 JAVA_HOME 是 [Mac 配置 JDK1.8] 这篇文章里面设置的 JDK 的环境变量.</p>
<p>配置环境变量的目的, 可以让我们方便的使用 Tomcat 的命令.</p>
<h2 id="检验安装是否成功"><a href="#检验安装是否成功" class="headerlink" title="检验安装是否成功"></a>检验安装是否成功</h2><p>使 <code>/etc/profile</code> 配置文件立即生效.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source /etc/profile</div></pre></td></tr></table></figure>
<p>如果没有生效, 重启终端即可.</p>
<p>开启 Tomcat 服务, 执行下面的命令:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">startup.sh</div></pre></td></tr></table></figure>
<p>该命令在 Tomcat 的安装目录的 bin 目录下面.</p>
<p>执行后, 可以看到:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Using CATALINA_BASE:   /Users/mark/developer/apache/apache-tomcat-8.5.8</div><div class="line">Using CATALINA_HOME:   /Users/mark/developer/apache/apache-tomcat-8.5.8</div><div class="line">Using CATALINA_TMPDIR: /Users/mark/developer/apache/apache-tomcat-8.5.8/temp</div><div class="line">Using JRE_HOME:        /Library/Java/JavaVirtualMachines/jdk1.8.0_112.jdk/Contents/Home</div><div class="line">Using CLASSPATH:       /Users/mark/developer/apache/apache-tomcat-8.5.8/bin/bootstrap.jar:/Users/mark/developer/apache/apache-tomcat-8.5.8/bin/tomcat-juli.jar</div><div class="line">Tomcat started.</div></pre></td></tr></table></figure>
<p>在浏览器里面打开: <a href="http://localhost:8080/" target="_blank" rel="noopener">http://localhost:8080/</a></p>
<p>即可看到一只可爱的 Tom 猫.</p>
<p>执行 <code>shutdown.sh</code> 可以关闭 Tomcat.</p>
]]></content>
      
        <categories>
            
            <category> Java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Tomcat Java </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Mac 安装和使用 infer]]></title>
      <url>/2016/11/26/Mac-%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8-infer/</url>
      <content type="html"><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>infer 是 Facebook 开源的一款代码静态检查工具, 源码可以在 <a href="https://github.com/facebook/infer" target="_blank" rel="noopener">Github</a> 上面获取.</p>
<p>支持 Java/C/OC 等语言, 支持 Gradle, Buck, Maven, Xcodebuild, Make 等.</p>
<p>我一般用来分析 iOS 和 Android 工程.</p>
<p>可以在 <a href="http://fbinfer.com/docs/getting-started.html" target="_blank" rel="noopener">这里</a> 查看 Start.</p>
<h2 id="安装-infer"><a href="#安装-infer" class="headerlink" title="安装 infer"></a>安装 infer</h2><p>只要你用 Homebrew, mac 下安装 infer 很简单:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">brew update</div><div class="line">brew install infer</div></pre></td></tr></table></figure>
<p>在早期版本, infer 不支持 brew 安装. 安装起来各种问题, 现在 infer 支持了 brew 安装, 很方便.</p>
<p>这里我使用的 infer 版本是 0.9.4.</p>
<p>安装成功后, 可以查看安装版本:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">infer -version</div></pre></td></tr></table></figure>
<p>可以看到如下信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Infer version v0.9.4</div><div class="line">Copyright 2009 - present Facebook. All Rights Reserved.</div><div class="line">Mac:public mark$ infer --version</div><div class="line">Infer version v0.9.4</div><div class="line">Copyright 2009 - present Facebook. All Rights Reserved.</div></pre></td></tr></table></figure>
<p>这里有个问题, 有时候 brew 无法更新最新的 infer, 我目前的解决方案是先卸载之前安装的 infer, 然后再重新安装.</p>
<p>卸载 infer</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew uninstall infer</div></pre></td></tr></table></figure>
<h2 id="安装-xcpretty"><a href="#安装-xcpretty" class="headerlink" title="安装 xcpretty"></a>安装 xcpretty</h2><p><a href="https://github.com/supermarin/xcpretty" target="_blank" rel="noopener">xcpretty</a> 是一款格式化 xcodebuild 输出结果的工具.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">▸ Building X/N [(Release)]</div><div class="line">▸ Check Dependencies</div><div class="line">▸ Copying Info.plist</div><div class="line">▸ Running script &apos;[CP] Check Pods Manifest.lock&apos;</div><div class="line">▸ Running script &apos;Replace PaySdk&apos;</div><div class="line">▸ Compiling User.m</div></pre></td></tr></table></figure>
<p>从0.9.4版本后, infer 默认使用了 xcpretty.</p>
<p>可以使用 gem 安装 xcpretty 工具:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem install xcpretty</div></pre></td></tr></table></figure>
<p>如果没有安装成功, 或者提示权限不够, 那就这样折腾:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo gem install xcpretty</div></pre></td></tr></table></figure>
<p>想了解更多关于 xcpretty 的使用可以去 <a href="https://github.com/supermarin/xcpretty" target="_blank" rel="noopener">github</a>.</p>
<h2 id="使用-infer"><a href="#使用-infer" class="headerlink" title="使用 infer"></a>使用 infer</h2><h3 id="iOS-项目使用-infer"><a href="#iOS-项目使用-infer" class="headerlink" title="iOS 项目使用 infer"></a>iOS 项目使用 infer</h3><p>infer 的文档写的也较全面.</p>
<p>可以在 <a href="http://fbinfer.com/docs/infer-workflow.html" target="_blank" rel="noopener">这里</a> 查看使用方法.</p>
<p>1.分析 Cocoapods 项目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">infer -- xcodebuild -workspace N.xcworkspace -scheme NSchema</div></pre></td></tr></table></figure>
<p>其中 N.xcworkspace 是你的 workspace 名称, NSchema 是你需要检查的 Schema 名称.</p>
<p>2.分析 .xcodeproj</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">infer -- xcodebuild -target targetName -configuration Debug -sdk iphonesimulator</div></pre></td></tr></table></figure>
<p>其中 targetName 是项目的 target 名称, 必须指定.</p>
<p>分析成功后, infer 会有输出报告.</p>
<p>该报告在你的项目目录下, 名称是 infer-out.</p>
<p>bug.txt 是以文本方式输出的 issue 文档.<br>另外还有 csv 格式的 issue 文档.</p>
<h3 id="Android-Gradle-工程使用-infer"><a href="#Android-Gradle-工程使用-infer" class="headerlink" title="Android Gradle 工程使用 infer"></a>Android Gradle 工程使用 infer</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">gradle clean</div><div class="line">infer -- gradle build</div></pre></td></tr></table></figure>
<h2 id="其他用法"><a href="#其他用法" class="headerlink" title="其他用法"></a>其他用法</h2><p>infer 还有很多高级的用法, 比如可以增量检查.</p>
<p>增量检查的功能依赖于你的编译器是否支持.</p>
<p>infer 增量检查的选项是 –reactive.</p>
<blockquote>
<p>之前的版本是 –incremental 选项.<br>自从 v0.8.0 版本后使用了 –reactive 选项.</p>
</blockquote>
<p>可以这样来进行增量检查:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">infer --reactive -- xcodebuild -workspace N.xcworkspace -scheme NSchema</div></pre></td></tr></table></figure>
<p>infer 还有很多高级用法, 可以在 <a href="http://fbinfer.com/docs/advanced-features.html" target="_blank" rel="noopener">Advanced usage</a> 中去查阅和使用.</p>
<p>再使用过程中, 随着 MacOS, Xcode 的升级, infer 会面临更多的挑战, 如果遇到问题, 第一时间去 <a href="https://github.com/facebook/infer" target="_blank" rel="noopener">GitHub</a>  上面提  issue.</p>
]]></content>
      
        <categories>
            
            <category> MacOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> MacOS infer </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Mac 配置 JDK1.8]]></title>
      <url>/2016/11/26/Mac-%E9%85%8D%E7%BD%AE-JDK1-8/</url>
      <content type="html"><![CDATA[<h2 id="下载-JDK"><a href="#下载-JDK" class="headerlink" title="下载 JDK"></a>下载 JDK</h2><p>在 <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">这里下载</a> jdk.</p>
<p>下载版本是 1.8u112, 信息如下:</p>
<p><img src="/upload/images/2016/11/26/jdk1.png" alt="1"></p>
<h2 id="安装-JDK"><a href="#安装-JDK" class="headerlink" title="安装 JDK"></a>安装 JDK</h2><p>下载完成后, 直接双击安装即可.</p>
<h2 id="配置-Path"><a href="#配置-Path" class="headerlink" title="配置 Path"></a>配置 Path</h2><p>成功安装后, 目录<br><code>/Library/Java/JavaVirtualMachines/jdk1.8.0_112.jdk/</code> 就会存在.</p>
<p>编辑 <code>/etc/profile</code> 文件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo vim /etc/profile</div></pre></td></tr></table></figure>
<p>添加如下代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_112.jdk/Contents/Home</div><div class="line">CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</div><div class="line">PATH=$JAVA_HOME/bin:$PATH</div><div class="line">export JAVA_HOME</div><div class="line">export CLASSPATH</div><div class="line">export PATH</div></pre></td></tr></table></figure>
<p>保存文件.</p>
<p>使这个文件立即生效.可以 source 一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source /etc/profile</div></pre></td></tr></table></figure>
<h2 id="检验"><a href="#检验" class="headerlink" title="检验"></a>检验</h2><p>执行下面命令来检验 jdk 是否安装成功.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java -version</div></pre></td></tr></table></figure>
<p>输出如下信息, 标示配置 JDK 成功.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">java version “1.8.0_112”</div><div class="line">Java(TM) SE Runtime Environment (build 1.8.0_112-b16)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.112-b16, mixed mode)</div></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> MacOS java jdk </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[GameDevelopment: 与 Cocos2d 的再相逢]]></title>
      <url>/2016/11/12/GameDevelopment-%E4%B8%8E-Cocos2d-%E7%9A%84%E5%86%8D%E7%9B%B8%E9%80%A2/</url>
      <content type="html"><![CDATA[<h2 id="认识-Cocos2d"><a href="#认识-Cocos2d" class="headerlink" title="认识 Cocos2d"></a>认识 Cocos2d</h2><p>相信很多人听说过 cocos2d-x 这个引擎, 但听过 <a href="http://cocos2d-objc.org/" target="_blank" rel="noopener">cocos2d-objc</a> 的人应该不多.</p>
<p>cocos2d-objc 是 cocos 系列的 objective-c 版本.<br>开发语言是 OC.在 iOS 上面使用该版本的引擎, 基本是无缝连接(写的没有什么障碍).</p>
<p>欣赏一下 cocos2d-objc 的 logo, 如图:<br><img src="/upload/images/2016/11/12/1.png" alt="1"></p>
<p>如果你对 OC 版感兴趣, 可以通过博文 <a href="http://blog.csdn.net/veryitman/article/details/44993643" target="_blank" rel="noopener">coco2d-iphone: 环境搭建</a> 去了解.</p>
<p>cocos2d-x 目前支持 JavaScript, lua, c++ 等主流语言来开发.<br>cocos 还在迅猛发展中, 不断的完善开发工具, 广大游戏开发者依然热力贡献, 程序猿们在游戏的战场挥洒青春.</p>
<p>现在 cocos 的开发者会得到更多的支持.</p>
<p>下面给张图来展示 cocos 家族及其发展:<br><img src="/upload/images/2016/11/12/2.png" alt="1"></p>
<h2 id="由-libgdx-转向-Cocos2d"><a href="#由-libgdx-转向-Cocos2d" class="headerlink" title="由 libgdx 转向 Cocos2d"></a>由 libgdx 转向 Cocos2d</h2><p>几年前, 那个时候还在开发棋牌游戏, 当时自己也是刚刚接触游戏开发这个「高逼格」的行业, 之前自己是个纯 App 开发者.</p>
<p>内心还是蛮激动的, 心想可能要走上人生巅峰了…</p>
<p>棋牌游戏, 当时使用的是 java 的游戏引擎 <a href="https://libgdx.badlogicgames.com/" target="_blank" rel="noopener">libgdx</a> 0.X.X 的版本, 该引擎和 Android 基本也是无缝连接, Api 设计的很好.</p>
<p>现在 libgdx 也发展到了1.6.x 版本了, 工具也完善了很多.</p>
<p>虽然 libgdx 也可以跨平台, 但是最终我们还是选择了 cocos2d-x 来移植该游戏.其中原因是因为 cocos2d-x 太火了, 人也好找.</p>
<p>改为 cocos2d-x 的版本之后, 我就被安排到了另外一个项目, 也是一个棋牌游戏, 该游戏现在在腾讯的微信游戏里面运营.</p>
<p>这个游戏是 cocos2d-objc 的引擎写的, 自己也不会 objc, 于是硬着头皮学习, 很快的就上手了这个项目.写的也是风生水起.</p>
<p>cocos2d-objc, 现在也支持跨平台, 并且有 xcode 的插件, 可以在 xcode 里面写 Android 的代码, 调试开发等.</p>
<p>因为接触 cocos2d, 后面就直接开搞 iOS 开发了.</p>
<h2 id="再次使用-Cocos2d"><a href="#再次使用-Cocos2d" class="headerlink" title="再次使用 Cocos2d"></a>再次使用 Cocos2d</h2><p>互联网 IT 业的发展, 刺激了各个行业的发展, 也促进和激发了新生的技术, 在这个行业, 每个人都能体会 <code>活到老学到老</code> 这句话的含义.</p>
<p>这两年, HTML5 的发展, 让很多程序员重新认识了 JavaScript 的重要性. 特别是最近 ReactNative 的发展, jsPacth 的开源, 微信小程序的推出, 让 JavaScript 火得不要不要的.</p>
<p>说实话, 是时候开始学习前端相关的技术了, 至少你需要去了解.</p>
<p>cocos2d-js 的发展, 给 HTML 游戏开发带来了很多便利. 最近我们需要开发 H5 的游戏, 直接拿起 coco2d-x(支持 JavaScript) 就撸起.</p>
<p>去 <a href="https://github.com/cocos2d/cocos2d-x" target="_blank" rel="noopener">GitHub</a> 上面直接 clone 最新版就可以, 按照 README.md 来搭建环境就好了.</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>这篇博客也是有感而发, 没有实质性的内容.</p>
<p>主要目的是想告诉大家, 技术的发展日新月异, 想在这里大展拳脚, 你需要保持一颗年轻的心, 不怕苦, 勇往直前的精神.</p>
<p>我们需要学习的技术有很多, 我认为, 要根据项目本身的发展来适度的学习, 切记盲目的学习, 学习一门新技术之后, 要及时的运用在项目当中, 并分享给你身边的人.</p>
<blockquote>
<p>不拒绝不排斥新技术, 坚持学习和乐于分享, 应该是必备的技能.</p>
</blockquote>
]]></content>
      
        <categories>
            
            <category> GameDevelopment </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Cocos2d Game </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Mac install Cocoapods]]></title>
      <url>/2016/11/08/Mac-install-Cocoapods/</url>
      <content type="html"><![CDATA[<h2 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h2><p>这篇博客原本被我发表在 <a href="http://blog.csdn.net/veryitman/article/details/50769069" target="_blank" rel="noopener">CSDN</a> .</p>
<p>那里不再更新, 现在在这里做持续更新.</p>
<h2 id="导引"><a href="#导引" class="headerlink" title="导引"></a>导引</h2><p>如果你的 Mac OSX 升级到 10.11.x+, 并且需要安装 Cocoapods, 可以参考本博客.</p>
<h2 id="安装-ruby"><a href="#安装-ruby" class="headerlink" title="安装 ruby"></a>安装 ruby</h2><p>Mac 系统自带了 ruby, 但是建议大家使用 Homebrew 安装 ruby.</p>
<p>因为 Cocoapods 升级需要对应的 ruby 版本也要升级, 使用 Homebrew 比较方便.</p>
<p>安装 ruby:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install ruby</div></pre></td></tr></table></figure>
<p>查看当前安装的 ruby 版本:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ruby -v</div></pre></td></tr></table></figure>
<p>会得到类似下面的信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ruby 2.3.1p112 (2016-04-26 revision 54768) [x86_64-darwin15]</div></pre></td></tr></table></figure>
<p>gem 是管理 Ruby 库和程序的标准包.<br>安装了 ruby, 自带了 gem 工具.</p>
<p>可以使用 <code>gem -v</code> 查看 gem 版本.</p>
<h2 id="安装-Cocoapods"><a href="#安装-Cocoapods" class="headerlink" title="安装 Cocoapods"></a>安装 Cocoapods</h2><p>1.移除原来的源, 不管以前是否安装过 Cocoapods.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem sources --remove http://ruby.taobao.org/</div></pre></td></tr></table></figure>
<p>2.重新添加源, 注意是 https.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem sources -a https://gems.ruby-china.org/</div></pre></td></tr></table></figure>
<p>之前 <a href="https://ruby.taobao.org/" target="_blank" rel="noopener">taobao 的源</a> 好像已经不行了.</p>
<p>3.查看是否添加成功, 该步骤可选.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem sources -l</div></pre></td></tr></table></figure>
<p>安装, 使用 root 权限安装.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo gem install -n /usr/local/bin cocoapods</div></pre></td></tr></table></figure>
<p>这种安装方式, 会安装最新的 release 版本.</p>
<p>你也可以使用下面两种方式来安装.</p>
<p>指定版本安装:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo gem install -n /usr/local/bin cocoapods -v 1.0.0</div></pre></td></tr></table></figure>
<p>安装最新的 release beta 版本:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo gem install -n /usr/local/bin cocoapods --pre</div></pre></td></tr></table></figure>
<h2 id="卸载-Cocoapods"><a href="#卸载-Cocoapods" class="headerlink" title="卸载 Cocoapods"></a>卸载 Cocoapods</h2><p>卸载 Cocoapods 只需执行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo gem uninstall cocoapods</div></pre></td></tr></table></figure>
<p>如果想删除本地的 pod repo, 可以这样:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rm -fr ~/.cocoapods/</div></pre></td></tr></table></figure>
<h2 id="建立本地-repo"><a href="#建立本地-repo" class="headerlink" title="建立本地 repo"></a>建立本地 repo</h2><p>安装完 Cocoapods 后, 需要建立本地的 repo.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod setup</div></pre></td></tr></table></figure>
<p>即使你现在不执行 pod setup, 后面进行 pod install 或者 pod update 的时候, 也会自动的进行 pod setup.</p>
<p>执行 pod setup 的目的是将所有第三方的 podspec 索引文件更新到本地的 <code>~/.cocoapods/repos</code> 目录中.</p>
<h2 id="安装使用中遇到的问题"><a href="#安装使用中遇到的问题" class="headerlink" title="安装使用中遇到的问题"></a>安装使用中遇到的问题</h2><p>问题1: 命令行执行 pod 发生: pod command not found, 但是 sudo pod 却可以执行.</p>
<p>解决方案即如下步骤:</p>
<p>[1].卸载原有的 Cocoapods</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo gem uninstall cocoapods</div></pre></td></tr></table></figure>
<p>[2].重新安装 Cocoapods</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo gem install -n /usr/local/bin cocoapods</div></pre></td></tr></table></figure>
<p>[3].赋予/usr/local/bin给予执行与读取权限:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo chmod -R +rx /usr/local/bin/</div></pre></td></tr></table></figure>
<blockquote>
<p>建议最好使用代(fanq)理(qiang).</p>
</blockquote>
<p>问题2: 更新 gem 过程中, 遇到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Operation not permitted - /usr/bin/update_rubygems</div></pre></td></tr></table></figure>
<p>可以通过通过 brew 安装 ruby 解决.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install ruby</div></pre></td></tr></table></figure>
<p>问题3: pod setup 失败</p>
<p>失败提示信息类似:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Cloning into &apos;master&apos;...</div><div class="line">error: RPC failed; curl 56 SSLRead() return error -36</div><div class="line">fatal: The remote end hung up unexpectedly</div><div class="line">fatal: early EOF</div><div class="line">fatal: index-pack failed</div></pre></td></tr></table></figure>
<p>解决方案: 更新 gem</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo gem update --system</div></pre></td></tr></table></figure>
<p>问题4: 添加源, 提示如下问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source https://gems.ruby-china.org/ already present in the cache</div></pre></td></tr></table></figure>
<p>这个说明你已经添加过该源, 可以使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem sources -l</div></pre></td></tr></table></figure>
<p>来查看已经添加的源.</p>
<h2 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h2><p>1.更新 gem</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo gem update --system</div></pre></td></tr></table></figure>
<p>2.pod repo update</p>
<p>更新本地仓库.</p>
<p>3.pod search xxx</p>
<p>搜索 cocoapods 项目.</p>
<p>4.pod list</p>
<p>列出所有可用的库.</p>
<p>5.pod install</p>
<p>根据 podfile 和 podfile.lock来安装库.</p>
<p>默认会执行 pod repo update.</p>
<p>可以加入参数 <code>–no-repo-update</code> 不执行 pod repo update.</p>
<p>6.pod update</p>
<p>更新已安装的库到最新版本, 并且创建新的 Podfile.lock 文件.</p>
<p>该命令也会默认会执行 pod repo update.</p>
<p>可以加入参数 –no-repo-update 不执行 pod repo update.</p>
<h2 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h2><p>2017-01-04 更新</p>
<blockquote>
<p>升级 ruby 到 2.4 版本后, cocoapods 无法使用了.</p>
</blockquote>
<p>升级的 ruby 版本信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ruby 2.4.0p0 (2016-12-24 revision 57164) [x86_64-darwin15]</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">使用任何 pod 命令都报错:</div><div class="line"></div><div class="line">/usr/local/Cellar/ruby/2.4.0/lib/ruby/2.4.0/rubygems.rb:270:in `find_spec_for_exe&apos;: can&apos;t find gem cocoapods (&gt;= 0.a) (Gem::GemNotFoundException)</div><div class="line">from /usr/local/Cellar/ruby/2.4.0/lib/ruby/2.4.0/rubygems.rb:298:in `activate_bin_path&apos;</div><div class="line">from /usr/local/bin/pod:22:in `&lt;main&gt;&apos;</div></pre></td></tr></table></figure>
<p>查找各种解决方案, 最终还是没有解决.</p>
<p>你可以在 <a href="https://cocoapods.org/app" target="_blank" rel="noopener">这里</a> 下载 Cocoapods 的 Mac 版本 App 使用.</p>
]]></content>
      
        <categories>
            
            <category> MacOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> CocoaPods, iOS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Cocoapods 问题集锦]]></title>
      <url>/2016/11/08/Cocoapods-%E9%97%AE%E9%A2%98%E9%9B%86%E9%94%A6/</url>
      <content type="html"><![CDATA[<h2 id="承诺"><a href="#承诺" class="headerlink" title="承诺"></a>承诺</h2><p>本文会持续更新, 分享在使用 cocoapods 过程中遇到的问题和解决方案.</p>
<p>欢迎大家补充.</p>
<h2 id="安装问题"><a href="#安装问题" class="headerlink" title="安装问题"></a>安装问题</h2><p>可以阅读博客 <a href="http://www.veryitman.com/2016/11/08/2016-11-08-Mac-install-Cocoapods/" target="_blank" rel="noopener">Mac 安装 Cocoapods</a>.</p>
<h2 id="pod-search-问题"><a href="#pod-search-问题" class="headerlink" title="pod search 问题"></a>pod search 问题</h2><blockquote>
<p>pod search 无法搜索到指定的项目</p>
</blockquote>
<p>问题描述: 执行 pod search [Name], 出现类似下面的提示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[!] Unable to find a pod with name, author, summary, or description matching `[Name]`</div></pre></td></tr></table></figure>
<p>解决方案: 删除 search_index.json 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rm ~/Library/Caches/CocoaPods/search_index.json</div></pre></td></tr></table></figure>
<p>然后, 重新执行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod search 项目名称</div></pre></td></tr></table></figure>
<p>如果这样行不通的话, 可以这样:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rm -rf ~/.cocoapods</div><div class="line">rm ~/Library/Caches/CocoaPods/search_index.json</div><div class="line">pod setup</div></pre></td></tr></table></figure>
<p>如果你的网络不好, 需要漫长的等待…</p>
<p>这个时候, 可以去抽半盒烟了. Orz…</p>
<h2 id="pod-setup-问题"><a href="#pod-setup-问题" class="headerlink" title="pod setup 问题"></a>pod setup 问题</h2><blockquote>
<p>pod setup 卡死</p>
</blockquote>
<p>问题描述:</p>
<p>pod setup 会在本地建立 cocoapods 仓库.</p>
<p>在执行的过程中, 你可以在 <code>~/.cocoapods/repos</code> 使用<br><code>du -sh *</code> 来看 repos 目录的大小变化.</p>
<p>如果观察好久, 大小没有变化, 最终会出现类似下面的错误:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Cloning into &apos;master&apos;...</div><div class="line">error: RPC failed; curl 56 SSLRead() return error -36</div><div class="line">fatal: The remote end hung up unexpectedly</div><div class="line">fatal: early EOF</div><div class="line">fatal: index-pack failed</div></pre></td></tr></table></figure>
<p>解决方案: 更新 gem</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo gem update --system</div></pre></td></tr></table></figure>
<p>重新执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod setup</div></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> MacOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> CocoaPods, iOS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Cocoapods 管理开源项目]]></title>
      <url>/2016/11/01/Cocoapods-%E7%AE%A1%E7%90%86%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/</url>
      <content type="html"><![CDATA[<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><ul>
<li><p>创建或者已经有了 github 账号.</p>
</li>
<li><p>了解和熟悉如何在 github 上面创建 Repository.</p>
</li>
<li>安装了 cocoapods.</li>
</ul>
<p>如果你还没有使用 cocoapods, 建议看看 <a href="http://blog.csdn.net/veryitman/article/details/50769069" target="_blank" rel="noopener">Mac OSX 10.11.1+ 安装 Cocoapods</a> 这篇博客.</p>
<p>在博客 iOS 项目: 打造本地 pod 库 里面有介绍如何打造本地的 pod 库.</p>
<p>今天给大家分享如何将代码开源并放到 pod 库中, 供别人使用.<br>这篇博客是基于一个实际例子 <a href="https://github.com/veryitman/MZInsetLabel" target="_blank" rel="noopener">MZInsetLabel</a> 来说明的.</p>
<h2 id="创建-Repository-并完善项目"><a href="#创建-Repository-并完善项目" class="headerlink" title="创建 Repository 并完善项目"></a>创建 Repository 并完善项目</h2><ul>
<li>1.在 github 上面创建 Repository, 取名为 MZInsetLabel.</li>
<li>2.clone 到本地磁盘.</li>
<li>3.写代码, 这里我只写了 MZInsetLabel.h | .m 文件.</li>
<li>4.创建 spec 文件, 使用下面命令:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod spec create MZInsetLabel</div></pre></td></tr></table></figure>
<p>在当前目录会生成 MZInsetLabel.spec 文件.</p>
<p>按照规范和实际情况填写.</p>
<blockquote>
<p>注意: Tag 版本号不要错误.</p>
</blockquote>
<p>最终内容如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Pod::Spec.new do |s|</div><div class="line">  s.name         = &quot;MZInsetLabel&quot;</div><div class="line">  s.version      = &quot;0.2.0&quot;</div><div class="line">  s.summary      = &quot;MZInsetLabel is subClass of UILabel.&quot;</div><div class="line">  s.description  = &lt;&lt;-DESC</div><div class="line">                        MZInsetLabel is a sub class of UILabel that can be set insets.</div><div class="line">                   DESC</div><div class="line">  s.homepage     = &quot;http://www.veryitman.com&quot;</div><div class="line">  s.license      = &quot;MIT&quot;</div><div class="line">  s.author       = &#123; &quot;veryitman&quot; =&gt; &quot;veryitman@126.com&quot; &#125;</div><div class="line">  s.platform     = :ios, &quot;7.0&quot;</div><div class="line">  s.source = &#123; :git =&gt; &quot;https://github.com/veryitman/MZInsetLabel.git&quot;, :tag =&gt; &quot;#&#123;s.version&#125;&quot; &#125;</div><div class="line">  s.source_files  = &quot;*.&#123;h,m&#125;&quot;</div><div class="line">  s.framework  = &quot;UIKit&quot;</div><div class="line">  s.requires_arc = true</div><div class="line">end</div></pre></td></tr></table></figure>
<h2 id="项目检测"><a href="#项目检测" class="headerlink" title="项目检测"></a>项目检测</h2><ol>
<li>检查该 podspec</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod lib lint MZInsetLabel.podspec</div></pre></td></tr></table></figure>
<blockquote>
<p>–verbose 可以输出更加详细的内容</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod lib lint MZInsetLabel.podspec --verbose</div></pre></td></tr></table></figure>
<p>正确的话, 你可以看到</p>
<p><img src="/upload/images/2016/11/1/1.jpg" alt="1"></p>
<h2 id="push-项目到-Repository"><a href="#push-项目到-Repository" class="headerlink" title="push 项目到 Repository"></a>push 项目到 Repository</h2><p>没有错误的话可以执行下面操作.</p>
<ol>
<li>将本地的代码 push 到 github 的 Repository, 就是刚才创建的 MZInsetLabel.</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git add </div><div class="line">git commit -m &quot;Init&quot;</div><div class="line">git push</div></pre></td></tr></table></figure>
<ol>
<li>创建一个 Release 作为 Tag<br>如图所示:</li>
</ol>
<p><img src="/upload/images/2016/11/1/2.jpg" alt="1"></p>
<h2 id="推送到-cocoapods"><a href="#推送到-cocoapods" class="headerlink" title="推送到 cocoapods"></a>推送到 cocoapods</h2><p>1.注册 trunk</p>
<blockquote>
<p>pod trunk register 你的邮箱 ‘用户名’ –description=’简单描述’</p>
</blockquote>
<p>完整命令如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod trunk register veryitman@126.com &apos;veryitman&apos; --description=&apos;mark&apos;</div></pre></td></tr></table></figure>
<p>2.打开邮箱, 激活邮件, 点击链接激活即可.</p>
<p>3.检查注册信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod trunk me</div></pre></td></tr></table></figure>
<p>4.添加到 cocoapods</p>
<p>执行下面命令, 即可.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod trunk push MZInsetLabel.podspec</div></pre></td></tr></table></figure>
<p>成功的效果图:</p>
<p><img src="/upload/images/2016/11/1/3.jpg" alt="1"></p>
<p><img src="/upload/images/2016/11/1/4.png" alt="1"></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>1.检查是否可以搜索到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod search MZInsetLabel</div></pre></td></tr></table></figure>
<p>如果搜索不到, 请执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod setup</div></pre></td></tr></table></figure>
<p>2.在项目中可以使用该项目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod &apos;MZInsetLabel&apos;, &apos;~&gt; 0.1.0&apos;</div></pre></td></tr></table></figure>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>可能遇到的麻烦</p>
<p>1.执行 pod trunk push MZInsetLabel.podspec 时, 好久没反应?</p>
<blockquote>
<p>这种情况, 大多数都是因为你的网络不给力造成的, 如果你确定你的网络没问题, 那么请翻墙.</p>
</blockquote>
<p>2.执 行 pod trunk push MZInsetLabel.podspec 时报错?</p>
<p>报错信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ERROR | [iOS] unknown: Encountered an unknown error (Simulator iPhone 4s is not available.) during validation.</div></pre></td></tr></table></figure>
<p>这个错误是因为, 更新了 xcode8 之后不再支持 ios7 的缘故.</p>
<p>解决方案(我的), 升级 cocoapods.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo gem install -n /usr/local/bin cocoapods</div></pre></td></tr></table></figure>
<p>3.pod trunk push 失败</p>
<p>失败提示信息类似:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Cloning into &apos;master&apos;...</div><div class="line">error: RPC failed; curl 56 SSLRead() return error -36</div><div class="line">fatal: The remote end hung up unexpectedly</div><div class="line">fatal: early EOF</div><div class="line">fatal: index-pack failed</div></pre></td></tr></table></figure>
<p>解决方案: 更新 gem</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo gem update --system</div></pre></td></tr></table></figure>
<h2 id="其他操作"><a href="#其他操作" class="headerlink" title="其他操作"></a>其他操作</h2><p>1.删除远程 Tag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git push --delete origin [TagName]</div></pre></td></tr></table></figure>
<p>如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git push --delete origin 0.10.0</div></pre></td></tr></table></figure>
<blockquote>
<p>在 github 上面如果你不小心打错了 Release, 然后删除该 Release.<br>你会发现, tag 无法删除.使用上面方式妥妥的解决.</p>
</blockquote>
<p>2.删除本地 Tag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git tag --delete [TagName]</div></pre></td></tr></table></figure>
<p>如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git tag --delete 0.10.0</div></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> iOS cocoapods </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS: 谈谈 frame 和 bounds]]></title>
      <url>/2016/10/22/iOS-%E8%B0%88%E8%B0%88-frame-%E5%92%8C-bounds/</url>
      <content type="html"><![CDATA[<h2 id="事情的起因"><a href="#事情的起因" class="headerlink" title="事情的起因"></a>事情的起因</h2><p>大家知道, 我们可以设置 view 的四个角或者其中一个或者几个为圆角.</p>
<p>使用的方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">+ (instancetype)bezierPathWithRoundedRect:(CGRect)rect byRoundingCorners:(UIRectCorner)corners cornerRadii:(CGSize)cornerRadii;</div><div class="line">storyboard</div></pre></td></tr></table></figure>
<p>拖好界面元素之后, 在代码中来修改其为圆角, 居然失败了.</p>
<p>想要的效果是这样的:<br><img src="/upload/images/2016/10/23/02.png" alt="1"></p>
<p>但是最终是这样的:<br><img src="/upload/images/2016/10/23/01.png" alt="1"></p>
<p>于是总结了一下, 分享给大家.</p>
<h2 id="设置圆角"><a href="#设置圆角" class="headerlink" title="设置圆角"></a>设置圆角</h2><p>这里分两种情况.</p>
<h3 id="第一种-只放置控件-不设置约束"><a href="#第一种-只放置控件-不设置约束" class="headerlink" title="第一种: 只放置控件, 不设置约束."></a>第一种: 只放置控件, 不设置约束.</h3><p>1.storyboard 中拖好控件.</p>
<p>注意: 这里我并没有设置任何约束.</p>
<p>2.vc 代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">@interface ViewController ()</div><div class="line">@property (strong, nonatomic) IBOutlet UILabel *lb;</div><div class="line">@end</div><div class="line">@implementation ViewController</div><div class="line">- (void)viewDidLoad</div><div class="line">&#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    </div><div class="line">    [self changeLbCorner];</div><div class="line">&#125;</div><div class="line">- (void)changeLbCorner</div><div class="line">&#123;</div><div class="line">   UIBezierPath *maskPath = [UIBezierPath bezierPathWithRoundedRect:self.lb.frame</div><div class="line">                                                  byRoundingCorners:UIRectCornerTopRight|UIRectCornerBottomRight</div><div class="line">                                                        cornerRadii:CGSizeMake(7, 7)];</div><div class="line">   CAShapeLayer *maskLayer = [[CAShapeLayer alloc] init];</div><div class="line">   maskLayer.frame = _lb.bounds;</div><div class="line">   maskLayer.path = maskPath.CGPath;</div><div class="line">   self.lb.layer.mask  = maskLayer;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>代码编译运行到模拟器(iphone6), 看不到任何东西.</p>
<p>log 日志显示 lb 的信息如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[ViewController viewDidLoad]:</div><div class="line">lb.bounds: &#123;&#123;0, 0&#125;, &#123;136, 39&#125;&#125; </div><div class="line">lb.frame: &#123;&#123;39, 89&#125;, &#123;136, 39&#125;&#125;</div></pre></td></tr></table></figure>
<p>位置信息是正确的, 咨询检查发现是参数传入错误, 修改 changeLbCorner 方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (void)changeLbCorner</div><div class="line">&#123;</div><div class="line">    UIBezierPath *maskPath = [UIBezierPath bezierPathWithRoundedRect:self.lb.bounds</div><div class="line">                                                   byRoundingCorners:UIRectCornerTopRight|UIRectCornerBottomRight</div><div class="line">                                                         cornerRadii:CGSizeMake(7, 7)];</div><div class="line">    CAShapeLayer *maskLayer = [[CAShapeLayer alloc] init];</div><div class="line">    maskLayer.frame = _lb.bounds;</div><div class="line">    maskLayer.path = maskPath.CGPath;</div><div class="line">    self.lb.layer.mask  = maskLayer;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里只是将 self.lb.frame 改为了 self.lb.bounds.</p>
<p>再次运行可以看到效果:<br><img src="/upload/images/2016/10/23/02.png" alt="1"></p>
<h3 id="第二种-放置控件并设置约束"><a href="#第二种-放置控件并设置约束" class="headerlink" title="第二种: 放置控件并设置约束."></a>第二种: 放置控件并设置约束.</h3><p>1.设置 lb 距离父 view 左边和上边的约束.<br>2.运行上面的代码, 发现, lb 并没有被设置为圆角.<br>并且 lb 的宽度和高度变小了, 变成了文字的实际的宽高.<br><img src="/upload/images/2016/10/23/04.png" alt="1"></p>
<p>看 log:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[ViewController viewDidLoad]:</div><div class="line">lb.bounds: &#123;&#123;0, 0&#125;, &#123;136, 39&#125;&#125; </div><div class="line">lb.frame: &#123;&#123;39, 89&#125;, &#123;136, 39&#125;&#125;</div></pre></td></tr></table></figure>
<p>其实这个时候, (从上面图中可以看出) 这里的信息是错误的.<br>正确的信息应该是这样的(viewDidAppear 函数)打印信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[ViewController viewDidAppear]:</div><div class="line">lb.bounds: &#123;&#123;0, 0&#125;, &#123;58.5, 19.5&#125;&#125; </div><div class="line">lb.frame: &#123;&#123;39, 89&#125;, &#123;58.5, 19.5&#125;&#125;</div></pre></td></tr></table></figure>
<p>于是, 将</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[self changeLbCorner];</div></pre></td></tr></table></figure>
<p>放到 viewDidAppear 中, 圆角就正常了.</p>
<p>接下来, 我们把 lb 的宽高(136*39)约束也加上.</p>
<p>看一下, viewDidLoad 和 viewDidAppear 方法中打印的信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[ViewController viewDidLoad]</div><div class="line">lb.bounds: &#123;&#123;0, 0&#125;, &#123;1000, 1000&#125;&#125; </div><div class="line">lb.frame: &#123;&#123;0, 0&#125;, &#123;1000, 1000&#125;&#125;</div><div class="line">[ViewController viewDidAppear:]</div><div class="line">lb.bounds: &#123;&#123;0, 0&#125;, &#123;136, 39&#125;&#125; </div><div class="line">lb.frame: &#123;&#123;39, 89&#125;, &#123;136, 39&#125;&#125;</div></pre></td></tr></table></figure>
<p>可以看出, viewDidLoad 中错的一塌糊涂.</p>
<p>这里也说明一个问题:</p>
<blockquote>
<p>xib 或者 storyboard 中设置过约束(现实开发中, 基本都会设置约束)的组件, 在 viewDidLoad 中并没有完全 layout, 只是预加载了这些组件.<br>想获取组件如 frame 何 bounds 信息, 在 viewDidLoad 中是不合适甚至是错误的.</p>
</blockquote>
<p>那么, 问题来了, 哪里合适哪里正确.</p>
<p>上面如果你认真看了, 在 viewDidAppear 中是可以正确获取的, 那么还有没有其他方法可以获取呢?</p>
<h2 id="VC-生命周期函数"><a href="#VC-生命周期函数" class="headerlink" title="VC 生命周期函数"></a>VC 生命周期函数</h2><p>要回答上面的问题, 大家要知道 vc 的生命周期函数.</p>
<p>上面的例子, 可以看出:</p>
<p>当函数 ViewDidLoad 被调用的时候，IBQutlets 已经被连接，但View 还没有被加载出来，无法获取 frame 等信息.<br>可以在 viewDidLoad 中完成在 IB 中不能完成的 view 的自定义。</p>
<p>关于 loadView 和 viewDidLoad 在后面博客跟大家分享.</p>
<p>今天要说的是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">viewDidLayoutSubviews</div></pre></td></tr></table></figure>
<p>viewDidLayoutSubviews 在 VC 子视图位置或者尺寸 (position|size) 被改变的时候被调用.</p>
<p>直到 Auto Layout 已经完成工作的时候才会被确定，所以在执行完 Auto Layout 之后会调用此方法。换句话说, view 的 frame 和 bounds 这个时候是正确可以获取的.</p>
<p>viewDidLayoutSubviews 这个方法在 ViewDidAppear 之前被调用, 有可能会被调用多次.</p>
<p>即依赖 bounds或者 frame 的操作，都应该放在viewDidLayoutSubviews 中，而不是 viewDidLoad 或viewWillAppear 中.</p>
<p>改变后的代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line">#define MZLog(fmt, ...) NSLog((@&quot;%s\n&quot; fmt), __FUNCTION__, ##__VA_ARGS__)</div><div class="line">#define MZLogLbInfo \</div><div class="line">MZLog(@&quot;lb.bounds: %@ \nlb.frame: %@&quot;, NSStringFromCGRect(self.lb.bounds), NSStringFromCGRect(self.lb.frame))</div><div class="line">@interface ViewController ()</div><div class="line">@property (strong, nonatomic) IBOutlet UILabel *lb;</div><div class="line">@property (strong, nonatomic) IBOutlet UILabel *displayedText;</div><div class="line">@end</div><div class="line">@implementation ViewController</div><div class="line">- (void)viewDidLoad</div><div class="line">&#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    </div><div class="line">    MZLogLbInfo;</div><div class="line">&#125;</div><div class="line">- (void)viewWillAppear:(BOOL)animated</div><div class="line">&#123;</div><div class="line">    [super viewWillAppear:animated];</div><div class="line">    </div><div class="line">    MZLogLbInfo;</div><div class="line">&#125;</div><div class="line">- (void)viewWillLayoutSubviews</div><div class="line">&#123;</div><div class="line">    [super viewWillLayoutSubviews];</div><div class="line">    </div><div class="line">    MZLogLbInfo;</div><div class="line">&#125;</div><div class="line">- (void)viewDidLayoutSubviews</div><div class="line">&#123;</div><div class="line">    [super viewDidLayoutSubviews];</div><div class="line">    </div><div class="line">    MZLogLbInfo;</div><div class="line">    </div><div class="line">    [self changeLbCorner];</div><div class="line">&#125;</div><div class="line">- (void)viewDidAppear:(BOOL)animated</div><div class="line">&#123;</div><div class="line">    [super viewDidAppear:animated];</div><div class="line">    </div><div class="line">    MZLogLbInfo;</div><div class="line">&#125;</div><div class="line">#pragma mark Callback.</div><div class="line">- (void)changeLbCorner</div><div class="line">&#123;</div><div class="line">    UIBezierPath *maskPath = [UIBezierPath bezierPathWithRoundedRect:self.lb.bounds</div><div class="line">                                                   byRoundingCorners:UIRectCornerTopRight|UIRectCornerBottomRight</div><div class="line">                                                         cornerRadii:CGSizeMake(7, 7)];</div><div class="line">    CAShapeLayer *maskLayer = [[CAShapeLayer alloc] init];</div><div class="line">    maskLayer.frame = _lb.bounds;</div><div class="line">    maskLayer.path = maskPath.CGPath;</div><div class="line">    self.lb.layer.mask  = maskLayer;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>打印的 log 如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[ViewController viewDidLoad]</div><div class="line">lb.bounds: &#123;&#123;0, 0&#125;, &#123;1000, 1000&#125;&#125; </div><div class="line">lb.frame: &#123;&#123;0, 0&#125;, &#123;1000, 1000&#125;&#125;</div><div class="line">[ViewController viewWillAppear:]</div><div class="line">lb.bounds: &#123;&#123;0, 0&#125;, &#123;1000, 1000&#125;&#125; </div><div class="line">lb.frame: &#123;&#123;0, 0&#125;, &#123;1000, 1000&#125;&#125;</div><div class="line">[ViewController viewWillLayoutSubviews]</div><div class="line">lb.bounds: &#123;&#123;0, 0&#125;, &#123;1000, 1000&#125;&#125; </div><div class="line">lb.frame: &#123;&#123;0, 0&#125;, &#123;1000, 1000&#125;&#125;</div><div class="line">[ViewController viewDidLayoutSubviews]</div><div class="line">lb.bounds: &#123;&#123;0, 0&#125;, &#123;136, 39&#125;&#125; </div><div class="line">lb.frame: &#123;&#123;39, 89&#125;, &#123;136, 39&#125;&#125;</div><div class="line">[ViewController viewWillLayoutSubviews]</div><div class="line">lb.bounds: &#123;&#123;0, 0&#125;, &#123;136, 39&#125;&#125; </div><div class="line">lb.frame: &#123;&#123;39, 89&#125;, &#123;136, 39&#125;&#125;</div><div class="line">[ViewController viewDidLayoutSubviews]</div><div class="line">lb.bounds: &#123;&#123;0, 0&#125;, &#123;136, 39&#125;&#125; </div><div class="line">lb.frame: &#123;&#123;39, 89&#125;, &#123;136, 39&#125;&#125;</div><div class="line">[ViewController viewDidAppear:]</div><div class="line">lb.bounds: &#123;&#123;0, 0&#125;, &#123;136, 39&#125;&#125; </div><div class="line">lb.frame: &#123;&#123;39, 89&#125;, &#123;136, 39&#125;&#125;</div></pre></td></tr></table></figure>
<h2 id="开始-frame-和-bounds"><a href="#开始-frame-和-bounds" class="headerlink" title="开始 frame 和 bounds"></a>开始 frame 和 bounds</h2><p>上面的例子, 大家看到由于传入了 frame 而不是 bounds 造成设置圆角失败.</p>
<p>下面说说 frame 和 bounds.</p>
<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>从网上”偷”过来的图</p>
<p><img src="/upload/images/2016/10/23/03.jpg" alt="1"></p>
<h4 id="1-frame"><a href="#1-frame" class="headerlink" title="1.frame"></a>1.frame</h4><p>该 view 在父 view 坐标系统中的位置和大小(参照点是，父坐标系统).</p>
<h4 id="2-bounds"><a href="#2-bounds" class="headerlink" title="2.bounds"></a>2.bounds</h4><p>该 view 在本地坐标系统中的位置和大小(参照点是，本地坐标系统，就相当于 view 自己的坐标系统，以(0,0)点为起点).<br>其实本地坐标系统的关键就是要知道的它的原点(0,0).</p>
<p>bounds 默认值是(0, 0, width, height).除非手动改变 bounds 的值.</p>
<p>单纯的从概念上面, 很难理解二者的区别.</p>
<p>提供一个例子, 例子大概是这样的:<br>redView 是 yellowView 的父视图, yellowView 是 blueView 的父视图.</p>
<p>通过改变 redView 的 bounds 会影响子视图的位置(不是frame).<br>将 redView 的 bounds 起点设为(-20, -20), 子视图相对于 redView 的本地坐标(0, 0), 也就需要往下增加20, 这样, yellowView 就往下移动了.</p>
<h3 id="效果图"><a href="#效果图" class="headerlink" title="效果图:"></a>效果图:</h3><p><img src="/upload/images/2016/10/23/05.png" alt="1"></p>
<p><img src="/upload/images/2016/10/23/06.png" alt="1"></p>
<p><img src="/upload/images/2016/10/23/07.png" alt="1"></p>
<h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line">#define MZLog(fmt, ...) NSLog((@&quot;%s\n&quot; fmt), __FUNCTION__, ##__VA_ARGS__)</div><div class="line">#define MZLogLbInfo \</div><div class="line">MZLog(@&quot;lb.bounds: %@ \nlb.frame: %@&quot;, NSStringFromCGRect(self.lb.bounds), NSStringFromCGRect(self.lb.frame))</div><div class="line">@interface ViewController ()</div><div class="line">@property (strong, nonatomic) IBOutlet UILabel *lb;</div><div class="line">@property (strong, nonatomic) IBOutlet UILabel *displayedText;</div><div class="line">@end</div><div class="line">@implementation ViewController</div><div class="line">&#123;</div><div class="line">    UIView *redView;</div><div class="line">    UIView *yellowView;</div><div class="line">    UIView *blueView;</div><div class="line">&#125;</div><div class="line">- (void)viewDidLoad</div><div class="line">&#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    </div><div class="line">    MZLogLbInfo;</div><div class="line">    </div><div class="line">    </div><div class="line">    // 将 redView 添加到 self.view</div><div class="line">    &#123;</div><div class="line">        redView = [[UIView alloc] initWithFrame:CGRectMake(100, 200, 120, 120)];</div><div class="line">        redView.backgroundColor = [UIColor redColor];</div><div class="line">        [self.view addSubview:redView];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // 将 yellowView 添加到 redView</div><div class="line">    &#123;</div><div class="line">        yellowView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 90, 90)];</div><div class="line">        yellowView.backgroundColor = [UIColor yellowColor];</div><div class="line">        [redView addSubview:yellowView];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // 将 blueView 添加到 yellowView</div><div class="line">    &#123;</div><div class="line">        blueView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 60, 60)];</div><div class="line">        blueView.backgroundColor = [UIColor blueColor];</div><div class="line">        [yellowView addSubview:blueView];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    [self logViewInfo];</div><div class="line">&#125;</div><div class="line">- (void)viewWillAppear:(BOOL)animated</div><div class="line">&#123;</div><div class="line">    [super viewWillAppear:animated];</div><div class="line">    </div><div class="line">    MZLogLbInfo;</div><div class="line">&#125;</div><div class="line">- (void)viewWillLayoutSubviews</div><div class="line">&#123;</div><div class="line">    [super viewWillLayoutSubviews];</div><div class="line">    </div><div class="line">    MZLogLbInfo;</div><div class="line">&#125;</div><div class="line">- (void)viewDidLayoutSubviews</div><div class="line">&#123;</div><div class="line">    [super viewDidLayoutSubviews];</div><div class="line">    </div><div class="line">    MZLogLbInfo;</div><div class="line">    </div><div class="line">    [self changeLbCorner];</div><div class="line">&#125;</div><div class="line">- (void)viewDidAppear:(BOOL)animated</div><div class="line">&#123;</div><div class="line">    [super viewDidAppear:animated];</div><div class="line">    </div><div class="line">    MZLogLbInfo;</div><div class="line">&#125;</div><div class="line">#pragma mark Callback.</div><div class="line">- (void)changeLbCorner</div><div class="line">&#123;</div><div class="line">    UIBezierPath *maskPath = [UIBezierPath bezierPathWithRoundedRect:self.lb.bounds</div><div class="line">                                                   byRoundingCorners:UIRectCornerTopRight|UIRectCornerBottomRight</div><div class="line">                                                         cornerRadii:CGSizeMake(7, 7)];</div><div class="line">    CAShapeLayer *maskLayer = [[CAShapeLayer alloc] init];</div><div class="line">    maskLayer.frame = _lb.bounds;</div><div class="line">    maskLayer.path = maskPath.CGPath;</div><div class="line">    self.lb.layer.mask  = maskLayer;</div><div class="line">&#125;</div><div class="line">- (IBAction)doResetAction:(id)sender</div><div class="line">&#123;</div><div class="line">    [UIView animateWithDuration:1.0f animations:^&#123;</div><div class="line">        [redView setBounds:CGRectMake(0, 0, 120, 120)];</div><div class="line">        [yellowView setBounds:CGRectMake(0, 0, 90, 90)];</div><div class="line">    &#125; completion:^(BOOL finished) &#123;</div><div class="line">        [self logViewInfo];</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line">- (IBAction)doChangeRedViewBounds:(id)sender</div><div class="line">&#123;</div><div class="line">    [UIView animateWithDuration:1.0f animations:^&#123;</div><div class="line">        [redView setBounds:CGRectMake(-20, -20, 120, 120)];</div><div class="line">    &#125; completion:^(BOOL finished) &#123;</div><div class="line">        [self logViewInfo];</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line">- (IBAction)doChangeYellowViewBounds:(id)sender</div><div class="line">&#123;</div><div class="line">    [UIView animateWithDuration:1.0f animations:^&#123;</div><div class="line">        [yellowView setBounds:CGRectMake(-20, -20, 90, 90)];</div><div class="line">    &#125; completion:^(BOOL finished) &#123;</div><div class="line">        [self logViewInfo];</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line">#pragma mark Display Debug Info.</div><div class="line">- (void)logViewInfo</div><div class="line">&#123;</div><div class="line">    NSString *log4rView = [NSString stringWithFormat:@&quot;RedView\nframe:%@ \nbounds:%@&quot;,</div><div class="line">                           NSStringFromCGRect(redView.frame), NSStringFromCGRect(redView.bounds)];</div><div class="line">    NSString *log4yView = [NSString stringWithFormat:@&quot;YellowView\nframe:%@ \nbounds:%@&quot;,</div><div class="line">                           NSStringFromCGRect(yellowView.frame), NSStringFromCGRect(yellowView.bounds)];</div><div class="line">    NSString *log4bView = [NSString stringWithFormat:@&quot;BlueView\nframe:%@ \nbounds:%@&quot;,</div><div class="line">                           NSStringFromCGRect(blueView.frame), NSStringFromCGRect(blueView.bounds)];</div><div class="line">    </div><div class="line">    NSString *log = [NSString stringWithFormat:@&quot;%@\n%@\n%@&quot;, log4rView, log4yView, log4bView];</div><div class="line">    [self display:log];</div><div class="line">&#125;</div><div class="line">- (void)display:(NSString *)content</div><div class="line">&#123;</div><div class="line">    self.displayedText.text = content;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>1.bounds 并不完全等同 frame.</p>
<p>2.改变 bounds 会影响子视图的位置(人眼看到其改变了位置), 设置 bounds 可以修改自己坐标系的原点位置.但是不会改变子视图的 bounds 和 frame.</p>
<p>补充:<br>明白上面的道理很重要, iOS 中滚动视图能让你看到其中的内容, 正是利用了 contentoffset 和 bounds 属性.</p>
<p>这里以 tableView 为例子, 当我们向上滚动 tableView, tableView 的 contentOffset 和 bounds 的坐标都是正数, 相当于其本地坐标(0, 0)改变了即增加了(坐标系往下为增加), 那么其子视图就会向上去.</p>
<p>向下滑动时, 也是同一个道理.<br>可以通过运行 完整 Demo 中[查看 TableView]按钮来打开例子, 看日志.</p>
<p>3.改变子视图所有父视图的 bounds, 子视图的位置是累加改变的.<br>如上面改变 redView 和 yellowView 的 bounds, blueView 的位置相对 redView 往下移动了40.</p>
<p>4.当同一个视图的 bounds 大于 frame, 会导致 frame 被撑大，frame 的 x, y, width, height 都会被改变. 反之, bounds 小于 frame, frame 也会变小.</p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><ol>
<li><p>GitHub 上面可以 下载完整 <a href="https://github.com/veryitman/iOSDemo/tree/master/na" target="_blank" rel="noopener">Demo</a></p>
</li>
<li><p>推荐博文: <a href="http://blog.csdn.net/veryitman/article/details/51622235" target="_blank" rel="noopener">iOS UI 技巧: 视图无法被点击
</a></p>
</li>
</ol>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> iOS frame bounds </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[RN: 模拟 Mobx]]></title>
      <url>/2016/10/11/RN-%E6%A8%A1%E6%8B%9F-Mobx/</url>
      <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>看过 [React Native 使用 Mobx] 这篇博客的同学, 对 Mobx 应该有了一个简单直观的认识.</p>
<p>其实, 我们完全可以使用 RN 中的 State 来达到同样的效果.</p>
<p>今天的主要内容是使用 State 来模拟 Mobx, 也算是对 Mobx 的进一步认识.</p>
<p>效果</p>
<p>实现效果和 [React Native 使用 Mobx] 中的效果一致, 只是代码没有使用 Mobx 框架.</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="LegacyCounter-js"><a href="#LegacyCounter-js" class="headerlink" title="LegacyCounter.js"></a>LegacyCounter.js</h3><blockquote>
<p>Add 和 Minus 两个按钮分别触发各自的回调, 来更新 state.<br>使用 state 的变化来到达更新 View (计数的 Text 会相应的做出变化)的目的.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 模拟 Mobx 在 ReactNative 上的一个小例子.</div><div class="line"> * </div><div class="line"> * state -&gt; view</div><div class="line"> */</div><div class="line">&apos;use strict&apos;;</div><div class="line">import React, &#123; Component &#125; from &apos;react&apos;;</div><div class="line">import &#123;</div><div class="line">  StyleSheet,</div><div class="line">  View,</div><div class="line">  Text,</div><div class="line">  TouchableHighlight</div><div class="line">&#125; from &apos;react-native&apos;;</div><div class="line">class LegacyCounter extends Component &#123;</div><div class="line">    //构造方法</div><div class="line">    constructor(props) &#123;</div><div class="line">        super(props);</div><div class="line">    </div><div class="line">        this.state = &#123;</div><div class="line">            //计数</div><div class="line">            counter: 0</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">    render () &#123;</div><div class="line">        return (</div><div class="line">          &lt;View style = &#123;styles.container&#125;&gt;</div><div class="line">            &#123;/*加一*/&#125;</div><div class="line">            &lt;TouchableHighlight</div><div class="line">                onPress = &#123;() =&gt; &#123;this.setState(&#123;</div><div class="line">                    counter: ++this.state.counter</div><div class="line">                &#125;)&#125;&#125;&gt;</div><div class="line">                &lt;Text&gt;Add&lt;/Text&gt;</div><div class="line">            &lt;/TouchableHighlight&gt;</div><div class="line">            &#123;/* 显示处理结果 */&#125;</div><div class="line">            &lt;Text style = &#123;styles.resultTxtStyle&#125;&gt;</div><div class="line">            &#123;this.state.counter&#125;</div><div class="line">            &lt;/Text&gt;</div><div class="line">            &#123;/*减一*/&#125;</div><div class="line">            &lt;TouchableHighlight </div><div class="line">                onPress = &#123;() =&gt; &#123;this.setState(&#123;</div><div class="line">                    counter: --this.state.counter</div><div class="line">                &#125;)&#125;&#125;&gt;</div><div class="line">                &lt;Text&gt;Minus&lt;/Text&gt;</div><div class="line">            &lt;/TouchableHighlight&gt;</div><div class="line">          &lt;/View&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">export default class LegacyComponent extends Component &#123;</div><div class="line">    render () &#123;</div><div class="line">        return (</div><div class="line">            &lt;View style = &#123;&#123;flex: 1, marginTop: 64&#125;&#125;&gt;</div><div class="line">            </div><div class="line">                &lt;LegacyCounter/&gt;</div><div class="line">            &lt;/View&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">/* 样式定义 */</div><div class="line">const styles = StyleSheet.create(&#123;</div><div class="line">    container: &#123;</div><div class="line">        flexDirection: &apos;row&apos;,</div><div class="line">        justifyContent: &apos;space-around&apos;</div><div class="line">    &#125;,</div><div class="line">    resultTxtStyle: &#123;</div><div class="line">        fontSize: 22, </div><div class="line">        color: &apos;red&apos;</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="index-ios-js"><a href="#index-ios-js" class="headerlink" title="index.ios.js"></a>index.ios.js</h3><blockquote>
<p>这个文件很简单, 只是调用 LegacyCounter 中的组件.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">import React, &#123; Component &#125; from &apos;react&apos;;</div><div class="line">//引入自定义模块</div><div class="line">import LegacyComponent from &apos;./js/Mobx/LegacyCounter&apos;</div><div class="line">import &#123;</div><div class="line">  AppRegistry</div><div class="line">&#125; from &apos;react-native&apos;;</div><div class="line">class RNMobxDemo extends Component &#123;</div><div class="line">    render() &#123;</div><div class="line">        return(</div><div class="line">            &lt;LegacyComponent/&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">AppRegistry.registerComponent(&apos;RNMobxDemo&apos;, () =&gt; MZRNTutorial);</div></pre></td></tr></table></figure>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>如果你想了解更多关于 RN 中 State 的知识, 请移步官方文档查阅 State 的用法.</p>
<p>后续会给大家带来更多关于 RN 这些方面的东西.</p>
]]></content>
      
        <categories>
            
            <category> ReactNative </category>
            
        </categories>
        
        
        <tags>
            
            <tag> iOS Android ReactNative </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[RN: 使用 Mobx]]></title>
      <url>/2016/10/06/RN-%E4%BD%BF%E7%94%A8-Mobx/</url>
      <content type="html"><![CDATA[<h2 id="来由"><a href="#来由" class="headerlink" title="来由"></a>来由</h2><p>在 <a href="https://jsfiddle.net/24u7juu0/" target="_blank" rel="noopener">JSFiddler</a> 上面看到 React 结合 Mobx 的一个小例子.</p>
<p>爱不释手, 遂拿来改造一下, 让其能在 RN 上面一展雄风.</p>
<p>之前听过 Mobx, 说是要替代 Redux, 反正我是不知道这些东东, 第一次听说没有什么感觉!<br>如今又再次偶遇 Mobx, 决定认真学习一下它.</p>
<h2 id="Mobx-简介"><a href="#Mobx-简介" class="headerlink" title="Mobx 简介"></a>Mobx 简介</h2><p>Mobx 的 <a href="https://github.com/mobxjs/mobx" target="_blank" rel="noopener">github</a> 地址.<br>目前关于他和 React Native 的(中文)资料不多, 大多数是关于 React 的.</p>
<p>看来想学好 React Native, 还是要做好 React 的功课呀!</p>
<p>官网给了一个 Mobx 的图:<br><img src="/upload/images/2016/10/08/rn_mobx_ef4.png" alt="1"></p>
<p>我也是刚接触这个「牛逼闪闪」的 Mobx, 共勉!</p>
<h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p>今天的例子很简单, 效果图如下<br><img src="/upload/images/2016/10/08/rn_mobx_ef1.png" alt="1"></p>
<p>点击 Add<br><img src="/upload/images/2016/10/08/rn_mobx_ef3.png" alt="1"></p>
<p>点击 Minus<br><img src="/upload/images/2016/10/08/rn_mobx_ef2.png" alt="1"></p>
<p>下面具体说说如何搞定这个 Demo.</p>
<h2 id="准备「材料」"><a href="#准备「材料」" class="headerlink" title="准备「材料」"></a>准备「材料」</h2><p>这里假设你已经具备 React Native 的基本开发环境, 至少成功运行过一次 React Native 的程序.</p>
<h3 id="1-创建-React-Native-项目"><a href="#1-创建-React-Native-项目" class="headerlink" title="1.创建 React Native 项目"></a>1.创建 React Native 项目</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">react-native init RNMobxDemo</div></pre></td></tr></table></figure>
<p>你也可以给你的工程取一个你喜欢的名字.<br>这里姑且称之为 RNMobxDemo</p>
<h3 id="2-安装-mobx-和-mobx-react"><a href="#2-安装-mobx-和-mobx-react" class="headerlink" title="2.安装 mobx 和 mobx-react"></a>2.安装 mobx 和 mobx-react</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i mobx mobx-react --save</div></pre></td></tr></table></figure>
<h3 id="3-Counter-js"><a href="#3-Counter-js" class="headerlink" title="3.Counter.js"></a>3.Counter.js</h3><blockquote>
<p>该文件使用了 mobx 和 mobx-react 的组件.</p>
</blockquote>
<p>具体代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line">&apos;use strict&apos;;</div><div class="line">import React, &#123; Component &#125; from &apos;react&apos;;</div><div class="line">import &#123;</div><div class="line">  StyleSheet,</div><div class="line">  View,</div><div class="line">  Text,</div><div class="line">  TouchableHighlight</div><div class="line">&#125; from &apos;react-native&apos;;</div><div class="line">import &#123; observer &#125; from &apos;mobx-react/native&apos;;</div><div class="line">import &#123; observable &#125; from &apos;mobx&apos;;</div><div class="line">// 被观察者, 观察 counter 变量  </div><div class="line">const storer = observable(&#123;</div><div class="line">    counter: 0</div><div class="line">&#125;);</div><div class="line">//---------------------------------</div><div class="line">//  ES6 写法: Arrow Function</div><div class="line">//---------------------------------</div><div class="line">storer.plus =  () =&gt; &#123;</div><div class="line">    storer.counter ++;</div><div class="line">&#125;;</div><div class="line">storer.minus = () =&gt; &#123;</div><div class="line">    storer.counter --;</div><div class="line">&#125;;</div><div class="line">class Counter extends Component &#123;</div><div class="line">    render () &#123;</div><div class="line">        return (</div><div class="line">          &lt;View style = &#123;styles.container&#125;&gt;</div><div class="line">            &#123;/*加一*/&#125;</div><div class="line">            &lt;TouchableHighlight</div><div class="line">                onPress = &#123;() =&gt; &#123;this.props.store.plus()&#125;&#125;&gt;</div><div class="line">                &lt;Text&gt;Add&lt;/Text&gt;</div><div class="line">            &lt;/TouchableHighlight&gt;</div><div class="line">            &#123;/* 显示处理结果 */&#125;</div><div class="line">            &lt;Text style = &#123;styles.resultTxtStyle&#125;&gt;</div><div class="line">            &#123;this.props.store.counter&#125;</div><div class="line">            &lt;/Text&gt;</div><div class="line">            &#123;/*减一*/&#125;</div><div class="line">            &lt;TouchableHighlight </div><div class="line">                onPress = &#123;() =&gt; &#123;storer.minus()&#125;&#125;&gt;</div><div class="line">                &lt;Text&gt;Minus&lt;/Text&gt;</div><div class="line">            &lt;/TouchableHighlight&gt;</div><div class="line">          &lt;/View&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">// 使用 observer 创建</div><div class="line">const CounterComponent = observer(Counter);</div><div class="line">export default class ReactionsComponent extends Component &#123;</div><div class="line">    render () &#123;</div><div class="line">        return (</div><div class="line">            &lt;View style = &#123;&#123;flex: 1, marginTop: 64&#125;&#125;&gt;</div><div class="line">            </div><div class="line">                &lt;CounterComponent store = &#123;storer&#125; /&gt; </div><div class="line">            &lt;/View&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">/* 样式定义 */</div><div class="line">const styles = StyleSheet.create(&#123;</div><div class="line">    container: &#123;</div><div class="line">        flexDirection: &apos;row&apos;,</div><div class="line">        justifyContent: &apos;space-around&apos;</div><div class="line">    &#125;,</div><div class="line">    resultTxtStyle: &#123;</div><div class="line">        fontSize: 22, </div><div class="line">        color: &apos;red&apos;</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="4-index-ios-js"><a href="#4-index-ios-js" class="headerlink" title="4.index.ios.js"></a>4.index.ios.js</h3><blockquote>
<p>该文件使用自定义的组件 ReactionsComponent</p>
</blockquote>
<p>具体代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">import React, &#123; Component &#125; from &apos;react&apos;;</div><div class="line">//引入自定义模块</div><div class="line">import ReactionsComponent from &apos;./js/Mobx/Counter&apos;</div><div class="line">import &#123;</div><div class="line">  AppRegistry</div><div class="line">&#125; from &apos;react-native&apos;;</div><div class="line">class RNMobxDemo extends Component &#123;</div><div class="line">    render() &#123;</div><div class="line">        return(</div><div class="line">            &lt;ReactionsComponent/&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">AppRegistry.registerComponent(&apos;RNMobxDemo&apos;, () =&gt; MZRNTutorial);</div></pre></td></tr></table></figure>
<p>Mobx 支持「注解」.</p>
<p>这里的注解就是 ES7 中的 decorators (装饰者模式).</p>
<p>下面代码是使用注解的方式来声明, 但是你需要安装相关的插件(babel plugin)来支持.</p>
<p>安装该插件很简单, 在项目根目录按照下面步骤即可:</p>
<blockquote>
<p>Step 1: 创建 .babelrc 文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">touch .babelrc</div></pre></td></tr></table></figure>
<blockquote>
<p>Step 2: 编辑 .babelrc 文件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line"> &apos;presets&apos;: [&apos;react-native&apos;],</div><div class="line"> &apos;plugins&apos;: [&apos;transform-decorators-legacy&apos;]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>Step 3: 安装插件</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i babel-plugin-transform-decorators-legacy babel-preset-react-native-stage-0 --save-dev</div></pre></td></tr></table></figure>
<p>修改「Counter.js」, 代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line">&apos;use strict&apos;;</div><div class="line">import React, &#123; Component &#125; from &apos;react&apos;;</div><div class="line">import &#123;</div><div class="line">  StyleSheet,</div><div class="line">  View,</div><div class="line">  Text,</div><div class="line">  TouchableHighlight</div><div class="line">&#125; from &apos;react-native&apos;;</div><div class="line">import &#123; observer &#125; from &apos;mobx-react/native&apos;;</div><div class="line">import &#123; observable &#125; from &apos;mobx&apos;;</div><div class="line">// 被观察者, 观察 counter 变量  </div><div class="line">const storer = observable(&#123;</div><div class="line">    counter: 0</div><div class="line">&#125;);</div><div class="line">//---------------------------------</div><div class="line">//  ES6 写法: Arrow Function</div><div class="line">//---------------------------------</div><div class="line">storer.plus =  () =&gt; &#123;</div><div class="line">    storer.counter ++;</div><div class="line">&#125;;</div><div class="line">storer.minus = () =&gt; &#123;</div><div class="line">    storer.counter --;</div><div class="line">&#125;;</div><div class="line">@observer //使用@方式来前置声明</div><div class="line">class Counter extends Component &#123;</div><div class="line">    render () &#123;</div><div class="line">        return (</div><div class="line">          &lt;View style = &#123;styles.container&#125;&gt;</div><div class="line">            &#123;/*加一*/&#125;</div><div class="line">            &lt;TouchableHighlight</div><div class="line">                onPress = &#123;() =&gt; &#123;this.props.store.plus()&#125;&#125;&gt;</div><div class="line">                &lt;Text&gt;Add&lt;/Text&gt;</div><div class="line">            &lt;/TouchableHighlight&gt;</div><div class="line">            &#123;/* 显示处理结果 */&#125;</div><div class="line">            &lt;Text style = &#123;styles.resultTxtStyle&#125;&gt;</div><div class="line">            &#123;this.props.store.counter&#125;</div><div class="line">            &lt;/Text&gt;</div><div class="line">            &#123;/*减一*/&#125;</div><div class="line">            &lt;TouchableHighlight </div><div class="line">                onPress = &#123;() =&gt; &#123;storer.minus()&#125;&#125;&gt;</div><div class="line">                &lt;Text&gt;Minus&lt;/Text&gt;</div><div class="line">            &lt;/TouchableHighlight&gt;</div><div class="line">          &lt;/View&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">export default class ReactionsComponent extends Component &#123;</div><div class="line">    render () &#123;</div><div class="line">        return (</div><div class="line">            &lt;View style = &#123;&#123;flex: 1, marginTop: 64&#125;&#125;&gt;</div><div class="line">            </div><div class="line">                &lt;Counter store = &#123;storer&#125; /&gt;</div><div class="line">            &lt;/View&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">/* 样式定义 */</div><div class="line">const styles = StyleSheet.create(&#123;</div><div class="line">    container: &#123;</div><div class="line">        flexDirection: &apos;row&apos;,</div><div class="line">        justifyContent: &apos;space-around&apos;</div><div class="line">    &#125;,</div><div class="line">    resultTxtStyle: &#123;</div><div class="line">        fontSize: 22, </div><div class="line">        color: &apos;red&apos;</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>从例子可以看出, storer 相当于 state, 当 state 发生改变了, 视图 View 也跟着变化.<br>也就是状态驱动.</p>
<p>Android 开发的同学应该知道 Adapter 和 notifyDatasetChanged 的机制, 当数据源发生变化的时候, 可以通知视图进行刷新操作.</p>
<p>这里的 Mobx 也可以这么简单的理解.</p>
<p>Mobx 的强大之处还有很多, 需要慢慢学习和挖掘.</p>
]]></content>
      
        <categories>
            
            <category> ReactNative </category>
            
        </categories>
        
        
        <tags>
            
            <tag> iOS Android ReactNative </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[RN: 0.34 运行在 Android 的问题]]></title>
      <url>/2016/09/26/RN-0-34-%E8%BF%90%E8%A1%8C%E5%9C%A8-Android-%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<p>今天闲来无事, 想使用 RN 工程在 Android 设备上面跑跑.</p>
<p>想看看运行效果怎么样?!</p>
<h2 id="适合读者"><a href="#适合读者" class="headerlink" title="适合读者"></a>适合读者</h2><ul>
<li>有 Android 开发基础.</li>
<li>会使用 Android Studio.</li>
<li>初级 React Native 的开发者.</li>
</ul>
<h2 id="开发环境和工具"><a href="#开发环境和工具" class="headerlink" title="开发环境和工具"></a>开发环境和工具</h2><ul>
<li>Android Studio 2.2</li>
<li>ReactNative 0.34</li>
<li>Android 模拟器</li>
<li>Mac 操作系统</li>
</ul>
<h2 id="预期效果"><a href="#预期效果" class="headerlink" title="预期效果"></a>预期效果</h2><p>不出所料, 真的不能一帆风顺的 Run.</p>
<p>在我的博客 ReactNative: 不一样的 HelloWorld 中展示了 RN 在 iOS 上面的运行情况.</p>
<p>今天还是这个例子, 部署和运行到 Android 上面.</p>
<p>效果如下:<br><img src="/upload/images/2016/9/26/rn_and_eff_01.png" alt="1"></p>
<p>在这个过程中, 遇到几个问题.</p>
<p>特此记录.</p>
<h2 id="问题描述和解决"><a href="#问题描述和解决" class="headerlink" title="问题描述和解决"></a>问题描述和解决</h2><h3 id="问题1-直接运行-crash"><a href="#问题1-直接运行-crash" class="headerlink" title="问题1: 直接运行 crash"></a>问题1: 直接运行 crash</h3><p>log 描述(部分)</p>
<blockquote>
<p>E/AndroidRuntime: FATAL EXCEPTION: main<br>Process: com.mzrntutorial, PID: 5849<br>java.lang.RuntimeException:<br>Unable to start activity ComponentInfo{com.mzrntutorial/com.mzrntutorial.MainActivity}: java.lang.ClassCastException: android.app.Application cannot be cast to com.facebook.react.ReactApplication<br>at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2416)<br>at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2476)     </p>
</blockquote>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h3><p>Manifest.xml 配置 Application 名称</p>
<p>android:name=”.MainApplication”</p>
<h3 id="问题2"><a href="#问题2" class="headerlink" title="问题2:"></a>问题2:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">could not get batchedbridge make sure your bundle is packaged correctly</div></pre></td></tr></table></figure>
<p>解决问题1后, 再次运行, 会报问题2.<br>该问题是因为没有启动本地的 server.</p>
<p>使用 Xcode 可以自动运行本地 server.<br>可以参考博客 React Native 如何启动 local server</p>
<h3 id="解决方案-1"><a href="#解决方案-1" class="headerlink" title="解决方案:"></a>解决方案:</h3><p>手动启动 server.</p>
<p>cd 项目根目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">react-native start</div></pre></td></tr></table></figure>
<h3 id="问题3"><a href="#问题3" class="headerlink" title="问题3:"></a>问题3:</h3><blockquote>
<p>模拟器没有 menu 按键, 无法 Reload</p>
</blockquote>
<p>这个其实不是什么大问题, 但是对于初学者, 也算是一个问题.</p>
<p>新版的 Android SDK 创建的模拟器没有 menu 按键了</p>
<h3 id="解决方案-2"><a href="#解决方案-2" class="headerlink" title="解决方案:"></a>解决方案:</h3><p>连续按两次字母 r 即可刷新.</p>
<p>这些问题, FB 后面肯定会解决的.<br>阿门!</p>
<h2 id="附录-代码"><a href="#附录-代码" class="headerlink" title="附录(代码)"></a>附录(代码)</h2><p>index.ios.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div></pre></td><td class="code"><pre><div class="line">import React, &#123; Component &#125; from &apos;react&apos;;</div><div class="line">import &#123;getPlatformString, isIOS&#125; from &apos;./js/Generals/Utils/IDSRNPlatformUtil&apos;;</div><div class="line">import MZButton from &apos;./js/ReactUIKit/MZButton&apos;</div><div class="line">import &#123;</div><div class="line">  AppRegistry,</div><div class="line">  StyleSheet,</div><div class="line">  Text,</div><div class="line">  View,</div><div class="line">  Platform,</div><div class="line">  TouchableOpacity,</div><div class="line">  TouchableHighlight</div><div class="line">&#125; from &apos;react-native&apos;;</div><div class="line">// 调用其他模块方法</div><div class="line">var os = getPlatformString();</div><div class="line">var iosPlatform = isIOS();//when run on &apos;ios&apos; true</div><div class="line">class MZRNTutorial extends Component &#123;</div><div class="line">  constructor(props)</div><div class="line">  &#123;</div><div class="line">      super(props);</div><div class="line">      this.state = &#123;status:1&#125;;</div><div class="line">  &#125;</div><div class="line">  customPressHandler = () =&gt; &#123;</div><div class="line">      alert(&apos;当前状态: &apos; + this.state.status);</div><div class="line">      this.state.status = 2;</div><div class="line">  &#125;</div><div class="line">  render() &#123;</div><div class="line">    console.log(&apos;render ...&apos;);</div><div class="line">    return (</div><div class="line">      &lt;View style=&#123;styles.container&#125;&gt;</div><div class="line">        &lt;Text style=&#123;styles.welcome&#125;&gt;</div><div class="line">          Near use React Native!</div><div class="line">        &lt;/Text&gt;</div><div class="line">        &lt;Text style=&#123;styles.instructions&#125;&gt;</div><div class="line">          To get started, edit index.android.js</div><div class="line">        &lt;/Text&gt;</div><div class="line">        &lt;Text style=&#123;styles.instructions&#125;&gt;</div><div class="line">          Press &apos;R&apos; twice to reload,&#123;&apos;\n&apos;&#125;</div><div class="line">          or shake for dev menu</div><div class="line">        &lt;/Text&gt;</div><div class="line">        &#123;/* 显示当前平台信息*/&#125;</div><div class="line">        &lt;Text style=&#123;styles.welcome&#125;&gt;</div><div class="line">            current os: &#123;Platform.OS&#125;</div><div class="line">        &lt;/Text&gt;</div><div class="line">        &#123;/*</div><div class="line">        &lt;TouchableOpacity</div><div class="line">            style=&#123;styles.button&#125;</div><div class="line">            onPress=&#123;this.customPressHandler&#125;</div><div class="line">            &gt;</div><div class="line">            &lt;Text style=&#123;styles.buttonText&#125;&gt;确定&lt;/Text&gt;</div><div class="line">        &lt;/TouchableOpacity&gt;</div><div class="line">        */&#125;</div><div class="line">        &lt;MZButton text=&quot;确定?&quot; bgColor=&quot;green&quot; dianjishijian=&#123;()=&gt;&#123;alert(&apos;居然点击确定?!&apos;)&#125;&#125;&gt;</div><div class="line">        &lt;/MZButton&gt;</div><div class="line">      &lt;/View&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">const styles = StyleSheet.create(&#123;</div><div class="line">  button: &#123;</div><div class="line">    height: 40,</div><div class="line">    width: 150,</div><div class="line">    borderRadius: 20,</div><div class="line">    justifyContent: &apos;center&apos;,</div><div class="line">    backgroundColor: &apos;green&apos;,</div><div class="line">    overflow: &apos;hidden&apos;</div><div class="line">  &#125;,</div><div class="line">  buttonText: &#123;</div><div class="line">    textAlign: &apos;center&apos;,</div><div class="line">    color: &apos;white&apos;</div><div class="line">  &#125;,</div><div class="line">  container: &#123;</div><div class="line">    flex: 1,</div><div class="line">    justifyContent: &apos;center&apos;,</div><div class="line">    alignItems: &apos;center&apos;,</div><div class="line">    backgroundColor: &apos;#F5FCFF&apos;,</div><div class="line">  &#125;,</div><div class="line">  welcome: &#123;</div><div class="line">    fontSize: 20,</div><div class="line">    textAlign: &apos;center&apos;,</div><div class="line">    margin: 10,</div><div class="line">  &#125;,</div><div class="line">  instructions: &#123;</div><div class="line">    textAlign: &apos;center&apos;,</div><div class="line">    color: &apos;#333333&apos;,</div><div class="line">    marginBottom: 5,</div><div class="line">  &#125;,</div><div class="line">  flowRight: &#123;</div><div class="line">   flexDirection: &apos;row&apos;,</div><div class="line">   alignItems: &apos;center&apos;,</div><div class="line">   alignSelf: &apos;stretch&apos;</div><div class="line"> &#125;,</div><div class="line">&#125;);</div><div class="line">AppRegistry.registerComponent(&apos;MZRNTutorial&apos;, () =&gt; MZRNTutorial);</div></pre></td></tr></table></figure>
<p>MZButton.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">import React, &#123; Component &#125; from &apos;react&apos;;</div><div class="line">import &#123;</div><div class="line">  StyleSheet,</div><div class="line">  Text,</div><div class="line">  View,</div><div class="line">  Platform,</div><div class="line">  TouchableOpacity</div><div class="line">&#125; from &apos;react-native&apos;;</div><div class="line">//-----------------------------------------------------</div><div class="line">//外部使用该模块, ES6需要使用关键字 export default</div><div class="line">//-----------------------------------------------------</div><div class="line">export default class MZButton extends Component</div><div class="line">&#123;</div><div class="line">    constructor(props)</div><div class="line">    &#123;</div><div class="line">        super(props);</div><div class="line">        this.state = &#123;status:1&#125;;</div><div class="line">    &#125;</div><div class="line">    costumPressHandler = () =&gt; &#123;</div><div class="line">        alert(&apos;当前状态:&apos; + this.state.status);</div><div class="line">        const &#123;dianjishijian&#125; = this.props;</div><div class="line">        dianjishijian();</div><div class="line">    &#125;;</div><div class="line">    // 使用属性值设置背景颜色</div><div class="line">    // style=&#123;[styles.button], &#123;backgroundColor:this.props.beijingyanse&#125;&#125;</div><div class="line">    render() &#123;</div><div class="line">        //解构</div><div class="line">        const &#123;text, bgColor&#125; = this.props;</div><div class="line">        return (</div><div class="line">            &lt;TouchableOpacity</div><div class="line">                style=&#123;[styles.button], &#123;backgroundColor:bgColor&#125;&#125;</div><div class="line">                onPress = &#123;this.costumPressHandler&#125;</div><div class="line">                &gt;</div><div class="line">                &lt;Text style=&#123;styles.buttonText&#125;&gt;</div><div class="line">                    &#123;/* 使用属性值 */&#125;</div><div class="line">                    &#123;this.props.text&#125;</div><div class="line">                &lt;/Text&gt;</div><div class="line">            &lt;/TouchableOpacity&gt;</div><div class="line">        )</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">const styles = StyleSheet.create(&#123;</div><div class="line">    button: &#123;</div><div class="line">      height: 40,</div><div class="line">      width: 150,</div><div class="line">      borderRadius: 20,</div><div class="line">      justifyContent: &apos;center&apos;,</div><div class="line">      backgroundColor: &apos;green&apos;,</div><div class="line">      overflow: &apos;hidden&apos;</div><div class="line">    &#125;,</div><div class="line">    buttonText: &#123;</div><div class="line">      textAlign: &apos;center&apos;,</div><div class="line">      color: &apos;white&apos;</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>IDSRNPlatformUtil.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">import React, &#123; Component &#125; from &apos;react&apos;;</div><div class="line">import &#123;</div><div class="line">    Platform</div><div class="line">&#125; from &apos;react-native&apos;;</div><div class="line">export function getPlatformString()</div><div class="line">&#123;</div><div class="line">    console.log(Platform.OS);</div><div class="line">    </div><div class="line">    return Platform.OS;</div><div class="line">&#125;</div><div class="line">export function isIOS()</div><div class="line">&#123;</div><div class="line">    return Platform.OS === &apos;ios&apos;;</div><div class="line">&#125;</div><div class="line">export function isAndroid()</div><div class="line">&#123;</div><div class="line">    return Platform.OS == &apos;android&apos;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> ReactNative </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android ReactNative </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS 项目: 打造本地 pod 库]]></title>
      <url>/2016/09/25/iOS-%E9%A1%B9%E7%9B%AE-%E6%89%93%E9%80%A0%E6%9C%AC%E5%9C%B0-pod-%E5%BA%93/</url>
      <content type="html"><![CDATA[<p>项目到了一定规模, 代码组织和结构显得尤为重要.</p>
<p>重构项目结构, 可以从分离代码开始.</p>
<p>代码分离, 可以把常用稳定的组件封装抽离出来.</p>
<p>分离代码, 常用的有几种方式</p>
<blockquote>
<p>1.放到不同的文件夹, 管理和组织代码.<br>2.使用 framework 的方式, 提供给项目使用.<br>3.工具管理如 Cocoapods.</p>
</blockquote>
<p>这几种方式, 各有所长, 各有优劣, 无所谓好与坏, 根据自己的项目特点来组织即可.</p>
<p>我的做法是使用 cocoapods 来管理.</p>
<p>下面进入今天的主题:</p>
<blockquote>
<p>使用 cocoapods 管理自己的本地代码.</p>
</blockquote>
<p>在我的博客 <a href="http://blog.csdn.net/veryitman/article/details/50769069" target="_blank" rel="noopener">Mac OSX 10.11.1+ 安装 Cocoapods</a><br>介绍了如何在最新版 MacOS 中安装 Cocoapods 以及注意事项, 并且作者保证持续「更新, 更正」内容.</p>
<p>One by one 吧.</p>
<hr>
<h2 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h2><p>使用 xcode 创建一个工程, 工程名就起为 TestPods.</p>
<blockquote>
<p>工程目录可以防止在桌面或者你喜欢的目录下面都可以.</p>
</blockquote>
<p>在 TestPods 下面创建 LocalLib 目录, 用来放置分离的代码.当然, 你也可以将 LocalLib 这个目录放到其他目录.</p>
<p>在 LocalLib 下面, 我的 pod 库代码名称为 download.</p>
<p>可以新建这个目录.</p>
<p>目录如下:<br><img src="/upload/images/2016/9/25/pod_lib_dir.png" alt="1"></p>
<h2 id="创建-podspec-文件"><a href="#创建-podspec-文件" class="headerlink" title="创建 podspec 文件"></a>创建 podspec 文件</h2><p>在 download 目录下面, 创建 podspec 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod spec create download</div></pre></td></tr></table></figure>
<p>创建完成后, 会生成 download.podspec 文件.</p>
<p>具体内容, 创建后, 大家可以自行查看.</p>
<h2 id="修改-podspec-文件"><a href="#修改-podspec-文件" class="headerlink" title="修改 podspec 文件"></a>修改 podspec 文件</h2><p>修改 download.podspec, 主要修改几个关键地方:</p>
<blockquote>
<p>源码位置<br>源码版本</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">――― Source Location ―――――――――――――――――――――――――――――――――――――――――――――#</div><div class="line">  #</div><div class="line">  #  Specify the location from where the source should be retrieved.</div><div class="line">  #  Supports git, hg, bzr, svn and HTTP.</div><div class="line">  #</div><div class="line">  s.source       = &#123; :git =&gt; &quot;&quot;, :tag =&gt; &quot;0.0.1&quot; &#125;</div><div class="line">  # ――― Source Code ――――――――――――――――――――――――――――――――――――――――――――#</div><div class="line">  #</div><div class="line">  #  CocoaPods is smart about how it includes source code. For source files</div><div class="line">  #  giving a folder will include any swift, h, m, mm, c &amp; cpp files.</div><div class="line">  #  For header files it will include any header in the folder.</div><div class="line">  #  Not including the public_header_files will make all headers public.</div><div class="line">  #</div><div class="line">  s.source_files  = &quot;Source&quot;, &quot;Source/**/*.&#123;h,m&#125;&quot;</div><div class="line">  s.exclude_files = &quot;Source/Exclude&quot;</div></pre></td></tr></table></figure>
<p>另外, 配置好相关描述信息, 不要包含 ‘Example’ 的字样, 不然, 新版的 Cocoapods 执行 pod install 时候, 会报出警告和错误.</p>
<p>这样, 工程可以使用 pods 库了.</p>
<h2 id="工程使用-pod-库"><a href="#工程使用-pod-库" class="headerlink" title="工程使用 pod 库"></a>工程使用 pod 库</h2><p>将 TestPods 改为 cocoapods 项目.</p>
<p>在 TestPods 目录, 执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod init</div></pre></td></tr></table></figure>
<p>会生成 Podfile 等文件.</p>
<p>修改 Podfile 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"># Uncomment this line to define a global platform for your project</div><div class="line"># platform :ios, &apos;7.0&apos;</div><div class="line"># Uncomment this line if you&apos;re using Swift</div><div class="line"># use_frameworks!</div><div class="line">target &apos;TestPods&apos; do</div><div class="line">pod &apos;download&apos;, :path =&gt; &apos;./LocalLib/download/&apos;</div><div class="line">#pod &apos;core_lib_spec&apos;, :svn =&gt; &apos;http://svn.ids111.com/o2o/client/ios/trunks/master/Frameworks/CoreLibrary&apos;</div><div class="line">end</div><div class="line">target &apos;TestPodsTests&apos; do</div><div class="line">end</div><div class="line">target &apos;TestPodsUITests&apos; do</div><div class="line">end</div></pre></td></tr></table></figure>
<p>关键是指明 pod 库的位置.<br>路径一定要正确.否则无法找到该库.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pod &apos;download&apos;, :path =&gt; &apos;./LocalLib/download/&apos;</div></pre></td></tr></table></figure>
<p>在 TestPods 下面, pod install 即可.</p>
<p>如果, pod install 报错, 一般都是你的 pod 库的配置文件(.podspec)里面写的不符合要求.</p>
<p>根据报错信息, 加以修改即可.</p>
<p>xcode 打开工程.<br><img src="/upload/images/2016/9/25/pod_lib_pro.png" alt="1"></p>
<h2 id="示例下载"><a href="#示例下载" class="headerlink" title="示例下载"></a>示例下载</h2><p>工程示例代码, 可以 <a href="http://download.csdn.net/download/androidbluetooth/9520262" target="_blank" rel="noopener">戳这里下载</a> 玩耍!</p>
<h2 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h2><p>后续博客会给大家分享, 如何将自己的 pod 库提交到 github, 这样别人也可以使用您开发的库了.</p>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> iOS Cocoapods </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[RN: 如何启动 local server]]></title>
      <url>/2016/09/22/RN-%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8-local-server/</url>
      <content type="html"><![CDATA[<p>使用 <code>react-native init</code> 创建的工程, 在 xcode 中运行会自动启动一个 RN 的本地 Server.</p>
<p>像下面图片展示这样:<br><img src="/upload/images/2016/9/22/rn_1.png" alt="1"></p>
<p>那么, 这里问题来了.</p>
<p>比如, 我想暂时不启动这个本地 Server, 那么如何关闭呢?</p>
<p>下面跟大家一起探讨和追究一下.</p>
<h2 id="找到启动的根源"><a href="#找到启动的根源" class="headerlink" title="找到启动的根源"></a>找到启动的根源</h2><p>启动这个终端的是在一个 React.xcodeproj 工程的 「Build Phases」中脚本里面配置的.</p>
<p>脚本内容如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">if nc -w 5 -z localhost 8081 ; then</div><div class="line">  if ! curl -s &quot;http://localhost:8081/status&quot; | grep -q &quot;packager-status:running&quot; ; then</div><div class="line">    echo &quot;Port 8081 already in use, packager is either not running or not running correctly&quot;</div><div class="line">    exit 2</div><div class="line">  fi</div><div class="line">else</div><div class="line">  open &quot;$SRCROOT/../packager/launchPackager.command&quot; || echo &quot;Can&apos;t start packager automatically&quot;</div><div class="line">fi</div></pre></td></tr></table></figure>
<p>真正起作用的是:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">open &quot;$SRCROOT/../packager/launchPackager.command&quot;</div></pre></td></tr></table></figure>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>这样我们就可以关闭这个自启动了, 示例代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">if nc -w 5 -z localhost 8081 ; then</div><div class="line">  if ! curl -s &quot;http://localhost:8081/status&quot; | grep -q &quot;packager-status:running&quot; ; then</div><div class="line">    echo &quot;Port 8081 already in use, packager is either not running or not running correctly&quot;</div><div class="line">    exit 2</div><div class="line">  fi</div><div class="line">else</div><div class="line">#open &quot;$SRCROOT/../packager/launchPackager.command&quot; || echo &quot;Can&apos;t start packager automatically&quot;</div><div class="line">    echo &quot;Nothing...&quot;</div><div class="line">fi</div></pre></td></tr></table></figure>
<h2 id="看看-launchPackager-command"><a href="#看看-launchPackager-command" class="headerlink" title="看看 launchPackager.command"></a>看看 launchPackager.command</h2><p>这个文件在「node_modules/react-native/packager/」下面.</p>
<p>该文件是启动另外一个脚本 packager.sh, 核心代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source ./packager.sh</div></pre></td></tr></table></figure>
<p>最终执行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">node &quot;$THIS_DIR/../local-cli/cli.js&quot; start &quot;$@&quot;</div></pre></td></tr></table></figure>
<p>大家有兴趣可以去看看源码, 一探究竟.</p>
]]></content>
      
        <categories>
            
            <category> ReactNative </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ReactNative iOS Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[RN: 创建iOS工程代码的indent问题]]></title>
      <url>/2016/09/19/RN-%E5%88%9B%E5%BB%BAiOS%E5%B7%A5%E7%A8%8B%E4%BB%A3%E7%A0%81%E7%9A%84indent%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>使用最新版RN(0.33)来创建工程, 大家可以发现, OC 代码的退格变成了两个空格.<br>如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions</div><div class="line">&#123;</div><div class="line">  NSURL *jsCodeLocation;</div><div class="line">  jsCodeLocation = [[RCTBundleURLProvider sharedSettings] jsBundleURLForBundleRoot:@&quot;index.ios&quot; fallbackResource:nil];</div><div class="line">  RCTRootView *rootView = [[RCTRootView alloc] initWithBundleURL:jsCodeLocation</div><div class="line">                                                      moduleName:@&quot;Mark&quot;</div><div class="line">                                               initialProperties:nil</div><div class="line">                                                   launchOptions:launchOptions];</div><div class="line">  rootView.backgroundColor = [[UIColor alloc] initWithRed:1.0f green:1.0f blue:1.0f alpha:1];</div><div class="line">  self.window = [[UIWindow alloc] initWithFrame:[UIScreen mainScreen].bounds];</div><div class="line">  UIViewController *rootViewController = [UIViewController new];</div><div class="line">  rootViewController.view = rootView;</div><div class="line">  self.window.rootViewController = rootViewController;</div><div class="line">  [self.window makeKeyAndVisible];</div><div class="line">  return YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>无论你回车或者 tab 或者格式化(<code>右键/Structure/Re-Indent</code>)代码, 会发现, 都是这种调调.</p>
<p>面对这突如其来的变化, 我开始觉得有点淡淡的忧伤.</p>
<p>对于一直使用 <code>tab width = 4</code> 的我来说, 无法忍受. 必须改过来.</p>
<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>打开 Xcode 的 preferences, 看到其『设置』正常的不要不要的.</p>
<p>所以可以断定不是 Xcode 的问题.</p>
<p><img src="/upload/images/2016/9/19/xcode_pref.png" alt="1"></p>
<p>因为升级了 Xcode 到最新版 Xcode8, 还以为是 Xcode8 的 bug, 打开之前的 React Native 工程或者其他 Xcode 工程, 就没有这个「蛋疼」的问题.</p>
<p>最终猜想是工程配置文件引起的…</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>既然和 Xcode 没有关系, 那么问题就一定出现在配置文件上面.</p>
<p>罪魁祸首 <code>project.pbxproj</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">indentWidth = 2;</div><div class="line">sourceTree = &quot;&lt;group&gt;&quot;;</div><div class="line">tabWidth = 2;</div></pre></td></tr></table></figure>
<p>修改为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">indentWidth = 4;</div><div class="line">sourceTree = &quot;&lt;group&gt;&quot;;</div><div class="line">tabWidth = 4;</div></pre></td></tr></table></figure>
<p>或者直接删除:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">indentWidth = 2;</div><div class="line">tabWidth = 2;</div></pre></td></tr></table></figure>
<p>关闭工程, 重启 Xcode 就可以了.</p>
]]></content>
      
        <categories>
            
            <category> ReactNative </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ReactNative iOS Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[RN: Mac 配置 ES6 简易开发环境]]></title>
      <url>/2016/09/16/RN-Mac-%E9%85%8D%E7%BD%AE-ES6-%E7%AE%80%E6%98%93%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/</url>
      <content type="html"><![CDATA[<h2 id="创建文件夹-ES6"><a href="#创建文件夹-ES6" class="headerlink" title="创建文件夹 ES6"></a>创建文件夹 ES6</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ES6</div><div class="line">-lib</div><div class="line">-src</div></pre></td></tr></table></figure>
<p>你可以任意取一个你喜欢的目录名称.</p>
<h3 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm init</div></pre></td></tr></table></figure>
<p>填写项目信息.</p>
<p>查看一下 package.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat package.json</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;name&quot;: &quot;es6tutorials&quot;,</div><div class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</div><div class="line">  &quot;description&quot;: &quot;Tutorial&quot;,</div><div class="line">  &quot;main&quot;: &quot;index.js&quot;,</div><div class="line">  &quot;scripts&quot;: &#123;</div><div class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</div><div class="line">  &#125;,</div><div class="line">  &quot;keywords&quot;: [</div><div class="line">    &quot;es6&quot;,</div><div class="line">    &quot;.etc&quot;</div><div class="line">  ],</div><div class="line">  &quot;author&quot;: &quot;mark.zhang&quot;,</div><div class="line">  &quot;license&quot;: &quot;MIT&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>目录结构如下</p>
<p><img src="/upload/images/2016/9/10/1.jpg" alt="1"></p>
<h3 id="安装-babel-cli"><a href="#安装-babel-cli" class="headerlink" title="安装 babel-cli"></a>安装 babel-cli</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save-dev babel-cli</div></pre></td></tr></table></figure>
<p>也可以全局安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install babel-cli -g</div></pre></td></tr></table></figure>
<p>全局安装上后，会安装如下四个程序到全局环境中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">babel</div><div class="line">babel-node</div><div class="line">babel-doctor</div><div class="line">babel-external-helpers</div></pre></td></tr></table></figure>
<h2 id="安装-babel-core"><a href="#安装-babel-core" class="headerlink" title="安装 babel-core"></a>安装 babel-core</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install babel-core --save</div></pre></td></tr></table></figure>
<h2 id="安装-ES2015-插件"><a href="#安装-ES2015-插件" class="headerlink" title="安装 ES2015 插件"></a>安装 ES2015 插件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install babel-preset-es2015</div></pre></td></tr></table></figure>
<p>编写配置文件 .babelrc</p>
<p>注意该文件有个点符号.</p>
<p>在工程目录下新建该文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">touch .babelrc</div></pre></td></tr></table></figure>
<p>写入如下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;presets&quot;: [</div><div class="line">      &quot;es2015&quot;,</div><div class="line">    ],</div><div class="line">    &quot;plugins&quot;: []</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>编写测试代码 tutorials.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">function test()</div><div class="line">&#123;</div><div class="line">    console.log(a);</div><div class="line">    var a = 0;</div><div class="line">&#125;</div><div class="line">test();</div><div class="line">var a = [];</div><div class="line">for (var i = 0; i &lt; 10; i++) &#123;</div><div class="line">  var c = i;</div><div class="line">  a[i] = function () &#123;</div><div class="line">    console.log(c);</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line">a[6](); // 9</div><div class="line">var b = [];</div><div class="line">for (var i=0; i&lt;10; i++) &#123;</div><div class="line">    let c = i; //let 是 es6中的关键字</div><div class="line">    b[i] = function() &#123;</div><div class="line">        console.log(c)</div><div class="line">    &#125;;</div><div class="line">&#125;</div><div class="line">b[6]();</div></pre></td></tr></table></figure>
<p>编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">babel src/tutorials.js</div></pre></td></tr></table></figure>
<p>运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">babel-node src/tutorials.js</div></pre></td></tr></table></figure>
<p><img src="/upload/images/2016/9/10/2.jpg" alt="1"></p>
<p>这里可以下载 <a href="https://github.com/veryitman/ES6Tutorials" target="_blank" rel="noopener">工程源码</a>.</p>
<h2 id="其他操作"><a href="#其他操作" class="headerlink" title="其他操作"></a>其他操作</h2><h3 id="1-将-ES6-语法的文件转换为-ES5-的语法"><a href="#1-将-ES6-语法的文件转换为-ES5-的语法" class="headerlink" title="1.将 ES6 语法的文件转换为 ES5 的语法"></a>1.将 ES6 语法的文件转换为 ES5 的语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">babel -d lib/ src/</div></pre></td></tr></table></figure>
<p>在 lib 目录下会生成 src 目录中对应的文件.</p>
<h3 id="2-进入交互模式"><a href="#2-进入交互模式" class="headerlink" title="2.进入交互模式"></a>2.进入交互模式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">babel-node</div></pre></td></tr></table></figure>
<p>两次 ctrl+c 退出</p>
<h3 id="3-检查babel状况"><a href="#3-检查babel状况" class="headerlink" title="3.检查babel状况"></a>3.检查babel状况</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">babel-doctor</div></pre></td></tr></table></figure>
<p>检查以下内容</p>
<ul>
<li><p>配置文件.babelrc</p>
</li>
<li><p>是否有重复的babel安装包，比如说安装了5和6</p>
</li>
<li><p>babel安装包是否已经升级到了最新版</p>
</li>
<li><p>npm &gt;= 3.3.0</p>
</li>
</ul>
<p><img src="/upload/images/2016/9/10/3.jpg" alt="1"></p>
<h3 id="4-卸载全局的-babel-cli"><a href="#4-卸载全局的-babel-cli" class="headerlink" title="4.卸载全局的 babel-cli"></a>4.卸载全局的 babel-cli</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm uninstall --global babel-cli</div></pre></td></tr></table></figure>
<h2 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h2><ul>
<li><p><a href="https://babeljs.io/docs/usage/cli/" target="_blank" rel="noopener">Babel comes with a built-in CLI which can be used to compile files from the command line.</a></p>
</li>
<li><p>阮一峰老师的 <a href="https://www.gitbook.com/book/wohugb/ecmascript-6/details" target="_blank" rel="noopener">ECMAScript 6入门</a></p>
</li>
</ul>
]]></content>
      
        <categories>
            
            <category> ReactNative </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ReactNative </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS: 手机是否设置网络代理]]></title>
      <url>/2016/09/16/iOS-%E6%89%8B%E6%9C%BA%E6%98%AF%E5%90%A6%E8%AE%BE%E7%BD%AE%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86/</url>
      <content type="html"><![CDATA[<h2 id="情景"><a href="#情景" class="headerlink" title="情景"></a>情景</h2><p>项目开发过程中, 会遇到下面这样一种情景:</p>
<blockquote>
<p>产品或者设计同事需要体验目前产品开发的进度, 然后要求开发人员, 将现在的版本给他们体验.<br>做过程序开发的人都知道, 开发版本会有不少问题.<br>这时, 产品和设计同事就会抱怨, 怎么登录不了, 这里没有数据了!<br>有个小伙伴被折腾的实在受不了, 连网页都打不开了.<br>最后找到原因:<br>他手机被之前的程序猿设置了网络代理, 代理到程序猿哥哥的电脑上来抓包调试问题, 忘记取消设置了.</p>
</blockquote>
<p>假如可以判断当前手机是否设置了网络代理, 就可以很好地解决上面情景中提到的问题了.</p>
<h2 id="找到线索"><a href="#找到线索" class="headerlink" title="找到线索"></a>找到线索</h2><p>在 ASIHttpRequest 中找到如下方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">- (BOOL)configureProxies</div><div class="line">&#123;</div><div class="line">	// Have details of the proxy been set on this request</div><div class="line">	if (![self isPACFileRequest] &amp;&amp; (![self proxyHost] &amp;&amp; ![self proxyPort])) &#123;</div><div class="line">		// If not, we need to figure out what they&apos;ll be</div><div class="line">		NSArray *proxies = nil;</div><div class="line">		// Have we been given a proxy auto config file?</div><div class="line">		if ([self PACurl]) &#123;</div><div class="line">			// If yes, we&apos;ll need to fetch the PAC file asynchronously, so we stop this request to wait until we have the proxy details.</div><div class="line">			[self fetchPACFile];</div><div class="line">			return NO;</div><div class="line">			// Detect proxy settings and apply them</div><div class="line">		&#125; else &#123;</div><div class="line">#if TARGET_OS_IPHONE</div><div class="line">			NSDictionary *proxySettings = [NSMakeCollectable(CFNetworkCopySystemProxySettings()) autorelease];</div><div class="line">#else</div><div class="line">			NSDictionary *proxySettings = [NSMakeCollectable(SCDynamicStoreCopyProxies(NULL)) autorelease];</div><div class="line">#endif</div><div class="line">			proxies = [NSMakeCollectable(CFNetworkCopyProxiesForURL((CFURLRef)[self url], (CFDictionaryRef)proxySettings)) autorelease];</div><div class="line">			// Now check to see if the proxy settings contained a PAC url, we need to run the script to get the real list of proxies if so</div><div class="line">			NSDictionary *settings = [proxies objectAtIndex:0];</div><div class="line">			if ([settings objectForKey:(NSString *)kCFProxyAutoConfigurationURLKey]) &#123;</div><div class="line">				[self setPACurl:[settings objectForKey:(NSString *)kCFProxyAutoConfigurationURLKey]];</div><div class="line">				[self fetchPACFile];</div><div class="line">				return NO;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		if (!proxies) &#123;</div><div class="line">			[self setReadStream:nil];</div><div class="line">			[self failWithError:[NSError errorWithDomain:NetworkRequestErrorDomain code:ASIInternalErrorWhileBuildingRequestType userInfo:[NSDictionary dictionaryWithObjectsAndKeys:@&quot;Unable to obtain information on proxy servers needed for request&quot;,NSLocalizedDescriptionKey,nil]]];</div><div class="line">			return NO;</div><div class="line">		&#125;</div><div class="line">		// I don&apos;t really understand why the dictionary returned by CFNetworkCopyProxiesForURL uses different key names from CFNetworkCopySystemProxySettings/SCDynamicStoreCopyProxies</div><div class="line">		// and why its key names are documented while those we actually need to use don&apos;t seem to be (passing the kCF* keys doesn&apos;t seem to work)</div><div class="line">		if ([proxies count] &gt; 0) &#123;</div><div class="line">			NSDictionary *settings = [proxies objectAtIndex:0];</div><div class="line">			[self setProxyHost:[settings objectForKey:(NSString *)kCFProxyHostNameKey]];</div><div class="line">			[self setProxyPort:[[settings objectForKey:(NSString *)kCFProxyPortNumberKey] intValue]];</div><div class="line">			[self setProxyType:[settings objectForKey:(NSString *)kCFProxyTypeKey]];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	return YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>踏破铁鞋无觅处…</p>
<p>判断 iphone 是否设置网络代理的示例代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">+ (BOOL)hasSetProxy</div><div class="line">&#123;</div><div class="line">    BOOL proxy = NO;</div><div class="line">    </div><div class="line">    NSDictionary *proxySettings = (__bridge NSDictionary *)(CFNetworkCopySystemProxySettings());</div><div class="line">    NSURL *url = [NSURL URLWithString:@&quot;http://www.baidu.com&quot;];</div><div class="line">    NSArray *proxies = (__bridge NSArray *)(CFNetworkCopyProxiesForURL((__bridge CFURLRef)(url),</div><div class="line">                                                                       (__bridge CFDictionaryRef)(proxySettings)));</div><div class="line">    MZLOG(@&quot;proxies:%@&quot;, proxies);</div><div class="line">    NSDictionary *settings = proxies[0];</div><div class="line">    MZLOG(@&quot;kCFProxyHostNameKey: %@&quot;, [settings objectForKey:(NSString *)kCFProxyHostNameKey]);</div><div class="line">    MZLOG(@&quot;kCFProxyPortNumberKey: %@&quot;, [settings objectForKey:(NSString *)kCFProxyPortNumberKey]);</div><div class="line">    MZLOG(@&quot;kCFProxyTypeKey: %@&quot;, [settings objectForKey:(NSString *)kCFProxyTypeKey]);</div><div class="line">    if ([[settings objectForKey:(NSString *)kCFProxyTypeKey] isEqualToString:@&quot;kCFProxyTypeNone&quot;]) &#123;</div><div class="line">        proxy = NO;</div><div class="line">    &#125;</div><div class="line">    else &#123;</div><div class="line">        proxy = YES;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    return proxy;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="用户体验"><a href="#用户体验" class="headerlink" title="用户体验"></a>用户体验</h2><p>判断如果设置了代理, 提示用户, 帮他直接跳到 wifi 设置界面.</p>
<p>下面说说如何跳到系统的 wifi 设置界面.</p>
<p>1.配置 URL TYPES</p>
<p><img src="/upload/images/2016/9/16/1.jpeg" alt="1"></p>
<p>注意这里的配置是 <code>prefs</code>.</p>
<p>2.openURL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">NSString * urlString = @&quot;prefs:root=WIFI&quot;;</div><div class="line">NSURL *url = [NSURL URLWithString:urlString];</div><div class="line">UIApplication *app = [UIApplication sharedApplication];</div><div class="line">if ([app canOpenURL:[NSURL URLWithString:urlString]]) &#123;</div><div class="line"> </div><div class="line">    if ([[UIDevice currentDevice].systemVersion doubleValue] &gt;= 10.0) &#123;</div><div class="line">    </div><div class="line">    	[app openURL:url options:@&#123;&#125; completionHandler:nil];</div><div class="line">    &#125; </div><div class="line">    else &#123;</div><div class="line">    </div><div class="line">    	[app openURL:url];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>另外, 跳转到系统其他界面的 URL 如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">1.系统设置</div><div class="line">prefs:root=INTERNET_TETHERING</div><div class="line">2.WIFI设置</div><div class="line">prefs:root=WIFI</div><div class="line">3.蓝牙设置</div><div class="line">prefs:root=Bluetooth</div><div class="line">4.系统通知</div><div class="line">prefs:root=NOTIFICATIONS_ID</div><div class="line">5.通用设置</div><div class="line">prefs:root=General</div><div class="line">6.显示设置</div><div class="line">prefs:root=DISPLAY&amp;BRIGHTNESS</div><div class="line">7.壁纸设置</div><div class="line">prefs:root=Wallpaper</div><div class="line">8.声音设置</div><div class="line">prefs:root=Sounds</div><div class="line">9.隐私设置</div><div class="line">prefs:root=privacy</div><div class="line">10.打开 APP Store</div><div class="line">prefs:root=STORE</div><div class="line">11.打开 Notes</div><div class="line">prefs:root=NOTES</div><div class="line">12.打开 Safari</div><div class="line">prefs:root=Safari</div><div class="line">13.打开 Music</div><div class="line">prefs:root=MUSIC</div><div class="line">14.打开 photo</div><div class="line">prefs:root=Photos</div></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> iOS proxy </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[与 CSDN 的诀别]]></title>
      <url>/2016/09/10/%E4%B8%8E-CSDN-%E7%9A%84%E8%AF%80%E5%88%AB/</url>
      <content type="html"><![CDATA[<p>写这个话题, 内心还是蛮沉重的.</p>
<p>几年前与 CSDN 不期而遇, 在里面各种折腾, 翻阅大牛们的博客, 写评论, 甚至打印出来. 在技术论坛不停地”灌水”, 订阅 CSDN 杂志, 准备练就一身武艺.</p>
<p>互联网的蓬勃发展, 让我原来不安的心有了更加狂躁的冲动.</p>
<p>在某个夜深人静的夜晚, 开启了奋笔疾书的历程, 踏上了 CSDN 的博客之旅.<br>这么多年以来, CSDN 就像我的一个朋友, 不管是家长里短, 还是技术讨论, 各种心酸, 我都会记录在那里.</p>
<p>一坚持就是几年…</p>
<p>如今, 要离开 CSDN 的博客了, 不准备在那里继续’耕耘’了.<br>总结起来有如下几个原因:</p>
<blockquote>
<ol>
<li>文章被任意的转载, 没经过本人的允许.我在论坛也问过该事, 没有任何回应, 很失望!</li>
<li>广告越来越多.</li>
<li>相比以前, 很难找到让人满意的有质量的文章.</li>
</ol>
</blockquote>
<p>再见, CSDN! 请原谅我的不辞而别!</p>
]]></content>
      
        <categories>
            
            <category> 随笔 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 生活 写作 </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
